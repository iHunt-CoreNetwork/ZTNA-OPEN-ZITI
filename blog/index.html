<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">OpenZiti Technical Blog | OpenZiti</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openziti.io/blog"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" property="og:title" content="OpenZiti Technical Blog | OpenZiti"><meta data-rh="true" name="description" content="Technical articles about OpenZiti"><meta data-rh="true" property="og:description" content="Technical articles about OpenZiti"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openziti.io/blog"><link data-rh="true" rel="alternate" href="https://openziti.io/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://openziti.io/blog" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenZiti RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenZiti Atom Feed">


<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-5SF399H3",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>




<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.eb3f62e5.css">
<link rel="preload" href="/assets/js/runtime~main.08af6442.js" as="script">
<link rel="preload" href="/assets/js/main.738ccc42.js" as="script">
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SF399H3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>



<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="root_VOM9"><span style="color:whitesmoke">Star us on GitHubÂ </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://openziti.io" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/ziti-logo-light.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/downloads">Downloads</a><a href="https://blog.openziti.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li><div class="text-divider"><p>Socials</p></div></li><li><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/yt.svg">YouTube</span></a></li><li><a href="https://twitter.com/OpenZiti" target="_blank" title="OpenZiti on Twitter"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/twit.svg">Twitter</span></a></li><li><a href="https://www.reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/reddit-logo.png">Reddit</span></a></li><li><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/ziggy.png"><a href="https://twitter.com/OpenZiggy" target="_blank" title="OpenZiggy on Twitter">Ziggy</a></span></li><li><div class="text-divider"><p>Other</p></div></li><li><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/blog-icon.png"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/oz-test-kitchen.png"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li><li><a href="https://zeds.openziti.org" target="_blank" title="Developer Sandbox"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/zeds.png">ZEDS</span></a></li><li><a href="https://netfoundry.io/pricing/" target="_blank" title="NetFoundry-hosted Ziti"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/nf.svg">CloudZiti</span></a></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/articles">Articles</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/c-sdk-on-beaglebone">Building the Ziti C SDK and Sample Apps for arm (BeagleBone)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bootstrapping-trust/part-01.encryption-everywhere">Bootstrapping Trust</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">Bootstrapping Trust</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bootstrapping-trust/part-03.certificates">Bootstrapping Trust</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Here you&#x27;ll find articles that cover various topics related to developing"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/articles">Articles</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-21T16:18:09.000Z" itemprop="datePublished">December 21, 2023</time> Â· <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>Here you&#x27;ll find articles that cover various topics related to developing
applications with Ziti.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="topics">Topics<a href="#topics" class="hash-link" aria-label="Direct link to Topics" title="Direct link to Topics">â</a></h2><ul><li><a href="/blog/c-sdk-on-beaglebone">Ziti Up and Running on BeagleBone</a></li><li><a href="/blog/bootstrapping-trust/part-01.encryption-everywhere">Bootstrapping Trust</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="zitifications"><a href="/blog/zitification">Zitifications</a><a href="#zitifications" class="hash-link" aria-label="Direct link to zitifications" title="Direct link to zitifications">â</a></h2><p>A Zitification is any open-source project that has been modified to use the OpenZiti Edge SDK for client or server connectivity, or both. Zitified apps are bound to an identity instead of an address.</p><ul><li><a href="/blog/zitification/prometheus/part1">Prometheus</a></li><li><a href="/blog/zitification/kubernetes">Kubernetes</a></li><li><a href="/blog/zitification/zitifying-ssh"><strong>SSH</strong></a></li><li><a href="/blog/zitification/zitifying-scp"><strong>SCP</strong></a></li></ul></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="This article walks you through building the Ziti C SDK for Linux-arm and running"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/c-sdk-on-beaglebone">Building the Ziti C SDK and Sample Apps for arm (BeagleBone)</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-21T16:18:09.000Z" itemprop="datePublished">December 21, 2023</time> Â· <!-- -->6 min read</div></header><div class="markdown" itemprop="articleBody"><p>This article walks you through building the Ziti C SDK for Linux-arm and running
the wttr sample application on a <a href="https://beagleboard.org/enhanced" target="_blank" rel="noopener noreferrer">BeagleBone SanCloud</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-the-host-system">Configure the Host System<a href="#configure-the-host-system" class="hash-link" aria-label="Direct link to Configure the Host System" title="Direct link to Configure the Host System">â</a></h2><p>This article uses an Ubuntu 19.10 virtual machine as a development host because it&#x27;s
relatively easy to install a functional toolchain that targets arm-linux.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">devbox$ sudo apt-get install gcc-arm-linux-gnueabihf g++-arm-linux-gnueabihf \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    binutils-arm-linux-gnueabihf gdb-multiarch cmake git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-the-sdk-and-sample-applications">Build the SDK and Sample Applications<a href="#build-the-sdk-and-sample-applications" class="hash-link" aria-label="Direct link to Build the SDK and Sample Applications" title="Direct link to Build the SDK and Sample Applications">â</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">devbox$ git clone --recurse-submodules https://github.com/netfoundry/ziti-sdk-c.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cloning into &#x27;ziti-sdk-c&#x27;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Enumerating objects: 77, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Counting objects: 100% (77/77), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Compressing objects: 100% (50/50), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Total 1287 (delta 35), reused 51 (delta 24), pack-reused 1210</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Receiving objects: 100% (1287/1287), 475.44 KiB | 4.85 MiB/s, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">devbox$ cd ziti-sdk-c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">devbox$ mkdir build-Linux-arm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">devbox$ cd build-Linux-arm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">devbox$ cmake -DCMAKE_TOOLCHAIN_FILE=../toolchains/Linux-arm.cmake ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project version: 0.9.2.1 (derived from git)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- The C compiler identification is GNU 9.2.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- The CXX compiler identification is GNU 9.2.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Check for working C compiler: /usr/bin/arm-linux-gnueabihf-gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  1%] Building C object deps/uv-mbed/deps/libuv/CMakeFiles/uv_a.dir/src/fs-poll.c.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  1%] Building C object deps/uv-mbed/deps/libuv/CMakeFiles/uv_a.dir/src/idna.c.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  2%] Building C object deps/uv-mbed/deps/libuv/CMakeFiles/uv_a.dir/src/inet.c.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  2%] Building C object deps/uv-mbed/deps/libuv/CMakeFiles/uv_a.dir/src/random.c.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ 99%] Building C object programs/sample_wttr/CMakeFiles/sample_wttr.dir/sample_wttr.c.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ 99%] Linking C executable sample_wttr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ 99%] Built target sample_wttr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[100%] Built target sample-host</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <code>make</code> completes, you&#x27;ll have statically linked binaries for the SDK&#x27;s sample applications.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-a-ziti-network">Set up a Ziti Network<a href="#set-up-a-ziti-network" class="hash-link" aria-label="Direct link to Set up a Ziti Network" title="Direct link to Set up a Ziti Network">â</a></h2><p>For this article we&#x27;ll use a Ziti Edge Developer Edition to run our network. Follow
the <a href="/docs/learn/quickstarts/network/">Ziti Network Quickstart</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-demo-weather-service">Create the &quot;demo-weather&quot; Service<a href="#create-the-demo-weather-service" class="hash-link" aria-label="Direct link to Create the &quot;demo-weather&quot; Service" title="Direct link to Create the &quot;demo-weather&quot; Service">â</a></h3><p>The sample_wttr application accesses a service named &quot;demo-weather&quot;, so we&#x27;ll create
that service now. Log in to your Ziti Edge Developer Edition web UI and follow the
steps:</p><ol><li>On the left side nav bar, click &quot;Edge Services&quot;</li><li>In the top right corner of the screen click the &quot;plus&quot; image to add a new service</li><li>Choose a name for the service. Enter &quot;demo-weather&quot;</li><li>Choose Router &quot;ziti-gw01&quot;</li><li>For Endpoint Service choose:<ul><li>protocol = tcp</li><li>host = wttr.in</li><li>port = 80</li></ul></li><li>Click save</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upload-the-artifacts-to-your-beaglebone">Upload the Artifacts to Your BeagleBone<a href="#upload-the-artifacts-to-your-beaglebone" class="hash-link" aria-label="Direct link to Upload the Artifacts to Your BeagleBone" title="Direct link to Upload the Artifacts to Your BeagleBone">â</a></h2><p>At this point we have created all of the artifacts that are needed for running the
sample application:</p><ul><li>The &quot;sample_wttr&quot; executable</li><li>The Ziti identity json file (e.g. &quot;NewUser.json&quot;)</li></ul><p>Now we need to upload these artifacts to the BeagleBone. The scp command shown here
assumes that:</p><ul><li>You are in the <code>build-Linux-arm</code> subdirectory where the <code>make</code> command was executed above.</li><li>Your BeagleBone is running sshd and has an IP address of 192.168.2.2 which
can be reached from your development host</li><li>The Ziti identity json file that was created when you followed the Ziti Network Quickstart
was downloaded to your ~/Downloads directory.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">devbox$ scp ./programs/sample_wttr/sample_wttr root@192.168.2.2:.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ scp ~/Downloads/NewUser.json ./programs/sample_wttr/sample_wttr debian@192.168.2.2:.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NewUser.json                                  100% 6204     2.5MB/s   00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sample_wttr                                   100% 2434KB   5.4MB/s   00:00</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-application">Run the Application<a href="#run-the-application" class="hash-link" aria-label="Direct link to Run the Application" title="Direct link to Run the Application">â</a></h2><p>Now we&#x27;re ready to log into the BeagleBone and run the sample application.
Let&#x27;s go!</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@beaglebone:~$ ./sample_wttr ./NewUser.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.000] INFO    library/ziti.c:173 NF_init(): ZitiSDK version 0.9.2.1-local @de37e6f(wttr-sample-shutdown-cleanup) starting at (2019-09-05T22:35:12.259)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.000] INFO    library/ziti.c:195 NF_init_with_tls(): ZitiSDK version 0.9.2.1-local @de37e6f(wttr-sample-shutdown-cleanup)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/home/scarey/repos/github.com/netfoundry/ziti-sdk-c/deps/uv-mbed/src/http.c:315 ERR TLS handshake error </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/home/scarey/repos/github.com/netfoundry/ziti-sdk-c/deps/uv-mbed/src/http.c:153 WARN received -103 (software caused connection abort)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.210] ERROR   library/ziti.c:433 version_cb(): failed to get controller version from ec2-54-164-120-24.compute-1.amazonaws.com:1280 CONTROLLER_UNAVAILABLE(software caused connection abort)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.210] WARN    library/ziti_ctrl.c:49 code_to_error(): unmapped error code: CONTROLLER_UNAVAILABLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.210] ERROR   library/ziti.c:419 session_cb(): failed to login: CONTROLLER_UNAVAILABLE[-11](software caused connection abort)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: status =&gt; WTF: programming error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@beaglebone:~# </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Oops. Actually The Ziti SDK verifies the certificate from the Ziti Edge Controller,
so we need to set the clock on the BeagleBone to a time/date that is within the
valid range of the certificate. Might as well set the clock to the current time:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@beaglebone:~# sudo rdate time.nist.gov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wed Mar 18 15:46:56 2020</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And <em>now</em> we are ready to run the application:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@beaglebone:~$ ./sample_wttr ./NewUser.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.000] INFO    library/ziti.c:173 NF_init(): ZitiSDK version 0.9.2.1-local @de37e6f(wttr-sample-shutdown-cleanup) starting at (2020-03-18T15:46:57.536)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.000] INFO    library/ziti.c:195 NF_init_with_tls(): ZitiSDK version 0.9.2.1-local @de37e6f(wttr-sample-shutdown-cleanup)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.554] INFO    library/ziti.c:438 version_cb(): connected to controller ec2-54-164-120-24.compute-1.amazonaws.com:1280 version v0.9.0(ea556fc18740 2020-02-11 16:09:08)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.696] INFO    library/connect.c:180 connect_get_service_cb(): got service[demo-weather] id[cc90410f-1017-4d23-977a-3695cb58f4e8]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.810] INFO    library/connect.c:209 connect_get_net_session_cb(): got session[d89bfdd8-c7e5-42ff-a39f-63056eeb3a82] for service[demo-weather]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        0.810] INFO    library/channel.c:148 ziti_channel_connect(): opening new channel for ingress[tls://ec2-54-164-120-24.compute-1.amazonaws.com:3022] ch[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sending HTTP request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request success: 99 bytes sent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server: nginx/1.10.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Wed, 18 Mar 2020 15:47:00 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/plain; charset=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 8662</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: close</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Weather report: Rochester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     \   /     Sunny</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .-.      39 Â°F          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   â (   ) â   â 0 mph        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      `-â      9 mi           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     /   \     0.0 in         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                       âââââââââââââââ                                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââââââââ¬ââââââââââââââââââââââââ¤  Wed 18 Mar âââââââââââââââââââââââââ¬âââââââââââââââââââââââââââââââ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â            Morning           â             Noon      ââââââââ¬âââââââ     Evening           â             Night            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â               Overcast       â               Overcast       â               Cloudy         â               Overcast       â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â      .--.     32..35 Â°F      â      .--.     35..41 Â°F      â      .--.     39..44 Â°F      â      .--.     37..42 Â°F      â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â   .-(    ).   â 3-4 mph      â   .-(    ).   â 6-8 mph      â   .-(    ).   â 9-16 mph     â   .-(    ).   â 9-17 mph     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â  (___.__)__)  6 mi           â  (___.__)__)  6 mi           â  (___.__)__)  6 mi           â  (___.__)__)  6 mi           â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â               0.0 in | 0%    â               0.0 in | 0%    â               0.0 in | 0%    â               0.0 in | 0%    â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                       âââââââââââââââ                                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââââââââ¬ââââââââââââââââââââââââ¤  Thu 19 Mar âââââââââââââââââââââââââ¬âââââââââââââââââââââââââââââââ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â            Morning           â             Noon      ââââââââ¬âââââââ     Evening           â             Night            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â    \  /       Partly cloudy  â               Cloudy         â    \  /       Partly cloudy  â  _`/&quot;&quot;.-.     Patchy light dâ¦â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â  _ /&quot;&quot;.-.     41..44 Â°F      â      .--.     50 Â°F          â  _ /&quot;&quot;.-.     53..55 Â°F      â   ,\_(   ).   50..53 Â°F      â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â    \_(   ).   â 4-7 mph      â   .-(    ).   â 4-6 mph      â    \_(   ).   â 6-11 mph     â    /(___(__)  â 10-19 mph    â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â    /(___(__)  3 mi           â  (___.__)__)  6 mi           â    /(___(__)  6 mi           â      â â â â  4 mi           â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â               0.0 in | 0%    â               0.0 in | 0%    â               0.0 in | 0%    â     â â â â   0.0 in | 20%   â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                       âââââââââââââââ                                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââââââââ¬ââââââââââââââââââââââââ¤  Fri 20 Mar âââââââââââââââââââââââââ¬âââââââââââââââââââââââââââââââ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â            Morning           â             Noon      ââââââââ¬âââââââ     Evening           â             Night            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â  _`/&quot;&quot;.-.     Light rain shoâ¦â    \  /       Partly cloudy  â    \  /       Partly cloudy  â               Cloudy         â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â   ,\_(   ).   62 Â°F          â  _ /&quot;&quot;.-.     66 Â°F          â  _ /&quot;&quot;.-.     48..51 Â°F      â      .--.     46 Â°F          â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â    /(___(__)  â 14-27 mph    â    \_(   ).   â 26-41 mph    â    \_(   ).   â 24-36 mph    â   .-(    ).   â 22-30 mph    â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â      â â â â  6 mi           â    /(___(__)  6 mi           â    /(___(__)  6 mi           â  (___.__)__)  6 mi           â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â     â â â â   0.0 in | 29%   â               0.0 in | 59%   â               0.0 in | 41%   â               0.0 in | 0%    â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Location: Rochester, Monroe County, New York, United States of America [43.157285,-77.6152139]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Follow @igor_chubin for wttr.in updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request completed: Connection closed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[        3.714] INFO    library/ziti.c:238 NF_shutdown(): Ziti is shutting down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">========================</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Part 1: Encryption Everywhere"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/bootstrapping-trust/part-01.encryption-everywhere">Bootstrapping Trust</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-21T16:18:09.000Z" itemprop="datePublished">December 21, 2023</time> Â· <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/andrewpmartinez" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/199856?v=4" alt="Andrew Martinez" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/andrewpmartinez" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Andrew Martinez</span></a></div><small class="avatar__subtitle" itemprop="description">OpenZiti Maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-encryption-everywhere">Part 1: Encryption Everywhere<a href="#part-1-encryption-everywhere" class="hash-link" aria-label="Direct link to Part 1: Encryption Everywhere" title="Direct link to Part 1: Encryption Everywhere">â</a></h2><p>Whether you are an encryption expert or a newcomer, welcome! This series
is for you! It assumes you know nothing and takes you from soup to nuts
on how to bootstrap trust with the intent to power a Zero Trust security
model. The process and thinking described in this series are the direct
output of developing the same system for the Ziti open source project.
Ziti can be found on the GitHub project page for
<a href="https://github.com/openziti" target="_blank" rel="noopener noreferrer">OpenZiti</a>. The series starts with the
basics and dovetails into Ziti&#x27;s Enrollment system.</p><p>The parts are as follows.</p><ul><li><a href="/blog/bootstrapping-trust/part-01.encryption-everywhere">Part 1: Encryption Everywhere</a></li><li><a href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">Part 2: A Primer On Public-Key Cryptography</a></li><li><a href="/blog/bootstrapping-trust/part-03.certificates">Part 3: Certificates</a></li><li><a href="/blog/bootstrapping-trust/part-04.certificate-authorities-and-chains-of-trust">Part 4: Certificate Authorities &amp; Chains Of Trust</a></li><li><a href="/blog/bootstrapping-trust/part-05.bootstrapping-trust">Part 5: Bootstrapping Trust</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="zero-trust">Zero Trust<a href="#zero-trust" class="hash-link" aria-label="Direct link to Zero Trust" title="Direct link to Zero Trust">â</a></h3><p>This entire series assumes some familiarity with Zero Trust. If you do
not have a strong background in it, that is fine. This section should
give the reader enough context to make use of the entire series. If a
more in-depth understanding is desired, please consider reading <em>Zero
Trust Networks: Building Secure Systems in Untrusted Networks</em> by Evan
Gilman.</p><p>Zero Trust is a security model that requires strict identity
authentication and access verification on every connection at all times.
It sets the tone for a system&#x27;s security to say, &quot;this system shall
never assume the identity or access of any connection.&quot; Before the Zero
Trust security models, IT infrastructures were set up as a series of
security perimeters. Think of as a castle with walls and moats. The
castle would have a set number of entry points with guards. Once past
the guards and inside the castle, any visitors were trusted and had
access to the castle. In the real world, passing the guards is analogous
to authenticating with a machine or, at worst, connect the office
network via WiFi or ethernet cable.</p><p>Zero Trust does away with the concept of having a central castle that
assumes anyone inside is trusted. It assumes that the castle has already
been breached. That is to say, we expect attackers to already be inside
the network and for it to be a hostile environment. Any resources inside
the network should be treated as being publicly available on the
internet and must be defended. To accomplish this defense, a series of
Zero Trust pillars are defined:</p><ul><li>Never Trust, Verify - the virtue of a connection should not grant
access</li><li>Authenticate Before Connect - authentication should happen before
resources are connected to</li><li>Least Privileged Access - access should only grant connectivity to the
minimum number of resources</li></ul><p>Implementing those pillars is not a simple tweak to existing
infrastructure. The first point alone will have much of this series
dedicated to it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ziti--zero-trust">Ziti &amp; Zero Trust<a href="#ziti--zero-trust" class="hash-link" aria-label="Direct link to Ziti &amp; Zero Trust" title="Direct link to Ziti &amp; Zero Trust">â</a></h3><p>In a Zero Trust model, there needs to exist mechanisms to verify
identities such that trust can be granted. Zero Trust does not mean
there is no trust. Zero Trust means that trust is given only after
verification. Even then, that trust is limited to accessing the minimum
network resources necessary. To accomplish this, we need a network that
can force all connections through the following process.</p><ol><li>Authenticate</li><li>Request Access To A Resource</li><li>Connect To The Requested Resource</li></ol><p>This process is not the typical connection order on a network. Most
connections on a network are done in the reverse order. At first, this
may seem counter-intuitive. To help make Zero Trust and bootstrapping
trust a bit clearer, it helps to have a concrete system to use an
example. It just so happens that the Ziti software system makes a great
example!</p><p><img loading="lazy" alt="Ziti System" src="/assets/images/ziti-system-c36f11d4eaa20132bc62e5b899b00d2f.png" width="2910" height="479" class="img_ev3q"></p><p>In Ziti, all of the above steps require interacting with a Ziti
Controller. The Ziti Controller manages the Ziti overlay network by
maintaining a list of known network services, SDK clients, routers,
enrollments, policies, and much more! All of these pieces working
together to create a Ziti Network. A Ziti Network is an overlay network
<!-- -->-<!-- --> meaning it creates a virtual network on top of a concrete network.
The concrete network may be the internet, a university network, or your
own home network. Whatever it is, it is referred to as the underlay
network.</p><p>In the Ziti Network, all network resources are modeled as services in
the Ziti Controller. All services on a Ziti Network should only be
accessible via the Ziti Network for maximum effect. Network services can
be made available via a Ziti Network in a variety of manners. The
preferred method is embedding the Ziti SDK inside of applications and
servers as it provides the highest degree of Zero Trust security.
However, it is also possible to configure various overlay-to-underlay
connections to existing network services via &quot;router termination&quot; or a
particular type of application with the Ziti SDK embedded in it that
specifically deals with underlay-to-overlay translations (i.e. Ziti
Desktop Edge/Mobile Edge).</p><p>The Ziti Controller also knows about one or more Ziti Routers that form
a mesh network that can create dynamic circuits amongst themselves.
Routers use circuits to move data across the Ziti Network. Routers can
be configured to allow data to enter and exit the mesh. The most common
entry/exit points are Ziti SDKs acting as clients or servers.</p><p>Network clients wishing to attach to the network use the Ziti SDK to
first authenticate with the Ziti Controller. During authentication, the
Ziti SDK client and Ziti Controller will verify each other. Upon
successful authentication, the Ziti Controller can provide a list of
available services to dial (connect) or to bind (host) for the
authenticated SDK Client. The client can then request to dial or bind a
service. If fulfilled, a session is associated with the client and
service. This new session is propagated to the necessary Ziti Routers,
and the required circuits are created. The client is returned a list of
Ziti Routers which can be connected to in order to complete the last
mile of communication between the Ziti overlay network and the SDK
client.</p><p>This set of steps covers the pillars of the Zero Trust model! The Ziti
Controller and SDK Clients verify each other. The client cannot connect
to network resources or services until it authenticates. After
authentication, a client is given the least privilege access allowed by
only being told about and only being able to dial/bind the authenticated
identity&#x27;s assigned services. It is a Zero Trust overlay network!</p><p>How did this system come into existence? How do the Ziti SDK client and
Ziti Controller verify each other? How do the routers and controller
know to validate each other? How is this managed at scale with hundreds
of Ziti Routers and thousands of Ziti SDK clients? It seems that this is
a recursive problem. To terminate the recursion, we have to start our
system with a well-defined and carefully controlled seed of trust.</p><h1>Trust</h1><p>In software systems that require network connectivity, there are at
least two parties in the system. Generally, there are more, and in the
case of a Ziti network, there could be thousands. Between two parties,
each time a connection is made, a trust decision is made. Should this
connection be allowed? Mechanisms must be put into place to verify the
identity of the connecting party if that question is to be answered.</p><p>One mechanism that might jump out at the reader is a password or secret.
In Ziti, it would be possible to configure the Controller, Routers, and
SDK Clients with a secret. Software is easy to deploy with a secret.
Throw it into a configuration file, point the software at, and off you
go!</p><p>It is also fundamentally weak as there is only one secret in the system
necessary to compromise the entire system. In Ziti, this would mean
giving the secret to network clients that may or may not be owned by the
network operator. Also, shared secrets do not individually identify each
component, nor do they define how secrets will power other security
concerns, like encryption.</p><p>The solution can be improved. Secrets could be generated per software
component. The controller, each router, and each SDK client could have a
unique secret. This secret would then individually identity each
component! It is a significant improvement, but how does each component
verify connections? Do they challenge for the incoming connections
secret and compare it to a list? That means that a pair of systems that
need to connect must have each other&#x27;s secrets. Secret sharing will not
do! We can not be copying secrets between every machine. One machine
that is compromised would mean that many secrets are revealed!</p><p>This solution can be evolved and improved, but we do not have to do that
hard work! If we did, we would end up recreating an existing technology.
That technology is (public-key
cryptography)<!-- -->[https://en.wikipedia.org/wiki/Public-key_cryptography]<!-- -->,
and it provides everything we need.</p><p>Public-key cryptography allows each device to have a unique, secret,
private key that proves its unique identity. That private key is
mathematically tied to a public key. The public key can be used to
encrypt messages that only the private key holder can decrypt. Also, the
public key cannot be used to derive the original private key. This
functionality fits perfectly with what our distributed system needs!
Alas, public-key cryptography introduces complex behaviors, setup, and
management. In the next article, we will dive a little deeper into this
topic. For now, let us take it on faith that it will serve our needs
well.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="setting-it-up">Setting It Up<a href="#setting-it-up" class="hash-link" aria-label="Direct link to Setting It Up" title="Direct link to Setting It Up">â</a></h4><p>So we have decided that public-key cryptography is the answer. What does
that mean? What do I have to do? Let us explore what would need to be
done by a human or a piece of software automating this process. Don&#x27;t
worry if you don&#x27;t get all of this; the gist is all you need for now.
Later articles will expand upon this terminology. In fact, after reading
the later articles, consider revisiting this part.</p><p>Consider the following diagram of a &quot;mesh&quot; distributed system. This mesh
could be any type of system such as a mesh of Ziti Routers, or maybe it
is a system of sensors on an airplane. What they do does not matter.
What matters is that this system has multiple pieces of software
connecting amongst themselves. Consider what it means to accomplish this
using public-key cryptography.</p><p><img loading="lazy" alt="Mesh" src="/assets/images/mesh-329d97ab70482d5223a4d30c0263e6cb.png" width="1179" height="887" class="img_ev3q"></p><p>In the diagram above, each system needs:</p><ul><li>a key pair for client and server connections</li><li>to have the public keys of each system it is connecting to</li></ul><p>So what do we need to do? Drop into a CLI and start generating keys on
each machine. Do that by using these commands:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl ecparam -name secp256k1-genkey -param_enc explicit -out private-key.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req -new -x509 -key private-key.pem -out server.pem -days 360</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Voila - you now have a self-signed certificate! What is a self-signed
certificate? For now, let us understand it means that no other system
has expressed trust in your public certificate. In
<a href="/blog/bootstrapping-trust/part-04.certificate-authorities-and-chains-of-trust">Part 4: Certificate Authorities &amp; Chains Of Trust</a>
we will cover them in more detail.</p><p>You can repeat the above process for every piece of software in your
mesh network. Preferably, you log into each machine and generate the
private key there. Moving private keys on and off devices is a security
risk and frowned upon. For maximum security, hardware, such as
<a href="https://en.wikipedia.org/wiki/Hardware_security_module" target="_blank" rel="noopener noreferrer">Hardware Security Modules (HSMs)</a>
and <a href="https://en.wikipedia.org/wiki/Trusted_Platform_Module" target="_blank" rel="noopener noreferrer">Trusted Platform Modules
(TPMs)</a>, can be
used to store the private keys in a manner that does not make them
directly accessible.</p><p>Then you will need to copy each public certificate to every other
machine and configure your software so that it trusts that certificate.
The system will need to repeat this process any time the system adds a
piece of software. If a machine is compromised, the analogous public
certificate will need to be untrusted on every node in the mesh. Adding
or removing trust in a public certificate involves configuring software
or operating systems. There are many ways it can be implemented,
including configuration files, files stored in specific directories, and
even via configuration tools such as Windows Certificate Manager
snap-in.</p><p>This is a log of careful work to get a simple system running. Consider
what this means when adding or removing many nodes? Visiting each
machine and reconfiguring them each time is quite a bit of overhead.
There is a solution to these woes. While it is elegant on its own, it
does add complexity. Let us see how Certificate Authorities (CAs) can
help! In the next section, we will hit the highlights of CAs. For more
detail, look forward to
<a href="/blog/bootstrapping-trust/part-04.certificate-authorities-and-chains-of-trust">Part 4: Certificate Authorities &amp; Chains Of Trust</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cas--adding-complexity">CAs &amp; Adding Complexity<a href="#cas--adding-complexity" class="hash-link" aria-label="Direct link to CAs &amp; Adding Complexity" title="Direct link to CAs &amp; Adding Complexity">â</a></h4><p>A CA enables trust deferral from multiple individual certificates to a
single certificate which means that instead of trusting each
certificate, each piece of software will trust the CA. The CA will be
used to sign every public certificate our software pieces need to use.
How does &quot;signing&quot; work? We will cover that in
<a href="/blog/bootstrapping-trust/part-03.certificates">part three</a> and why it matters part in
<a href="/blog/bootstrapping-trust/part-04.certificate-authorities-and-chains-of-trust">four</a>. For
now, the basics will be provided.</p><p>Here are the high-level steps of using a CA:</p><ol><li>create a CA configuration via OpenSSL CNF files</li><li>create the CA</li><li>use the CA&#x27;s public key to sign all of the public certificates</li><li>distribute the CA&#x27;s certificate to every machine</li><li>configure the machines certificate store or configure the software</li></ol><p>For items one and two, the process can be a bit mystical. There is a
multitude of options involved in managing a CA. To perform number three,
you will need to go through the processing of creating certificate
signing requests (CSRs, see <a href="/blog/bootstrapping-trust/part-03.certificates">parts three</a> for
more detail) on behalf of the piece of software, and someone or
something will have to play the role of the CA and resolve the CSRs. The
last two steps will depend on the operating system and software being
used.</p><p>All of these actions can be done via a CLI or programmatically. You will
have to spend time and energy, making sure the options are correctly set
and learning about all the different capabilities and extensions.
Mistakes will inevitably occur. It is time-consuming to debug why a
specific public certificate is not working as intended. The tools and
systems that use the certificates are purposely vague in error messages
as not to reveal too much information to attackers.</p><p>The payoff for using CAs is having the ability to create chains of
trust. Chains of trust allow distributed systems to scale without having
to reconfigure each node every time the system grows or shrinks. With a
little more upfront cost and bookkeeping to run a CA, the system will
greatly decrease the amount of configuration required on each device.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-concerns">Further Concerns<a href="#further-concerns" class="hash-link" aria-label="Direct link to Further Concerns" title="Direct link to Further Concerns">â</a></h4><p>Once configured, there are still other concerns that need to be taken
into account. Consider the following list of events that may happen to a
CA, and it&#x27;s certificates:</p><ul><li>What happens when a certificate expires?</li><li>How does a system know not to trust a certificate anymore?</li><li>What happens when private keys need to regenerate?</li></ul><p>CAs do not automatically handle the propagation of these types of
events. CAs are files on a storage device or HSM. Issuing or revoking
certificates does not generate any kind of event without additional
software. There is also the issue of certificates expiring. That &quot;-days
360&quot;, used in the example above, puts a lifetime on each certificate.
The lifetime can be extended far into the future, but this is a bad
practice. Limiting the life span of a certificate reduces attack windows
and can be used as a trigger to adopt strong encryption.</p><p>Even if we ignore all of those concerns, who did we trust to get this
system setup? What was the seed of trust used to bootstrap trust? So
far, you could have imagined that a human was doing all of this work. In
that case, a human operator is trusted to properly configure all of the
systems - trusting them with access to all of the private keys. The seed
of trust is in that human. If this is a software system performing these
actions, that means that the system has to be trusted and most likely
have access to every other system coming online. That is workable, but
what happens when your system can have external systems request to be
added to the network? How can that be handled? How do you trust that
system in the first place? Using a secret password creates a single,
exploitable, weak point. Public-key cryptography could be put in place,
but then we are in a chicken-and-egg scenario. We are putting public-key
cryptography in place to automate public-key cryptography.</p><p>There are many caveats to bootstrapping trust. In a dynamic distributed
system where pieces of software can come and go at the whim of network
operators, the issues become a mountain of concerns. Thankfully in Ziti,
a mechanism is provided that abstracts all of these issues. To
understand how Ziti accomplishes this, we have a few more topics to
discuss. In
<a href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">part two</a>, we will
chip away at those topics by covering public-key cryptography in more
detail to understand its powers and applications.</p><hr><p>Written By: Andrew Martinez<br>
<!-- -->June 2020</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Part 2: A Primer On Public-Key Cryptography"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">Bootstrapping Trust</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-21T16:18:09.000Z" itemprop="datePublished">December 21, 2023</time> Â· <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/andrewpmartinez" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/199856?v=4" alt="Andrew Martinez" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/andrewpmartinez" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Andrew Martinez</span></a></div><small class="avatar__subtitle" itemprop="description">OpenZiti Maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-a-primer-on-public-key-cryptography">Part 2: A Primer On Public-Key Cryptography<a href="#part-2-a-primer-on-public-key-cryptography" class="hash-link" aria-label="Direct link to Part 2: A Primer On Public-Key Cryptography" title="Direct link to Part 2: A Primer On Public-Key Cryptography">â</a></h2><p>If you have read through the entire series up to here, welcome! If you
have not, please consider reading the whole series:</p><ul><li><a href="/blog/bootstrapping-trust/part-01.encryption-everywhere">Part 1: Encryption Everywhere</a></li><li><a href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">Part 2: A Primer On Public-Key Cryptography</a></li><li><a href="/blog/bootstrapping-trust/part-03.certificates">Part 3: Certificates</a></li><li><a href="/blog/bootstrapping-trust/part-04.certificate-authorities-and-chains-of-trust">Part 4: Certificate Authorities &amp; Chains Of Trust</a></li><li><a href="/blog/bootstrapping-trust/part-05.bootstrapping-trust">Part 5: Bootstrapping Trust</a></li></ul><p>It isn&#x27;t easy to talk about bootstrapping trust without covering the
basics of public-key cryptography. The reader may skip this article if
the concepts of encryption, signing, and public/private keys are
familiar. However, if not, I implore that you bear the brunt of this
article as later parts will heavily rely on it.</p><p>If you wish, you can dive into the mathematics behind it to prove it to
yourself, but I promise, no math here. When necessary, I will wave my
hands at it, point into the distance, and let the reader journey out.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="keys">Keys<a href="#keys" class="hash-link" aria-label="Direct link to Keys" title="Direct link to Keys">â</a></h3><p>Keys are blobs of data containing rather large numbers. They can be
stored anywhere data can be stored, but are commonly stored as files. A
set of public and private keys is referred to as a &quot;key set&quot; or &quot;key
pair.&quot;</p><p>Within a key pair, there is only one private key and one public key. The
two keys are mathematically entangled, given a particular function and
its parameters. Today, those functions and parameters are generally
elliptical curves and are the basis of a &quot;trapdoor function.&quot; Trapdoor
functions are attractive to the cryptographically inclined for two main
reasons:</p><ol><li>they make it easy to encrypt with one key of a key pair and decrypt
with the other.</li><li>one key cannot be derived from the other</li></ol><p>Of the two keys, the private key is the most important. It must be kept
tucked away from prying eyes and attackers. Some secure environments
store the private key in hardware such as
<a href="https://en.wikipedia.org/wiki/Hardware_security_module" target="_blank" rel="noopener noreferrer">Hardware Security Modules (HSMs)</a>
or
<a href="https://en.wikipedia.org/wiki/Trusted_Platform_Module" target="_blank" rel="noopener noreferrer">Trusted Platform Modules (TPMs)</a>.
Mobile devices, such as laptops and smartphones, use hardware technology
similar to TPMs. Apple has its Secure Enclave, and Android has its
Keymaster Hardware Abstraction Layer. The goal of all of these pieces of
hardware is to keep sensitive secrets (e.g., private keys) safe. The
fact that an entire industry of embedded hardware has been developed to
keep private keys safe should tip the reader off to how important they
are.</p><p>As stated above, these two keys have some impressive capabilities. It is
not possible to derive one from the other. This allows the public key to
be handed out freely without compromising the private key. Also, both
keys can generate encrypted data that only the other key can decrypt.
More clearly:</p><ol><li>Anyone with the public key can encrypt data only the private key
holder can decrypt</li><li>Anyone with the public key can decrypt data from the private key
holder</li></ol><p>Number one can succinctly be called &quot;Public Key Encryption&quot; and number
two &quot;Private Key Encryption.&quot; This article explores the merits of both.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="public-key-encryption">Public Key Encryption<a href="#public-key-encryption" class="hash-link" aria-label="Direct link to Public Key Encryption" title="Direct link to Public Key Encryption">â</a></h4><p>From the list above, number one is what most people think of as
&quot;encryption.&quot; It is &quot;secure&quot; as it allows anyone with the widely
available public key to send messages only the private key holder can
read. This property ensures that communication from the public key
holder to the private key holder is being read exclusively by the
intended target.</p><p>There is quite a bit of pressure to keep the private key extremely safe.
Whoever holds the private key, has a guaranteed identity that is tied to
and verifiable by the public key. It is verifiable because if one can
use the public key to encrypt data, only the private key holder can
decrypt it. This fact means that data can be encrypted and sent that
coordinates on an additional secret. Since only the private key holder
can decrypt the data to see this second level secret, future
communication can use the new secret to encrypted and verify traffic in
both directions. This additional exchange is roughly how part of the TLS
negotiation works for HTTPs. TLS, and by proxy HTTPS, use other
technologies and strategies to provide an incredible security
proposition.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="private-key-encryption">Private Key Encryption<a href="#private-key-encryption" class="hash-link" aria-label="Direct link to Private Key Encryption" title="Direct link to Private Key Encryption">â</a></h4><p>For private key encryption, the same principles apply as with public key
encryption with the roles reversed. The private key encrypts data only
the public key can decrypt. On the surface, this seems absurd. When the
server encrypts data with its private key, the public key can decrypt
it. The public key is not protected and expected to be widely available.
It seems as if private key encryption is nearly useless as everyone can
read it!</p><p>Except it isn&#x27;t. Private key encryption verifies the identity of the
private key holder. The public key cannot interact with anyone else.
Additionally, this property allows us to generate encrypted data that
could only have come from the private key holder. If that data happens
to be small and describe another document, we call that a &quot;digital
signature&quot; or &quot;signature&quot; for short.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="digital-signatures">Digital Signatures<a href="#digital-signatures" class="hash-link" aria-label="Direct link to Digital Signatures" title="Direct link to Digital Signatures">â</a></h3><p>Digital signatures are similar to handwritten ones used to sign legal
documents and checkbooks, but with a significant advantage. They
validate that a document has not been altered since it was signed. With
today&#x27;s computer&#x27;s graphical abilities, the nefarious can forge images
and handwritten signatures. That puts handwritten signatures at a
significant disadvantage. So how does this work?</p><p>The data that will be signed can be anything. What it represents is not
important. It can be text, JSON, an image, a PDF, or anything at all!
That data is processed by a one-way
<a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function" target="_blank" rel="noopener noreferrer">cryptographic hashing algorithm</a>,
such as SHA-256. This process is idempotent, meaning running it
repeatedly on the same data, parameters, and hashing algorithm gives the
same result. The output of this process is a hash, a string of
characters that uniquely identifies the input data. With sufficiently
large input data, the hash is much shorter than the input data as the
hash size is usually fixed length.</p><p>For example, here is the Ziti logo:</p><p><img loading="lazy" alt="Ziti" src="/assets/images/ziti-c5f4e9ffa46a5294f79389ed04b812ea.png" width="839" height="839" class="img_ev3q"></p><p>This logo&#x27;s file can be hashed using SHA-256 via the <code>sha256sum</code> command
commonly found on Linux.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$&gt; sha256sum ziti.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c3a6681cc81f9c0fa44b3e2921495882c55f0a86c54cd60ee0fdc7d200ad26db  ziti.png</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That long string &quot;c3a....6db&quot; is the hash of that file! The string is 64
characters long and is comprised of hex characters (a base 16 numbering
system of 0-9 and a-f). Each character takes four bits to represent (4^2
= 16). Since there are 64 characters at 4 bits each we have: 64 x 4 =
256<!-- -->.<!-- --> This is where SHA-256 gets its name. SHA-256 is a fixed-length
cryptographic hashing algorithm who&#x27;s output is 256 bits in length.</p><p>The hash itself is not encryption. It is &quot;hashing.&quot; Hashing of this
nature is not reversible while encryption is. For cryptographic hashing,
it is impracticable to have two similar sets of data that have the same
function that produces the same hash. In essence, the hash uniquely
represents the data: all of it! Changing even a single character would
generate a different hash.</p><p>After hashing a data or document, the private key holder can encrypt the
hash to generate a signature. This process provides the following truths
when working with the signature:</p><ul><li>the private key is the only key capable of producing its signature of
the data&#x27;s hash</li><li>the public key can validate the signature given the data and hashing
algorithm used</li></ul><p>Verifying a signature a straightforward process:</p><ul><li>Use the public key to decrypt the signature to reveal the original
hash</li><li>Use the hashing algorithm that was used initially on the data,
recreate the hash independently</li><li>Compare the two hashes, and if they are the same the signature is
valid</li></ul><p>Signing data is incredibly powerful. It allows a private key holder to
state that data was approved by them and not altered. It is also
publicly verifiable to anyone with the document, signature, and public
key. This allows many decentralized approaches to sharing data that can
have its source and content verified.</p><p>Bearer tokens are an example of the power of signatures. Bearer tokens
are a document that is signed by a trusted authentication system and
contain data that provides information about the client presenting the
token. Signing the token ensures that the content of the token has not
been changed and has been endorsed by a trusted system. An example of a
bearer token is a
<a href="https://en.wikipedia.org/wiki/JSON_Web_Token" target="_blank" rel="noopener noreferrer">JSON Web Token (JWT)</a></p><p>A JWT specifies the format of the bearer token as a header, payload, and
signature using JSON. A client can then present a JWT to any system
which can then verify that the contents are valid and from a trusted
identity. As long as the signature is valid, the JWT can grant access to
the client presenting it based on whatever information is inside the
JWT.</p><h1>Closing</h1><p>This article should have shed light on public-key cryptography by
explaining the roles of the public and private keys. It should have also
provided a glimpse at the power of encryption and digital signatures. In
<a href="/blog/bootstrapping-trust/part-03.certificates">part three</a> we will see how key pairs can
be combined with certificates!</p><hr><p>Written By: Andrew Martinez<br>
<!-- -->June 2020</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Part 3: Certificates"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/bootstrapping-trust/part-03.certificates">Bootstrapping Trust</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-21T16:18:09.000Z" itemprop="datePublished">December 21, 2023</time> Â· <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/andrewpmartinez" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/199856?v=4" alt="Andrew Martinez" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/andrewpmartinez" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Andrew Martinez</span></a></div><small class="avatar__subtitle" itemprop="description">OpenZiti Maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-certificates">Part 3: Certificates<a href="#part-3-certificates" class="hash-link" aria-label="Direct link to Part 3: Certificates" title="Direct link to Part 3: Certificates">â</a></h2><p>If you have read through the entire series up to here, welcome! If you
have not, please consider reading the whole series:</p><ul><li><a href="/blog/bootstrapping-trust/part-01.encryption-everywhere">Part 1: Encryption Everywhere</a></li><li><a href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">Part 2: A Primer On Public-Key Cryptography</a></li><li><a href="/blog/bootstrapping-trust/part-03.certificates">Part 3: Certificates</a></li><li><a href="/blog/bootstrapping-trust/part-04.certificate-authorities-and-chains-of-trust">Part 4: Certificate Authorities &amp; Chains Of Trust</a></li><li><a href="/blog/bootstrapping-trust/part-05.bootstrapping-trust">Part 5: Bootstrapping Trust</a></li></ul><p>In the series, we have covered public-key cryptography, where we learned
about public keys, private keys, and their uses for encryption and
signing. Using keys to sign data will play an essential role in this
article. It is vital that the reader understand that signatures verify
both the content of the data and its source. For a refresher, see
<a href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">part two</a> of this
series.</p><p>This article covers how certificates and certificate authorities (CAs)
work as &quot;trust anchors.&quot; When a CA is a trust anchor, it means that a
system can trust the CA to sign certificates that it can, in turn,
trust. Throughout this entire article, &quot;trusting certificates&quot; is
mentioned. Trusting a certificate (CA or otherwise) is a software or
operating system configuration process. This configuration tells the
system that the specified certificates are trustworthy in the eyes of
the operator.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="certificates">Certificates<a href="#certificates" class="hash-link" aria-label="Direct link to Certificates" title="Direct link to Certificates">â</a></h3><p>Part two of this series covered keys, both public and private, but did
not mention certificates. It is common to hear &quot;certificate&quot; used
interchangeably with &quot;public key&quot; and, sometimes, &quot;private key.&quot; A
certificate must have the public key inside of it. Some storage formats
allow certificates to be stored along with the matching private key.
One example of this is PFX files. PFX files, which are PKCS#12 archives,
are also sometimes generically referred to as a &quot;certificates&quot;. In this
article &quot;certificate&quot; will always mean an x509 certificate that contains
only the public key.</p><p>Certificates are a simple concept, but years of expansions and
extensions have added to them and can be daunting uninitiated when you
get into the nitty-gritty details. This article will strive to sit above
that detail. If you venture into the realm of generating certificates,
using OpenSSL and its configuration files, it can be a cumbersome
experience to wade through. There are many great articles and tutorials
available to get you started.</p><p>For this article, the word &quot;certificate&quot; will mean an &quot;x509
Certificate&quot;. x509 is a public standard and is the de-facto standard for
software systems dealing with public-key cryptography. There are other
formats, but they are usually environment-specific, such as Card
Verifiable Certificates. x509 good enough for general purpose use on
most systems.</p><p>So, what is a certificate? It is yet another blob of data that is
specially formatted. It can be stored anywhere data can be stored but is
usually a file. For this conversation, we will focus on the following
subset of information that a certificate contains:</p><ul><li>Subject information<ul><li>A public key</li><li>Distinguished Name</li></ul></li><li>Issuer Information</li><li>Validity Period</li><li>Usage/Extensions</li><li>Signatures</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="subject-information">Subject Information<a href="#subject-information" class="hash-link" aria-label="Direct link to Subject Information" title="Direct link to Subject Information">â</a></h4><p>Certificates contain more than keys. The Distinguished Name (DN) are
text fields. They are useful mainly to humans to know what/who owns a
certificate. It is sometimes used by software as display information or
for comparison checks. Since humans provide the DN values or configure
software with values, it is not always distinguishing. DN values have an
alternate name: relatively distinguished names.</p><p>Related to the Subject DN is the Issuer Information. The Issuer
Information is the subject of the certificate that issued the
certificate. Because of this, both the issuer information has similar
values to the subject DN. Both can include the following information:</p><ul><li>CN - common name - a name</li><li>SN - surname</li><li>SERIALNUMBER - a number that is usually unique per certificate issuer,
but not always</li><li>C - country</li><li>L - locality name</li><li>ST or S - state or province</li><li>STREET - street address</li><li>O - organization name</li><li>OU - organizational unit</li><li>T - title</li><li>G or GN - given name</li><li>E - email address</li><li>UID - user id</li><li>DC - domain component</li></ul><p>Do not worry about memorizing that list. Simply knowing they exist and
that they may or may not matter is good enough for now. If the reader is
wondering when they might matter, well, that is generally when the
system you are using complains about them.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="validity-period">Validity Period<a href="#validity-period" class="hash-link" aria-label="Direct link to Validity Period" title="Direct link to Validity Period">â</a></h4><p>The Validity Period specifies two points in time from when the
certificate is valid. Before and after this window of time, the
certificate is invalid and should not be trusted. Validity periods
should be as small as possible to fit their use case. Shorter periods
reduce the window of time that compromised private key can remain useful
for an attack. The cost of this is overhead reissuing certificates as
they reach the end of their validity period.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="usageextensions">Usage/Extensions<a href="#usageextensions" class="hash-link" aria-label="Direct link to Usage/Extensions" title="Direct link to Usage/Extensions">â</a></h4><p>Usage/Extension Data is interesting because it can limit what roles a
certificate fulfills. Depending on the system, this may be adhered to or
not. Some examples of usage that are common to see:</p><ul><li>key usage: client authentication, server authentication, signatures,
etc.</li><li>Subject Alternate Names (SANs)<ul><li>Limits what IP address, email address, domain name, etc. the
certificate can be associated with</li></ul></li><li>Certificate Authority (CA) flag</li><li>and more</li></ul><p>This series will not dive into the details of these usages. However, it
is essential to be aware of them and that they can affect the roles a
certificate can fulfill.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="signatures">Signatures<a href="#signatures" class="hash-link" aria-label="Direct link to Signatures" title="Direct link to Signatures">â</a></h4><p>The signature section of a certificate is a list of signatures from
other entities that trust this certificate. A certificate that signs
itself is a &quot;self-signed certificate.&quot; Self-signed certificates must be
individually trusted as no other certificate has expressed trust in it
by signing it. Self-signed certificates are sometimes used for testing
purposes as they are easy to create. They are also used as Root
Certificate Authorities (root CAs).</p><p>Each signature on a certificate is the result of taking the contents of
the certificate (without signatures), one-way hashing it, and then
encrypting the hash with the signator&#x27;s private key. The result is
appended to the end of the signature list. During this process, the
public certificate moves between systems to be signed.</p><p>The movement of the public certificate between systems is facilitated by
Certificate Signing Requests (CSRs). CSRs can be transmitted
electronically as files or as a data stream to the signer. CSRs contain
only the public information of a certificate and a signature from the
certificate&#x27;s private key. Since CSRs only contain public information,
they are not considered sensitive. The signature in a CSR allows the
signer to verify that the CSR is from the subject specified in the CSR.
If the signature is valid, the signator processes the CSR, and the
result is a newly minted certificate with an additional signature.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">â</a></h3><p>Certificates are keys, usually public ones, with additional metadata
that adds conventions and restrictions around certificate usages. They
provide a place for signatures to resides and, through CSRs, provide a
vehicle to request additional signatures. Certificates are useful
because they package all of these concerns into a neat single file. In
<a href="/blog/bootstrapping-trust/part-04.certificate-authorities-and-chains-of-trust">part four</a>, we
will explore how to create a formidable chain of trust by linking
multiple certificates together.</p><hr><p>Written By: Andrew Martinez<br>
<!-- -->June 2020</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Part 4: Certificate Authorities &amp; Chains of Trust"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/bootstrapping-trust/part-04.certificate-authorities-and-chains-of-trust">Bootstrapping Trust</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-21T16:18:09.000Z" itemprop="datePublished">December 21, 2023</time> Â· <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/andrewpmartinez" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/199856?v=4" alt="Andrew Martinez" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/andrewpmartinez" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Andrew Martinez</span></a></div><small class="avatar__subtitle" itemprop="description">OpenZiti Maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-4-certificate-authorities--chains-of-trust">Part 4: Certificate Authorities &amp; Chains of Trust<a href="#part-4-certificate-authorities--chains-of-trust" class="hash-link" aria-label="Direct link to Part 4: Certificate Authorities &amp; Chains of Trust" title="Direct link to Part 4: Certificate Authorities &amp; Chains of Trust">â</a></h2><p>If you have read through the entire series up to here, welcome! If you
have not, please consider reading the whole series:</p><ul><li><a href="/blog/bootstrapping-trust/part-01.encryption-everywhere">Part 1: Encryption Everywhere</a></li><li><a href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">Part 2: A Primer On Public-Key Cryptography</a></li><li><a href="/blog/bootstrapping-trust/part-03.certificates">Part 3: Certificates</a></li><li><a href="/blog/bootstrapping-trust/part-04.certificate-authorities-and-chains-of-trust">Part 4: Certificate Authorities &amp; Chains Of Trust</a></li><li><a href="/blog/bootstrapping-trust/part-05.bootstrapping-trust">Part 5: Bootstrapping Trust</a></li></ul><p>This article makes implicit heavy use of
<a href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">part 2</a> and
<a href="/blog/bootstrapping-trust/part-03.certificates">part 3</a> of this series.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="root--intermediate-certificate-authorities-cas">Root &amp; Intermediate Certificate Authorities (CAs)<a href="#root--intermediate-certificate-authorities-cas" class="hash-link" aria-label="Direct link to Root &amp; Intermediate Certificate Authorities (CAs)" title="Direct link to Root &amp; Intermediate Certificate Authorities (CAs)">â</a></h3><p>Not all certificates are the same! Certificates have different
capabilities depending on their usage attributes and extensions. The
previous article in this series mentioned a few of those attributes and
extensions. Two of those were <code>clientAuth</code>, for client certificates, and
<code>serverAuth</code>, for server certificates, which play an essential role in
how a certificate is used during network authentication negotiations.
These roles are crucial, as they are a contract for what attributes and
extensions should be included in the certificate to make it useful. For
example, a server certificate usually finds it useful to include Subject
Alternate Names (SANs). A SAN can be used to tie a certificate to a
specific domain name (like ziti.dev). However, a client certificate will
not have use for those same fields.</p><p>The roles of certificates and the attributes/extensions they have are
not always strictly followed. Some systems, such as web browsers,
require SANs on a server certificate. That wasn&#x27;t always the case.
Before that, the Common Name field in the subject information contained
the domain name. Some systems still rely on that convention.</p><p>Another type of certificate is a Certificate Authority (CA) certificate.
A CA is a key pair with a certificate that has a unique purpose: to sign
other certificates. CA certificates have a special CA flag set to
&quot;true.&quot; This flag alone does not grant the CA certificate any power, but
if a system trusts that CA, it then allows that system to trust any
certificate that CA has signed. As mentioned in previous parts of this
series, trusting a CA is a software or operating system configuration
process. This process can be done in multiple ways depending on the
system: adding it to a store, a specific folder, or adding lines to a
configuration file.</p><p>Your operating system, right now, has its own set of trusted CAs. Most
operating systems come with a default list installed and maintained by
your OS developer. Over time this list is added to and removed from as
trust is granted or withdrawn. Some pieces of software come with a list
of CAs that are used instead of or in addition to the OS&#x27;s CAs. The
power of a CA comes not by its creation but by it being trusted.</p><p>CAs come in two flavors: Root CAs and Intermediate CAs. Root CAs are the
egg or the chicken (depending on your viewpoint) of the CA trust
chicken-and-egg problem. Trust for CAs has to start somewhere. With CAs,
it is the Root CA. A Root CA can sign certificates that are themselves
CAs as well. Those certificates represent Intermediate CAs. Layers of
CAs starting with a root and adding intermediates along the way allows
the private key for the Root CAs to be kept in a highly secure
environment, which is not convenient to use for signing. This security
means that the Root CA has a far less likely chance of having its
private key compromised. Intermediate CAs are put into less secure
environments and, if compromised, can be revoked. Trust is usually put
into the Root CA, and since it was not compromised can remain trusted.
Compromised intermediate CAs can be blacklisted.</p><p>Running a public CA is serious business if you wish to be publicly
trusted. The organizations running a CA have to have strict protocols
that verify the security and safe handling of the CAs private keys. If
the private key is compromised, it can be used to sign other
certificates for malicious intents. Any system that trusted the
compromised CA will now trust any maliciously signed certificates. This
will compromise all certificates signed by that CA.</p><p>Public CAs are maintained by organizations such as DigiCert, Let&#x27;s
Encrypt, and others. Anyone can create private CAs. The only difference
is that the number of systems that trust a private CA is much smaller
than that of a public one. CAs are a cornerstone of bootstrapping trust.
Trusting the proper CAs can grant trust to a large number of systems.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="chains-of-trust--pkis">Chains of Trust &amp; PKIs<a href="#chains-of-trust--pkis" class="hash-link" aria-label="Direct link to Chains of Trust &amp; PKIs" title="Direct link to Chains of Trust &amp; PKIs">â</a></h3><p><a href="/blog/bootstrapping-trust/part-03.certificates">Part three</a> of this series introduced that
certificates self-sign or sign another certificate. Certificates are
usually signed via Certificate Signing Requests (CSRs). A certificate
signing itself is called a &quot;self-signed certificate&quot; and is an indicator
of it being a root CA if the CA flag is also set to true. A root CA can
sign other certificates that also have the CA flag set to true. Those
types of certificates are intermediate CAs. Any CA, root or
intermediate, that fulfills a CSR and signs the enclosed certificate
will generate a non-CA certificate as long as the CA flag is false.
These certificates are &quot;leaf certificates.&quot;</p><p>The term Public Key Infrastructure (PKI) is used to describe all of the
outputs that are generated when a CA is created. That includes the root,
intermediates, and leaf certificates. It also optionally includes all of
the systems, processes, procedures, and data used to manage them. For
the purpose of this article, and simplicity, let us stick to the
certificates only.</p><p>Consider the following PKI setup:</p><ul><li>Two root CAs:<ul><li>Root A</li><li>Root B</li></ul></li><li>The root CAs each sign an intermediate CA via CSR:<ul><li>Intermediate A</li><li>Intermediate B</li></ul></li><li>A server wishes to have a certificate to have Root A&#x27;s trust extended
to it.<ul><li>A key pair is generated</li></ul></li><li>A CSR is created and submitted to Intermediate A to sign</li><li>The CSR is fulfilled.<ul><li>Server Cert A is created and signed by Intermediate A</li></ul></li></ul><p>Visually this would appear as follows:</p><p><img loading="lazy" alt="Chains" src="/assets/images/chains-05f3e840c1ce1d197e14b93538129e8d.png" width="1152" height="1484" class="img_ev3q"></p><p>This PKI has two chains of trust: Chain A and Chain B. They are called
chains because the signatures link the certificates together. Root A has
signed Intermediate A&#x27;s certificate and Intermediate A has signed Server
A&#x27;s certificate. Programmatically we can traverse these signatures and
verify them using the public certificates of each signatory. Trusting
Root A will trust Server A.</p><p>The second chain, Chain B, does not sign any of the certificates on
Chain A. As expected, Trusting either of the CAs from Chain B does not
grant any trust to the certificates on Chain A. Chain B highlights the
fact that any system may have multiple chains of trust that do not
interact in any fashion.</p><p>Returning to Chain A, trusting Intermediate A designates it as a &quot;trust
anchor.&quot; Any certificate can be a trust anchor. The certificate used as
a trust anchor determines which certificates will additionally be
trusted. A leaf certificate as a trust anchor only trusts that one
certificate. Trusting a CA trusts all certificates that it has signed
itself or any of its intermediates. In the diagram above, trust only
flow downward.</p><ul><li>Trusting Server Cert A will only trust that one server certificate</li><li>Trusting Intermediate A will trust Server Cert A and any other
certificate it signs</li><li>Trust Root A will trust Intermediate A and Server Cert A and any other
certificate Root A signs (intermediate CA or not) and in turn, any of
the certificates they sign</li></ul><p>Trusting a CA that has signed many certificates allows public
certificate trust to scale. This is how trust scales for web traffic.
Companies like DigiCert, IdenTrust, GoDaddy, etc. have their root CA or
one of their large intermediate CAs trusted. Those CAs sign certificates
for websites. All of our devices trust those website certificates
because the CA has signed them.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="distributed-systems--cas">Distributed Systems &amp; CAs<a href="#distributed-systems--cas" class="hash-link" aria-label="Direct link to Distributed Systems &amp; CAs" title="Direct link to Distributed Systems &amp; CAs">â</a></h3><p>The goal for any private distributed system should be to have
certificates verified on both sides: clients verify servers and vice
versa. This behavior is a tenant of Zero Trust - do not trust, verify.
Verification should be done on every connection before any data
exchange. Over TLS, which secures HTTPS, this would be &quot;mutual TLS&quot; or
&quot;mTLS.&quot; Most public websites do not require mTLS. Instead, they use TLS
with the client validating the server. For public web traffic, the
server wishes to be trusted widely. The reverse is not necessary. If it
is, websites use an additional form of authentications, like usernames
and passwords, to verify the client&#x27;s identity. Public key cryptography
is a stronger authentication mechanism, but it is also difficult for the
general public to set up, manage, and maintain.</p><p>The same is true for distributed systems. Most don&#x27;t secure anything at
all or only verify servers. It is inherently insecure and can cause
issues depending on the setup of the system. Ziti is a distributed
system that abstracts away this security setup for both its internal
routers and client SDKs. This setup allows application-specific
networking with strong identity verification, powerful policy
management, flexible mesh routing, and more. The goal of this series is
to focus on bootstrapping trust. So in the
<a href="/blog/bootstrapping-trust/part-05.bootstrapping-trust">last article</a> we will come full
circle and see how all of this relates to bootstrapping trust for Zero
Trust networks.</p><hr><p>Written By: Andrew Martinez<br>
<!-- -->June 2020</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Part 5 Bootstrapping Trust"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/bootstrapping-trust/part-05.bootstrapping-trust">Bootstrapping Trust</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-21T16:18:09.000Z" itemprop="datePublished">December 21, 2023</time> Â· <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/andrewpmartinez" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/199856?v=4" alt="Andrew Martinez" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/andrewpmartinez" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Andrew Martinez</span></a></div><small class="avatar__subtitle" itemprop="description">OpenZiti Maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-5-bootstrapping-trust">Part 5 Bootstrapping Trust<a href="#part-5-bootstrapping-trust" class="hash-link" aria-label="Direct link to Part 5 Bootstrapping Trust" title="Direct link to Part 5 Bootstrapping Trust">â</a></h2><p>If you have read through the entire series up to here, welcome! If you
have not, please consider reading the whole series:</p><ul><li><a href="/blog/bootstrapping-trust/part-01.encryption-everywhere">Part 1: Encryption Everywhere</a></li><li><a href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">Part 2: A Primer On Public-Key Cryptography</a></li><li><a href="/blog/bootstrapping-trust/part-03.certificates">Part 3: Certificates</a></li><li><a href="/blog/bootstrapping-trust/part-04.certificate-authorities-and-chains-of-trust">Part 4: Certificate Authorities &amp; Chains Of Trust</a></li><li><a href="/blog/bootstrapping-trust/part-05.bootstrapping-trust">Part 5: Bootstrapping Trust</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ziti">Ziti<a href="#ziti" class="hash-link" aria-label="Direct link to Ziti" title="Direct link to Ziti">â</a></h3><p>In this series of articles, we are exploring bootstrapping trust, what
that means, and how it enables Zero Trust security methodologies. Ziti
provides a method to bootstrap trust via its enrollment process. For
Ziti, the enrollment process is bootstrapping trust. This trust must be
in place as all connections in Ziti require verification. All identities
in Ziti have a key pair that identifies that individual. The enrollment
process abstracts the steps of setting up keys, certificates, CSRs, CAs,
and deploying them to the proper locations. In addition, the Ziti SDKs
can be embedded within any application and enroll with a Ziti network in
the exact same fashion to bootstrap trust as part of Ziti&#x27;s Zero Trust
model.</p><p>Ziti has a concept called the &quot;Edge.&quot; The Edge is a set of software
features that sit on top of the &quot;Fabric.&quot; The Fabric is the core of each
Ziti component, and it provides long haul mesh routing while the Edge
focuses on enrolling Ziti components, managing access via policies, and
maintaining the trust necessary to provide the foundation of a Zero
Trust network without the hassle of setting it up yourself. Together
they are a powerful combination of optimized long haul routing and trust
management.</p><p><img loading="lazy" alt="Fabric Edge" src="/assets/images/fabric-edge-debb01e86651a5d95f9260e8cbd13ecc.png" width="500" height="365" class="img_ev3q"></p><p>A small scale example Ziti system appears as follows:</p><p><img loading="lazy" alt="Ziti System" src="/assets/images/ziti-system-c36f11d4eaa20132bc62e5b899b00d2f.png" width="2910" height="479" class="img_ev3q"></p><p>Ziti Edge has the concepts of identities for endpoint SDKs and routers.
Both require certificates signed by a trusted CA. Ziti can generate the
PKI necessary to manage that trust. The PKI and its CAs will form the
backbone of the trust system that Ziti will deploy for you. In the
system diagram above, the Ziti Controller will manage an intermediate CA
and a secure enrollment process that will bootstrap trust for each
router and SDK. After bootstrapping trust, the controller will maintain
data to manage the entire life cycle of the certificates it generates.
This life cycle encompasses all the concerns from part one of this
series, including bootstrapping, revoking, renewing, and rotating keys.</p><p>So let us review the components a Ziti Controller must have to function:</p><ol><li>A CA (intermediate preferred)</li><li>A server certificate generated for the Controller&#x27;s IP/hostname/etc.
Signed by the CA or a public CA</li><li>A Ziti Controller configured and ready to run</li></ol><p>This article series has touched on items one and two, but not three. For
information on how to configure a Ziti Controller refer to the Ziti
documentation repository on Github. You will also find details on how to
use the Ziti CLI to generate the PKI necessary to start a Ziti network.
However, here is a simple command that will help get the controller
started.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> ziti pki create ca test1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ziti pki create server --dns myserver.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enrollment">Enrollment<a href="#enrollment" class="hash-link" aria-label="Direct link to Enrollment" title="Direct link to Enrollment">â</a></h2><p>Once a Ziti Controller is up and running, it is possible to create a new
identity and enroll it. Behind the scenes, many things happen, but for
now, let us focus on what an administrator would have to perform.</p><ol><li>Authenticate via the Ziti CLI, Ziti Admin Console (ZAC), or Edge REST
API</li><li>Issue a request to create a new identity for an SDK or router</li><li>Receive an enrollment JWT Use the JWT on the enrolling device/server
to enroll</li></ol><p>In those steps, we have performed many complex interactions.</p><ul><li>The enrolling identity:<ul><li>validated the enrollment JWT cryptographically</li><li>validated the Ziti Controller as a suitable trust anchor
cryptographically</li><li>bootstrapped its trust pool of CAs as additional trust anchors over
a secure connection</li><li>generated a key pair</li><li>generated a CSR</li></ul></li><li>The controller has:<ul><li>asserted its identity cryptographically</li><li>asserted the validity of the enrolling identity</li><li>provided a CA store of trust anchors</li><li>fulfilled the CSR request for the identity</li></ul></li></ul><p>All of these items are performed making no assumptions and securely
verifying each step. This process does not suffer from man-in-the-middle
attacks. It provides many benefits! Below is a detailed image of each
step of the enrollment process.</p><p><img loading="lazy" alt="Enrollment Full" src="/assets/images/enrollment-full-a4de028f2d23b9d3139ebff763361e7c.png" width="1906" height="913" class="img_ev3q"></p><p>Let&#x27;s break those steps down:</p><ol><li>Via the Ziti CLI, ZAC, or Edge REST API the admin authenticates and
requests to create an identity</li><li>The admin receives a JWT that is signed by the controller and is
cryptographically verifiable. The JWT contains all the information
for the enrolling device/server to contact the controller and verify
its identity. It also includes a secret enrollment token.</li><li>The JWT is given to the enrolling device</li><li>The device parses the JWT, verifies all the information is present to
enroll</li><li>The device retrieves the public certificate from the controller at
the address specified in the JWT</li><li>The device confirms that the server is, in fact, the owner of the
private key for that certificate</li><li>The device uses the retrieved certificate to verify the signature on
the JWT</li><li>Verifies content has not changed</li><li>Verifies the issuing server is the server it is communicating with</li><li>Makes a secure connection to the server and requests the CAs to
trust</li><li>The enrolling identity generates a key pair, if necessary, and a
CSR. The CSR is submitted in a request with the JWT&#x27;s enrollment
token.</li><li>The controller verifies the CSR, verifies the enrollment token,
verifies the client connection, and then returns the necessary
signed certificates.</li></ol><p>At the end of the process, which took four simple human steps, but
numerous cryptographically secure software steps, the controller now has
a record of the certificates issued to a specific identity. That
identity now has certificates that can be used to make connections to
other enrolled Ziti components. All components in the system can verify
the identity of any other Ziti component. At every step, every link is
verified. No individual piece of software blindly trusts any other for
inbound or outbound connections. Trust has been successfully
bootstrapped! Now we enter a maintenance window where trust has to be
verified continuously and maintained. The enrolled identity can now
interact with the Ziti Controller to either function as a Ziti Router or
as Zero Trust network client.</p><h1>Conclusion</h1><p>Thank you for reading this far! If you completed the entire series, I
hope it has been helpful. Zero Trust is a complicated topic, and it
requires a serious foundation in bootstrapping trust to get right.
Hopefully, this series starts you on your way. If you have time, please
checkout (Ziti)<!-- -->[https://github.com/openziti]<!-- -->! It is the Zero Trust
network overlay solution that I have personally worked on and was the
inspiration for this series.</p><hr><p>Written By: Andrew Martinez<br>
<!-- -->June 2020</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Introduction"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/golang-aha/article">Golang Aha! Moments</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-21T16:18:09.000Z" itemprop="datePublished">December 21, 2023</time> Â· <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/plorenz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/777993?v=4" alt="Paul Lorenz" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/plorenz" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Paul Lorenz</span></a></div><small class="avatar__subtitle" itemprop="description">OpenZiti Maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">â</a></h2><p>As we (the OpenZiti team) progressed on our Go journey, we&#x27;ve stumbled on various
obstacles, settled on some best practices and hopefully gotten better at writing Go
code. This document is meant to share some of the &#x27;Aha!&#x27; moments where we overcame
stumbling blocks and found solutions that sparked joy.
This is intended both for new team members and for anyone in the go community who
might be interested. We&#x27;d be very happy to hear from others about their own &#x27;aha&#x27;
moments and also how the solutions presented strike your sensibilities.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="channels">Channels<a href="#channels" class="hash-link" aria-label="Direct link to Channels" title="Direct link to Channels">â</a></h2><p>Channels are a core feature of go. As is typical of go, the channel API is small and
simple, but provides a lot of power. </p><p>If you haven&#x27;t read it yet, Dave Cheney&#x27;s <a href="https://dave.cheney.net/2014/03/19/channel-axioms" target="_blank" rel="noopener noreferrer">Channel Axioms</a>
is worth a look.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="closing-channels">Closing Channels<a href="#closing-channels" class="hash-link" aria-label="Direct link to Closing Channels" title="Direct link to Closing Channels">â</a></h2><p>Closing channels can be complicated. On the reader side things are generally uncomplicated.
A closed channel read will return immediately with the zero value and flag indicating that
it is closed.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ch := make(chan interface{}, 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ch &lt;- &quot;hello&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val, ok := &lt;- ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt.Printf(&quot;%v, %v\n&quot;, val, ok) // prints hello, true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close(ch)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val, ok = &lt;- ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt.Printf(&quot;%v, %v\n&quot;, val, ok) // prints &lt;nil&gt;, false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On the writer side, things can be more complicated. If you only have a single writer,
it can be responsible for closing the channel. This notifies any blocker readers that
the channel is closed. However, if there are multiple writers, this won&#x27;t work. Writing
to a closed channel will cause a panic. Closing an already closed channel will also
cause a panic. So, what do we do?</p><p>The main thing is to realize that we don&#x27;t have to close the channel. We only have to
make sure the readers and writers are safely notified that they should stop trying to
use the channel. For this, we can use a second channel.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;github.com/openziti/foundation/util/concurrenz&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;github.com/pkg/errors&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Queue struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ch          chan int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    closeNotify chan struct{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    closed      concurrenz.AtomicBoolean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Queue) Push(val int) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case self.ch &lt;- val:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case &lt;-self.closeNotify:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return errors.New(&quot;queue closed&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Queue) Pop() (int, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case val := &lt;-self.ch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return val, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case &lt;-self.closeNotify:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return 0, errors.New(&quot;queue closed&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Queue) Close() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if self.closed.CompareAndSwap(false, true) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        close(self.closeNotify)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If there are several entities which all need to shutdown together, they can even
share a <code>closeNotify</code> channel.</p><p>A variation on this would let readers drain the channel once it&#x27;s closed. Because
select case evaluation is random, we may not read a val from the channel once
the close notify channel is closed. We can ensure that we return a value if it&#x27;s
available by modifying <code>Pop()</code> as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Queue) Pop() (int, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case val := &lt;-self.ch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return val, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case &lt;-self.closeNotify:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case val := &lt;-self.ch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return val, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return 0, errors.New(&quot;queue closed&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Places used:</p><ul><li><a href="https://github.com/openziti/channel/blob/main/impl.go" target="_blank" rel="noopener noreferrer">https://github.com/openziti/channel/blob/main/impl.go</a> (see rxer, txer)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-channel-uses">Other Channel Uses<a href="#other-channel-uses" class="hash-link" aria-label="Direct link to Other Channel Uses" title="Direct link to Other Channel Uses">â</a></h2><p>Let&#x27;s look at how we can use channels in a few other ways.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="semaphores-and-pools">Semaphores and Pools<a href="#semaphores-and-pools" class="hash-link" aria-label="Direct link to Semaphores and Pools" title="Direct link to Semaphores and Pools">â</a></h3><p>Because channels have a sized buffer and have well defined blocking behavior,
creating a semaphore implementation is very straightforward. We can create a
channel with a buffer of the size we want our semaphore to have. We can then
read and write from the channel to acquire and release the semaphore. </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package concurrenz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;time&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Semaphore interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Acquire()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AcquireWithTimeout(t time.Duration) bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TryAcquire() bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Release() bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func NewSemaphore(size int) Semaphore {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result := &amp;semaphoreImpl{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c: make(chan struct{}, size),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for result.Release() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type semaphoreImpl struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c chan struct{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *semaphoreImpl) Acquire() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;-self.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *semaphoreImpl) AcquireWithTimeout(t time.Duration) bool {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case &lt;-self.c:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case &lt;-time.After(t):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *semaphoreImpl) TryAcquire() bool {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case &lt;-self.c:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *semaphoreImpl) Release() bool {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case self.c &lt;- struct{}{}:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We could use mostly the same implementation for a resource pool. Instead of
a channel of struct{}, we could have a channel of connections or buffers
that are acquired and released.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="signal">Signal<a href="#signal" class="hash-link" aria-label="Direct link to Signal" title="Direct link to Signal">â</a></h3><p>We can use channels as signals. In this example we have something running
periodically, but we want to be able to trigger it to run sooner. With a
single element channel, we can notify a goroutine. By using <code>select</code> with
<code>default</code>, we can ensure that signalling code doesn&#x27;t block and that the
receiving side only gets a single signal per loop.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;fmt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;github.com/openziti/foundation/util/concurrenz&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;time&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func NewWorker() *Worker {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w := &amp;Worker{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signal:  make(chan struct{}, 1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    go w.run()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Worker struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signal chan struct{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stopped concurrenz.AtomicBoolean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Worker) run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ticker := time.NewTicker(time.Minute)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    defer ticker.Stop()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for !self.stopped.Get() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &lt;-ticker.C:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.work()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &lt;-self.signal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.work()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Worker) work() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if !self.stopped.Get() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt.Println(&quot;working hard&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Worker) RunNow() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case self.signal &lt;- struct{}{}:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="channel-loops-and-event-handler">Channel Loops and Event Handler<a href="#channel-loops-and-event-handler" class="hash-link" aria-label="Direct link to Channel Loops and Event Handler" title="Direct link to Channel Loops and Event Handler">â</a></h3><p>We often have a loop which is processing inputs from one or channel. Often we have a set of data
we want to keep local to a single goroutine, so we don&#x27;t have to use any synchronization or worry
about cpu cache effects. We use channels to feed data to the goroutine and/or to trigger different
kinds of processing. A for with select loop can handle channels of different types. YOu can have
a channel per type of work, or per type of data. Sometimes it can be convenient to consolidate things
on a single channel, using an event API.</p><p>Here&#x27;s a simple example where the processor is maintaining some cached data which can be updated
externally. Presumably the processor would be doing something with the cached data, but we&#x27;ve left
that out to focus on the pattern itself.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type Event interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // events are passed the processor so they don&#x27;t each have to include it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Handle(*Processor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Processor struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ch          chan Event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    closeNotify chan struct{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache map[string]string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Processor) run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case event := &lt;-self.ch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            event.Handle(self)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &lt;-self.closeNotify:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Processor) queueEvent(evt Event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case self.ch &lt;- evt:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case &lt;-self.closeNotify:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Processor) UpdateCache(k, v string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.queueEvent(&amp;updateCache{key: k, value: v})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Processor) Invalidate(k string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.queueEvent(invalidate(k))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type updateCache struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *updateCache) Handle(p *Processor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p.cache[self.key] = self.value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type invalidate string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self invalidate) Handle(p *Processor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delete(p.cache, string(self))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="type-aliases">Type Aliases<a href="#type-aliases" class="hash-link" aria-label="Direct link to Type Aliases" title="Direct link to Type Aliases">â</a></h2><p>As we demonstrated in the previous example we can alias a type and add functions to it, usually
to satisfy some interface.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type invalidate string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self invalidate) Handle(p *Processor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        delete(p.cache, string(self))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This can be useful if we only have a single piece of data. Rather than wrapping it in a struct,
we can just alias it and add our own funcs. </p><p>The main downside to this approach is that you have to unalias the data inside your functions
which can lead to code that is less clear. See for example this method from an <code>AtomicBoolean</code>
implementation:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type AtomicBoolean int32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (ab *AtomicBoolean) Set(val bool) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    atomic.StoreInt32((*int32)(ab), boolToInt(val))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="function-type-aliases">Function Type Aliases<a href="#function-type-aliases" class="hash-link" aria-label="Direct link to Function Type Aliases" title="Direct link to Function Type Aliases">â</a></h3><p>A go feature which can surprise developers is the ability to add function definitions to funcs.
The Event API in the Processor example above could be extended as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type Event interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Handle(*Processor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type EventF func(*Processor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self EventF) Handle(p *Processor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self(p)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>Invalidate</code> code could now be written as:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Processor) Invalidate(k string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.queueEvent(EventF(func(processor *Processor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        delete(processor.cache, k)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The need for an <code>EventF</code> cast could be removed by adding a helper function.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Processor) queueEventF(evt EventF) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.queueEvent(evt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *Processor) UpdateCache(k, v string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.queueEventF(func(processor *Processor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processor.cache[k] = v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I first encountered this style in the go http library where handlers can be defined
as structs implementing <code>Handler</code> or as functions matching <code>HandlerFunc</code>. This is
most useful when you may have both heavy implementations which carry a lot of state
as well as very simple implementations which make more sense as a function.</p><p>The processor event channel could also be implemented in terms of pure functions, if
all event implementations are lightweight.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interfaces">Interfaces<a href="#interfaces" class="hash-link" aria-label="Direct link to Interfaces" title="Direct link to Interfaces">â</a></h2><p>A golang limitation that often trips people up is that packages cannot have circular
dependencies. There are a few ways to work around this, but the most common is to
introduce interfaces in the more independent of the packages.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="errors">Errors<a href="#errors" class="hash-link" aria-label="Direct link to Errors" title="Direct link to Errors">â</a></h2><p>In some situations, go&#x27;s error handling can be excessively verbose. Especially in
cases where you&#x27;re doing a series of I/O operations, your code can look something
like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func WriteExample(w io.Writer) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if _, err := w.Write([]byte(&quot;one&quot;)); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if _, err := w.Write([]byte(&quot;two&quot;)); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if _, err := w.Write([]byte(&quot;three&quot;)); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if _, err := w.Write([]byte(&quot;four&quot;)); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>One way to clean this up is to wrap the error in the operation and only check it at
the end.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type WriterErr struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    err error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w io.Writer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *WriterErr) Write(s string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if self.err == nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _, self.err = self.w.Write([]byte(s))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *WriterErr) Error() error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return self.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func WriteExample2(w io.Writer) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writer := &amp;WriterErr{w: w}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writer.Write(&quot;one&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writer.Write(&quot;two&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writer.Write(&quot;three&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writer.Write(&quot;four&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return writer.Error()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See also: </p><ul><li><a href="https://go.dev/blog/errors-are-values" target="_blank" rel="noopener noreferrer">https://go.dev/blog/errors-are-values</a></li><li><a href="https://dave.cheney.net/2019/01/27/eliminate-error-handling-by-eliminating-errors" target="_blank" rel="noopener noreferrer">https://dave.cheney.net/2019/01/27/eliminate-error-handling-by-eliminating-errors</a></li></ul><p>Note: This pattern is could be viewed as an error monad implementation</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gotchas">Gotchas<a href="#gotchas" class="hash-link" aria-label="Direct link to Gotchas" title="Direct link to Gotchas">â</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="loop-variables">Loop Variables<sup id="fnref-cam-a1cd95"><a href="#fn-cam-a1cd95" class="footnote-ref">cam</a></sup><a href="#loop-variables" class="hash-link" aria-label="Direct link to loop-variables" title="Direct link to loop-variables">â</a></h3><p>Like many other languages, it&#x27;s possible to get into trouble when capturing loop variables,
both via pointer references and via closures.</p><p>The following snippet will print out <code>world world</code> since the loop variable
remains constant throughout loop iteration.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var list []*string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for _, v := range []string {&quot;hello&quot;, &quot;world&quot;} {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        list = append(list, &amp;v)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for _, v := range list {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt.Printf(&quot;%v &quot;, *v)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt.Println()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similarly, the following will output <code>second second</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for _, v := range []string {&quot;first&quot;, &quot;second&quot;} {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        go func() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            time.Sleep(100 * time.Millisecond)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fmt.Printf(&quot;%v &quot;, v)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time.Sleep(200 *time.Millisecond)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt.Println()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-deadlock-causes">Common Deadlock Causes<a href="#common-deadlock-causes" class="hash-link" aria-label="Direct link to Common Deadlock Causes" title="Direct link to Common Deadlock Causes">â</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="non-reentrant-mutexes">Non-reentrant Mutexes<a href="#non-reentrant-mutexes" class="hash-link" aria-label="Direct link to Non-reentrant Mutexes" title="Direct link to Non-reentrant Mutexes">â</a></h4><p>Unlike in some other languages, the mutexes provide in the sync package are non-reentrant. So if your code
grabs a lock and ends up calling back into something which gets the same lock, the goroutine will deadlock.
Typically, if you have to call back in, you&#x27;d either need an indicator that the lock is already acquired,
or do the work in a new go-routine, depending on how independent the second access was.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="channel-deadlocks">Channel Deadlocks<a href="#channel-deadlocks" class="hash-link" aria-label="Direct link to Channel Deadlocks" title="Direct link to Channel Deadlocks">â</a></h4><p>If you have a goroutine processing events from a channel, if the event submits an event back onto the channel,
that can cause a deadlock, if the channel is not buffered, or if the buffer is full.</p><p>Fixes include:</p><ul><li>Running the next event in-line, if you can detect that you&#x27;re already in the event processing context</li><li>Ensure the channel is buffer is big enough that it will never block</li><li>Handing the new event submission off to a new go-routine</li></ul><p>One benefit to keeping your channel buffers at zero, is that you will detect these deadlocks very quickly.
If you have a small buffer, then the deadlock may not be caught until the system is under load.</p><div class="footnotes"><hr><ol><li id="fn-cam-a1cd95">Suggested by Cameron Otts<a href="#fnref-cam-a1cd95" class="footnote-backref">â©</a></li></ol></div></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/wildcard-dns/cheatsheet">Wildcard DNS Cheatsheet</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-21T16:18:09.000Z" itemprop="datePublished">December 21, 2023</time> Â· <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dovholuknf" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/46322585?v=4" alt="Clint Dovholuk" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dovholuknf" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Clint Dovholuk</span></a></div><small class="avatar__subtitle" itemprop="description">OpenZiti Maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ------------- start docker </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># access the docker controller to create the necessary overlay</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it docker_ziti-controller_1 bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ------------- log into the ziti cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zitiLogin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ------------- make at least one router to be public </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge update edge-router ziti-edge-router -a &quot;public&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ------------- allow all identities to use any edge router with the attribute &quot;public&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete edge-router-policy all-endpoints-public-routers </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create edge-router-policy all-endpoints-public-routers --edge-router-roles &quot;#public&quot; --identity-roles &quot;#all&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ------------- allows all edge-routers to access all services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete service-edge-router-policy all-routers-all-services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-edge-router-policy all-routers-all-services --edge-router-roles &quot;#all&quot; --service-roles &quot;#all&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete identity zititunneller-blue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity device zititunneller-blue -o blue.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge enroll blue.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ------------- create a client - probably won&#x27;t commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity device zdewclint -o zdewclint.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># from outside docker:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker cp docker_ziti-controller_1:/openziti/zdewclint.jwt /mnt/v/temp/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># attach a wholly different docker container with NET_ADMIN priv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># so we can make a tun and provide access to the __blue__ network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run --cap-add=NET_ADMIN --device /dev/net/tun --name ziti-tunneler-blue --user root --network docker_zitiblue -v docker_ziti-fs:/openziti --rm -it openziti/quickstart /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ------------- zititunneller-blue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt install wget unzip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/openziti/ziti-tunnel-sdk-c/releases/latest/download/ziti-edge-tunnel-Linux_x86_64.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unzip ziti-edge-tunnel-Linux_x86_64.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clear</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./ziti-edge-tunnel run -i blue.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete config &quot;basic.dial&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config &quot;basic.dial&quot; intercept.v1 &#x27;{&quot;protocols&quot;:[&quot;tcp&quot;],&quot;addresses&quot;:[&quot;simple.web.test&quot;], &quot;portRanges&quot;:[{&quot;low&quot;:80, &quot;high&quot;:80}]}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete config &quot;basic.bind&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config &quot;basic.bind&quot; host.v1      &#x27;{&quot;protocol&quot;:&quot;tcp&quot;, &quot;address&quot;:&quot;web-test-blue&quot;,&quot;port&quot;:8000}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete service &quot;basic.web.test.service&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service &quot;basic.web.test.service&quot; --configs &quot;basic.bind,basic.dial&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete service-policy basic.web.test.service.bind.blue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy basic.web.test.service.bind.blue Bind --service-roles &quot;@basic.web.test.service&quot; --identity-roles &quot;@zititunneller-blue&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete service-policy basic.web.test.service.dial.zdew</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy basic.web.test.service.dial.zdew Dial --service-roles &quot;@basic.web.test.service&quot; --identity-roles &quot;@zdewclint&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete config &quot;wildcard.dial&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config &quot;wildcard.dial&quot; intercept.v1 &#x27;{&quot;protocols&quot;:[&quot;tcp&quot;],&quot;addresses&quot;:[&quot;*.blue&quot;], &quot;portRanges&quot;:[{&quot;low&quot;:8000, &quot;high&quot;:8000}]}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete config &quot;wildcard.bind&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config &quot;wildcard.bind&quot; host.v1      &#x27;{&quot;forwardProtocol&quot;:true, &quot;allowedProtocols&quot;:[&quot;tcp&quot;,&quot;udp&quot;], &quot;forwardAddress&quot;:true, &quot;allowedAddresses&quot;:[&quot;*.blue&quot;], &quot;forwardPort&quot;:true, &quot;allowedPortRanges&quot;:[ {&quot;low&quot;:1,&quot;high&quot;:32768}] }&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete service &quot;wildcard.web.test.service&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service &quot;wildcard.web.test.service&quot; --configs &quot;wildcard.bind,wildcard.dial&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete service-policy wildcard.web.test.service.bind.blue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy wildcard.web.test.service.bind.blue Bind --service-roles &quot;@wildcard.web.test.service&quot; --identity-roles &quot;@zititunneller-blue&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete service-policy wildcard.web.test.service.dial.zdew</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy wildcard.web.test.service.dial.zdew Dial --service-roles &quot;@wildcard.web.test.service&quot; --identity-roles &quot;@zdewclint&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="&quot;Zitification&quot; or &quot;zitifying&quot; is the act of taking an application and incorporating a Ziti SDK into that application. Once an"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/zitification">Zitification</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-21T16:18:09.000Z" itemprop="datePublished">December 21, 2023</time> Â· <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dovholuknf" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/46322585?v=4" alt="Clint Dovholuk" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dovholuknf" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Clint Dovholuk</span></a></div><small class="avatar__subtitle" itemprop="description">OpenZiti Maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>&quot;Zitification&quot; or &quot;zitifying&quot; is the act of taking an application and incorporating a Ziti SDK into that application. Once an
application has a Ziti SDK incorporated into it, that application can now access network resources securely from anywhere in
the world provided that the computer has internet access: NO VPN NEEDED, NO ADDITIONAL SOFTWARE NEEDED.</p><p>Integrating a Ziti SDK into your application and enrolling the application itself into a Ziti Network provides you with <em>
tremendous</em> additional security. An application using a <a href="/docs/learn/introduction/">Ziti Network</a> configured with a truly zero-trust mindset will be
<strong>IMMUNE</strong> to the &quot;expand/multiply&quot; phases of classic <a href="https://netfoundry.io/ztna-ransomware/" target="_blank" rel="noopener noreferrer">ransomware attacks</a>. As recent events have shown, it&#x27;s probably not
a case of if your application will be attacked, but when.</p><p>In these posts we&#x27;re going to explore how common applications can be &quot;zitified&quot;. The first application we are going to focus
on will be <code>ssh</code> and it&#x27;s corollary <code>scp</code>. At first, you might think, &quot;why even bother&quot; zitifying (of all things) <code>ssh</code>
and <code>scp</code>? These applications are vital to system administration, and we have been using <code>ssh</code> and
<code>scp</code> &quot;safely&quot; on the internet for years. Hopefully you&#x27;re now interested enough to find out in the first post:
<a href="/blog/zitification/zitifying-ssh/">zitifying ssh</a></p><p>If you&#x27;d prefer to read about other zitifications, a running list of zitified apps will be updated below:</p><ul><li><a href="/blog/zitification/zitifying-ssh/">ssh-&gt;zssh</a></li><li><a href="/blog/zitification/zitifying-scp/">scp-&gt;zscp</a></li><li><a href="/blog/zitification/kubernetes/">Kubernetes cluster manager - kubectl</a></li></ul></div></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/page/2"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/policies/CODE_OF_CONDUCT">Policies</a><span class="footer__link-separator">Â·</span><a href="https://netfoundry.io/pricing/" target="_blank" rel="noopener noreferrer" class="footer__link-item">CloudZiti</a><span class="footer__link-separator">Â·</span><a href="https://blog.openziti.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 NetFoundry Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.08af6442.js"></script>
<script src="/assets/js/main.738ccc42.js"></script>
</body>
</html>