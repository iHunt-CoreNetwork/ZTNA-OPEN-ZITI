"use strict";(self.webpackChunkopen_ziti=self.webpackChunkopen_ziti||[]).push([[5844],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=c(n),h=i,m=u["".concat(s,".").concat(h)]||u[h]||d[h]||a;return n?r.createElement(m,l(l({ref:t},p),{},{components:n})):r.createElement(m,l({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,l=new Array(a);l[0]=h;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:i,l[1]=o;for(var c=2;c<a;c++)l[c]=n[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(67294),i=n(86010);const a={tabItem:"tabItem_Ymn6"};function l(e){let{children:t,hidden:n,className:l}=e;return r.createElement("div",{role:"tabpanel",className:(0,i.Z)(a.tabItem,l),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>_});var r=n(87462),i=n(67294),a=n(86010),l=n(12466),o=n(16550),s=n(91980),c=n(67392),p=n(50012);function u(e){return function(e){return i.Children.map(e,(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:i}}=e;return{value:t,label:n,attributes:r,default:i}}))}function d(e){const{values:t,children:n}=e;return(0,i.useMemo)((()=>{const e=t??u(n);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const r=(0,o.k6)(),a=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s._X)(a),(0,i.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(r.location.search);t.set(a,e),r.replace({...r.location,search:t.toString()})}),[a,r])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,a=d(e),[l,o]=(0,i.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:a}))),[s,c]=m({queryString:n,groupId:r}),[u,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,a]=(0,p.Nk)(n);return[r,(0,i.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:r}),k=(()=>{const e=s??u;return h({value:e,tabValues:a})?e:null})();(0,i.useLayoutEffect)((()=>{k&&o(k)}),[k]);return{selectedValue:l,selectValue:(0,i.useCallback)((e=>{if(!h({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);o(e),c(e),g(e)}),[c,g,a]),tabValues:a}}var k=n(72389);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function f(e){let{className:t,block:n,selectedValue:o,selectValue:s,tabValues:c}=e;const p=[],{blockElementScrollPositionUntilNextRender:u}=(0,l.o5)(),d=e=>{const t=e.currentTarget,n=p.indexOf(t),r=c[n].value;r!==o&&(u(t),s(r))},h=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=p.indexOf(e.currentTarget)+1;t=p[n]??p[0];break}case"ArrowLeft":{const n=p.indexOf(e.currentTarget)-1;t=p[n]??p[p.length-1];break}}t?.focus()};return i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":n},t)},c.map((e=>{let{value:t,label:n,attributes:l}=e;return i.createElement("li",(0,r.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>p.push(e),onKeyDown:h,onClick:d},l,{className:(0,a.Z)("tabs__item",v.tabItem,l?.className,{"tabs__item--active":o===t})}),n??t)})))}function y(e){let{lazy:t,children:n,selectedValue:r}=e;const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===r));return e?(0,i.cloneElement)(e,{className:"margin-top--md"}):null}return i.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function N(e){const t=g(e);return i.createElement("div",{className:(0,a.Z)("tabs-container",v.tabList)},i.createElement(f,(0,r.Z)({},e,t)),i.createElement(y,(0,r.Z)({},e,t)))}function _(e){const t=(0,k.Z)();return i.createElement(N,(0,r.Z)({key:String(t)},e))}},79495:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>c,toc:()=>u});var r=n(87462),i=(n(67294),n(3905)),a=n(74866),l=n(85162);const o={sidebar_position:50,sidebar_label:"Services",title:"Service Topologies"},s=void 0,c={unversionedId:"guides/topologies/services",id:"guides/topologies/services",title:"Service Topologies",description:"3.0 Ziti services",source:"@site/docs/guides/topologies/10-services.mdx",sourceDirName:"guides/topologies",slug:"/guides/topologies/services",permalink:"/docs/guides/topologies/services",draft:!1,editUrl:"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/topologies/10-services.mdx",tags:[],version:"current",sidebarPosition:50,frontMatter:{sidebar_position:50,sidebar_label:"Services",title:"Service Topologies"},sidebar:"docsSidebar",previous:{title:"Topologies",permalink:"/docs/category/topologies"},next:{title:"Gateway",permalink:"/docs/category/gateway"}},p={},u=[{value:"3.0 Ziti services",id:"30-ziti-services",level:2},{value:"3.1 Introduction",id:"31-introduction",level:2},{value:"3.1.1 Network Diagram 1",id:"311-network-diagram-1",level:3},{value:"3.1.2 Network Diagram 2",id:"312-network-diagram-2",level:3},{value:"3.1.3 Network Diagram 3",id:"313-network-diagram-3",level:3},{value:"3.1.4 Network Diagram 4",id:"314-network-diagram-4",level:3},{value:"3.1.5 Network Diagram 5",id:"315-network-diagram-5",level:3},{value:"3.2 Setup VMs for ziti network",id:"32-setup-vms-for-ziti-network",level:2},{value:"3.2.1 Controller",id:"321-controller",level:3},{value:"3.2.1.1 ZAC",id:"3211-zac",level:4},{value:"3.2.1.2 CLI",id:"3212-cli",level:4},{value:"3.2.2 Router",id:"322-router",level:3},{value:"3.2.2.1 ZAC",id:"3221-zac",level:4},{value:"3.2.2.2 CLI",id:"3222-cli",level:4},{value:"3.2.3 Tunnelers/Identities",id:"323-tunnelersidentities",level:3},{value:"3.2.3.1 Create Identity with ZAC",id:"3231-create-identity-with-zac",level:4},{value:"3.2.3.2 Create Identity with CLI",id:"3232-create-identity-with-cli",level:4},{value:"3.2.3.3 Register Identities",id:"3233-register-identities",level:4},{value:"3.3 Create Edge Router Policy",id:"33-create-edge-router-policy",level:2},{value:"3.3.1 ZAC",id:"331-zac",level:3},{value:"3.3.2 CLI",id:"332-cli",level:3},{value:"3.4 Setup Tunnel to Tunnel ssh connection",id:"34-setup-tunnel-to-tunnel-ssh-connection",level:2},{value:"3.4.1 Create a host.v1 config",id:"341-create-a-hostv1-config",level:3},{value:"3.4.1.1 ZAC",id:"3411-zac",level:4},{value:"3.4.1.2 CLI",id:"3412-cli",level:4},{value:"3.4.2 Create an intercept.v1 config",id:"342-create-an-interceptv1-config",level:3},{value:"3.4.2.1 ZAC",id:"3421-zac",level:4},{value:"3.4.2.2 CLI",id:"3422-cli",level:4},{value:"3.4.3 Create Service",id:"343-create-service",level:3},{value:"3.4.3.1 ZAC",id:"3431-zac",level:4},{value:"3.4.3.2 CLI",id:"3432-cli",level:4},{value:"3.4.4 Create Bind Service policy",id:"344-create-bind-service-policy",level:3},{value:"3.4.4.1 ZAC",id:"3441-zac",level:4},{value:"3.4.4.2 CLI",id:"3442-cli",level:4},{value:"3.4.5 Create Dial Service policy",id:"345-create-dial-service-policy",level:3},{value:"3.4.5.1 ZAC",id:"3451-zac",level:4},{value:"3.4.5.2 CLI",id:"3452-cli",level:4},{value:"3.4.6 Verify the connection",id:"346-verify-the-connection",level:3},{value:"3.5 Setup Tunnel to ERT http connection",id:"35-setup-tunnel-to-ert-http-connection",level:2},{value:"3.5.1 Create a host.v1 config",id:"351-create-a-hostv1-config",level:3},{value:"3.5.1.1 ZAC",id:"3511-zac",level:4},{value:"3.5.1.2 CLI",id:"3512-cli",level:4},{value:"3.5.2 Create an intercept.v1 config",id:"352-create-an-interceptv1-config",level:3},{value:"3.5.2.1 ZAC",id:"3521-zac",level:4},{value:"3.5.2.2 CLI",id:"3522-cli",level:4},{value:"3.5.3 Create Service",id:"353-create-service",level:3},{value:"3.5.3.1 ZAC",id:"3531-zac",level:4},{value:"3.5.3.2 CLI",id:"3532-cli",level:4},{value:"3.5.4 Create Bind Service policy",id:"354-create-bind-service-policy",level:3},{value:"3.5.4.1 ZAC",id:"3541-zac",level:4},{value:"3.5.4.2 CLI",id:"3542-cli",level:4},{value:"3.5.5 Create Dial Service policy",id:"355-create-dial-service-policy",level:3},{value:"3.5.5.1 ZAC",id:"3551-zac",level:4},{value:"3.5.5.2 CLI",id:"3552-cli",level:4},{value:"3.5.6 Verify the connection",id:"356-verify-the-connection",level:3},{value:"3.5.7 Conclusion",id:"357-conclusion",level:3},{value:"3.6 Setup Connection from a non-OpenZiti client",id:"36-setup-connection-from-a-non-openziti-client",level:2},{value:"3.6.1 Introduction",id:"361-introduction",level:3},{value:"3.6.2 Create a host.v1 config",id:"362-create-a-hostv1-config",level:3},{value:"3.6.2.1 ZAC",id:"3621-zac",level:4},{value:"3.6.2.2 CLI",id:"3622-cli",level:4},{value:"3.6.3 Create an intercept.v1 config",id:"363-create-an-interceptv1-config",level:3},{value:"3.6.3.1 ZAC",id:"3631-zac",level:4},{value:"3.6.3.2 CLI",id:"3632-cli",level:4},{value:"3.6.4 Create Service",id:"364-create-service",level:3},{value:"3.6.4.1 ZAC",id:"3641-zac",level:4},{value:"3.6.4.2 CLI",id:"3642-cli",level:4},{value:"3.6.5 Create Bind Service policy",id:"365-create-bind-service-policy",level:3},{value:"3.6.5.1 ZAC",id:"3651-zac",level:4},{value:"3.6.5.2 CLI",id:"3652-cli",level:4},{value:"3.6.6 Create Dial Service policy",id:"366-create-dial-service-policy",level:3},{value:"3.6.6.1 ZAC",id:"3661-zac",level:4},{value:"3.6.6.2 CLI",id:"3662-cli",level:4},{value:"3.6.7 Verify the connection",id:"367-verify-the-connection",level:3},{value:"3.6.7.1 Setup Server Side",id:"3671-setup-server-side",level:4},{value:"3.6.7.2 Test IP intercept",id:"3672-test-ip-intercept",level:4},{value:"3.6.7.3 Modify the resolver",id:"3673-modify-the-resolver",level:4},{value:"3.6.7.4 Test DNS intercept",id:"3674-test-dns-intercept",level:4},{value:"3.7 Setup SDK enabled application to access a server",id:"37-setup-sdk-enabled-application-to-access-a-server",level:2},{value:"3.7.1 Introduction",id:"371-introduction",level:3},{value:"3.7.2 SDK Application client",id:"372-sdk-application-client",level:3},{value:"3.7.3 Create a host.v1 config",id:"373-create-a-hostv1-config",level:3},{value:"3.7.4 Create Service",id:"374-create-service",level:3},{value:"3.7.5 Create Bind Service policy",id:"375-create-bind-service-policy",level:3},{value:"3.7.6 Create Dial Service policy",id:"376-create-dial-service-policy",level:3},{value:"3.7.7 Setup Server Side",id:"377-setup-server-side",level:3},{value:"3.7.8 Verify the connection",id:"378-verify-the-connection",level:3},{value:"3.8 Access a SDK enabled application via ziti-tunnel",id:"38-access-a-sdk-enabled-application-via-ziti-tunnel",level:2},{value:"3.8.1 Introduction",id:"381-introduction",level:3},{value:"3.8.2 SDK Application server",id:"382-sdk-application-server",level:3},{value:"3.8.3 host.v1 config",id:"383-hostv1-config",level:3},{value:"3.8.4 Create an intercept.v1 config",id:"384-create-an-interceptv1-config",level:3},{value:"3.8.5 Create Service",id:"385-create-service",level:3},{value:"3.8.6 Create Bind Service policy",id:"386-create-bind-service-policy",level:3},{value:"3.8.7 Create Dial Service policy",id:"387-create-dial-service-policy",level:3},{value:"3.8.8 Setup Server Side",id:"388-setup-server-side",level:3},{value:"3.8.9 Verify the connection",id:"389-verify-the-connection",level:3},{value:"3.9 Setup SDK Client to SDK Server connection",id:"39-setup-sdk-client-to-sdk-server-connection",level:2},{value:"3.9.1 Introduction",id:"391-introduction",level:3},{value:"3.9.2 SDK Application client and server",id:"392-sdk-application-client-and-server",level:3},{value:"3.9.3 Create Service",id:"393-create-service",level:3},{value:"3.9.4 Create Bind Service policy",id:"394-create-bind-service-policy",level:3},{value:"3.9.5 Create Dial Service policy",id:"395-create-dial-service-policy",level:3},{value:"3.9.6 Chat Server",id:"396-chat-server",level:3},{value:"3.9.7 Test Chat",id:"397-test-chat",level:3}],d={toc:u},h="wrapper";function m(e){let{components:t,...o}=e;return(0,i.kt)(h,(0,r.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"30-ziti-services"},"3.0 Ziti services"),(0,i.kt)("p",null,"Ziti services take several forms in deployment environments. In this guide, we will highlight a few examples."),(0,i.kt)("h2",{id:"31-introduction"},"3.1 Introduction"),(0,i.kt)("p",null,"In this guide, we will demonstrate ziti services with the following examples:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"connection between two identities running ziti-edge-tunnel (",(0,i.kt)("a",{parentName:"li",href:"#311-network-diagram-1"},"Network Diagram 1"),")"),(0,i.kt)("li",{parentName:"ul"},"connection between ziti-edge-tunnel and a ziti-router (with tunnel enabled)(",(0,i.kt)("a",{parentName:"li",href:"#312-network-diagram-2"},"Network Diagram 2"),")"),(0,i.kt)("li",{parentName:"ul"},"connection from a non-OpenZiti endpoint using router as GW(",(0,i.kt)("a",{parentName:"li",href:"#312-network-diagram-2"},"Network Diagram 2"),")"),(0,i.kt)("li",{parentName:"ul"},"access a server from a SDK enabled application (",(0,i.kt)("a",{parentName:"li",href:"#313-network-diagram-3"},"Network Diagram 3"),")"),(0,i.kt)("li",{parentName:"ul"},"access a SDK enabled application with an ziti client (",(0,i.kt)("a",{parentName:"li",href:"#314-network-diagram-4"},"Network Diagram 4"),")"),(0,i.kt)("li",{parentName:"ul"},"SDK client connects to SDK server (",(0,i.kt)("a",{parentName:"li",href:"#315-network-diagram-5"},"Network Diagram 5"),")")),(0,i.kt)("h3",{id:"311-network-diagram-1"},"3.1.1 Network Diagram 1"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(11505).Z,width:"663",height:"262"})),(0,i.kt)("h3",{id:"312-network-diagram-2"},"3.1.2 Network Diagram 2"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(57452).Z,width:"790",height:"267"})),(0,i.kt)("h3",{id:"313-network-diagram-3"},"3.1.3 Network Diagram 3"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(88814).Z,width:"663",height:"272"})),(0,i.kt)("h3",{id:"314-network-diagram-4"},"3.1.4 Network Diagram 4"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(8055).Z,width:"688",height:"282"})),(0,i.kt)("h3",{id:"315-network-diagram-5"},"3.1.5 Network Diagram 5"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(84605).Z,width:"713",height:"224"})),(0,i.kt)("p",null,"This guide provides both CLI and GUI (ZAC) instructions. To use ZAC, make sure ZAC is installed. If you have not installed ZAC, and would like to use it in this section, please follow the ",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/deployments/cloud/controller#14-setup-ziti-administration-console-zac"},"ZAC Setup Guide")," before continuing."),(0,i.kt)("h2",{id:"32-setup-vms-for-ziti-network"},"3.2 Setup VMs for ziti network"),(0,i.kt)("h3",{id:"321-controller"},"3.2.1 Controller"),(0,i.kt)("h4",{id:"3211-zac"},"3.2.1.1 ZAC"),(0,i.kt)("p",null,"Please make sure you can login to your network and see the welcome screen before continuing."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(64487).Z,width:"1695",height:"958"})),(0,i.kt)("h4",{id:"3212-cli"},"3.2.1.2 CLI"),(0,i.kt)("p",null,"You will need to login to controller to provision identities and service. Please make sure you are performing the action on the right node."),(0,i.kt)("p",null,"On the controller, before performing the CLI command, you will need to login first:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"zitiLogin\n")),(0,i.kt)("p",null,"The login token expires after some period of time. If the token expired, you will need to login again via the same command. You will see error message like this when the token expired:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'error: error listing https://161.35.108.218:8441/edge/management/v1/config-types?filter=id%3D%22host.v1%22 in Ziti Edge Controller. Status code: 401 Unauthorized, Server returned: {\n    "error": {\n        "code": "UNAUTHORIZED",\n        "message": "The request could not be completed. The session is not authorized or the credentials are invalid",\n        "requestId": "7zxWCy7Vx"\n    },\n    "meta": {\n        "apiEnrollmentVersion": "0.0.1",\n        "apiVersion": "0.0.1"\n    }\n}\n')),(0,i.kt)("h3",{id:"322-router"},"3.2.2 Router"),(0,i.kt)("p",null,"We need two routers to complete our example in this guide."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Public Edge Router (",(0,i.kt)("strong",{parentName:"li"},"pub-er"),") was setup in the ",(0,i.kt)("a",{parentName:"li",href:"/docs/guides/deployments/cloud/router#23-create-and-setup-router-directly-on-router-vm"},"Router setup section"),", this router provides fabric and edge connection. It does not have tunneler functionality. Make sure you also modify the ",(0,i.kt)("a",{parentName:"li",href:"/docs/guides/deployments/cloud/router#29-firewall"},"Firewall")," for this router."),(0,i.kt)("li",{parentName:"ul"},"Local Edge Router (",(0,i.kt)("strong",{parentName:"li"},"local-er"),"). Please follow the ",(0,i.kt)("a",{parentName:"li",href:"/docs/guides/deployments/cloud/router/"},"Router guide")," to setup a ",(0,i.kt)("a",{parentName:"li",href:"/docs/guides/deployments/cloud/router/#2343-create-the-router-with-edge-listener-and-tunneler"},"Router with edge listener and tunneler"),". For this router, you will need to setup ",(0,i.kt)("a",{parentName:"li",href:"/docs/guides/deployments/cloud/router#26-fix-the-resolver"},"Resolver"),", ",(0,i.kt)("a",{parentName:"li",href:"/docs/guides/deployments/cloud/router#27-route-table"},"Route Table"),", ",(0,i.kt)("a",{parentName:"li",href:"/docs/guides/deployments/cloud/router#28-source-and-destination-check"},"Source and Destination Check")," and ",(0,i.kt)("a",{parentName:"li",href:"/docs/guides/deployments/cloud/router#29-firewall"},"Firewall"),".")),(0,i.kt)("h4",{id:"3221-zac"},"3.2.2.1 ZAC"),(0,i.kt)("p",null,"On the ZAC ",(0,i.kt)("strong",{parentName:"p"},"ROUTERS")," screen, you can check your router and make sure it is created correctly. You can also check the identity associated with the router by clicked on ",(0,i.kt)("strong",{parentName:"p"},"IDENTITIES")),(0,i.kt)("p",null,"On the ",(0,i.kt)("strong",{parentName:"p"},"ROUTERS")," screen, you will see two routers we created."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(42607).Z,width:"1072",height:"377"})),(0,i.kt)("p",null,"On the ",(0,i.kt)("strong",{parentName:"p"},"IDENTITIES"),' screen, you will see an identity match "local-er" router name. If you perform the provisioning correctly, you should ',(0,i.kt)("strong",{parentName:"p"},"not"),' see an identity name "pub-er".'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(6404).Z,width:"1081",height:"384"})),(0,i.kt)("h4",{id:"3222-cli"},"3.2.2.2 CLI"),(0,i.kt)("p",null,"You can also check the provisioning on the ",(0,i.kt)("strong",{parentName:"p"},"controller"),"."),(0,i.kt)("p",null,"You should see two routers named ",(0,i.kt)("strong",{parentName:"p"},"pub-er")," and ",(0,i.kt)("strong",{parentName:"p"},"local-er")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list edge-routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                        \u2502 ONLINE \u2502 ALLOW TRANSIT \u2502 COST \u2502 ATTRIBUTES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 MvQnOZj4au \u2502 Public-Cloud-NC-edge-router \u2502 true   \u2502 true          \u2502    0 \u2502 public     \u2502\n\u2502 k06PffZjT  \u2502 pub-er                      \u2502 true   \u2502 true          \u2502    0 \u2502            \u2502\n\u2502 nIaTfUZjT  \u2502 local-er                    \u2502 true   \u2502 true          \u2502    0 \u2502            \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-3 of 3\n")),(0,i.kt)("p",null,"You should also see an identity named ",(0,i.kt)("strong",{parentName:"p"},"local-er")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list identities\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                        \u2502 TYPE   \u2502 ATTRIBUTES \u2502 AUTH-POLICY \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 MvQnOZj4au \u2502 Public-Cloud-NC-edge-router \u2502 Router \u2502            \u2502 default     \u2502\n\u2502 nIaTfUZjT  \u2502 local-er                    \u2502 Router \u2502            \u2502 default     \u2502\n\u2502 oJCCNs6Xo  \u2502 Default Admin               \u2502 User   \u2502            \u2502 default     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-3 of 3\n")),(0,i.kt)("p",null,"Since the ",(0,i.kt)("strong",{parentName:"p"},"pub-er")," is also a link listener, you should also check the link listener function is correctly setup. Check the router on fabric to make sure it has LISTENERS (tls:","*","*","*","*",") displayed for the ",(0,i.kt)("strong",{parentName:"p"},"pub-er"),". "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti fabric list routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                        \u2502 ONLINE \u2502 COST \u2502 NO TRAVERSAL \u2502 DISABLED \u2502 VERSION                \u2502 LISTENERS                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 MvQnOZj4au \u2502 Public-Cloud-NC-edge-router \u2502 true   \u2502    0 \u2502 false        \u2502 false    \u2502 v0.27.9 on linux/amd64 \u2502 1: tls:68.183.52.206:10080 \u2502\n\u2502 k06PffZjT  \u2502 pub-er                      \u2502 true   \u2502    0 \u2502 false        \u2502 false    \u2502 v0.27.9 on linux/amd64 \u2502 1: tls:159.203.175.189:80  \u2502\n\u2502 nIaTfUZjT  \u2502 local-er                    \u2502 true   \u2502    0 \u2502 false        \u2502 false    \u2502 v0.27.9 on linux/amd64 \u2502                            \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-3 of 3\n")),(0,i.kt)("h3",{id:"323-tunnelersidentities"},"3.2.3 Tunnelers/Identities"),(0,i.kt)("p",null,"We need two tunnelers for our testing. Please follow ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("a",{parentName:"strong",href:"/docs/guides/deployments/cloud/controller#11-create-a-vm-to-be-used-as-the-controller"},"Create a VM section"))," of the Controller Guide to create two VMs running Ubuntu 22.04."),(0,i.kt)("h4",{id:"3231-create-identity-with-zac"},"3.2.3.1 Create Identity with ZAC"),(0,i.kt)("p",null,"To create Identities on ZAC, go to the Identities screen, and press ",(0,i.kt)("strong",{parentName:"p"},"+")," icon. On the ",(0,i.kt)("strong",{parentName:"p"},"CREATE IDENTITY")," widget, enter the ",(0,i.kt)("strong",{parentName:"p"},"NAME")," of the identity (Required and has to be unique). Leave the ",(0,i.kt)("strong",{parentName:"p"},"IDENTITY TYPE"),' as "Device". Leave the ',(0,i.kt)("strong",{parentName:"p"},"ENROLLMENT TYPE"),' as "One Time Token". Fill in other optional fields and press ',(0,i.kt)("strong",{parentName:"p"},"SAVE"),"."),(0,i.kt)("p",null,"Create two identities:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"ingress-tunnel"),(0,i.kt)("li",{parentName:"ul"},"egress-tunnel")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(43663).Z,width:"1085",height:"1082"})),(0,i.kt)("p",null,"Once the identities are created, you can check the identities and download the ",(0,i.kt)("strong",{parentName:"p"},"JWT")," from the ",(0,i.kt)("strong",{parentName:"p"},"MANAGE IDENTITIES")," screen"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(77766).Z,width:"1084",height:"487"})),(0,i.kt)("h4",{id:"3232-create-identity-with-cli"},"3.2.3.2 Create Identity with CLI"),(0,i.kt)("p",null,"Create two identities (ingress-tunnel, egress-tunnel) on the ",(0,i.kt)("strong",{parentName:"p"},"controller"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"ziti edge create identity device ingress-tunnel -o ingress-tunnel.jwt\nziti edge create identity device egress-tunnel -o egress-tunnel.jwt\n")),(0,i.kt)("h4",{id:"3233-register-identities"},"3.2.3.3 Register Identities"),(0,i.kt)("p",null,"Login to your VMs created earlier, follow ",(0,i.kt)("a",{parentName:"p",href:"/docs/reference/tunnelers/linux/"},"Install Linux Package")," ",(0,i.kt)("strong",{parentName:"p"},"Ubuntu Jammy 22.04")," section to install and register your ziti-edge-tunnel."),(0,i.kt)("p",null,"After the tunnel is registered, check the status and make sure it is running"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# systemctl status ziti-edge-tunnel\n\u25cf ziti-edge-tunnel.service - Ziti Edge Tunnel\n     Loaded: loaded (/etc/systemd/system/ziti-edge-tunnel.service; enabled; vendor preset: enabled)\n     Active: active (running) since Wed 2023-04-05 20:57:04 UTC; 1min 41s ago\n    Process: 2640 ExecStartPre=/opt/openziti/bin/ziti-edge-tunnel.sh (code=exited, status=0/SUCCESS)\n   Main PID: 2641 (ziti-edge-tunne)\n      Tasks: 5 (limit: 2323)\n     Memory: 6.5M\n        CPU: 752ms\n     CGroup: /system.slice/ziti-edge-tunnel.service\n             \u2514\u25002641 /opt/openziti/bin/ziti-edge-tunnel run --verbose=2 --dns-ip-range=100.64.0.1/10 --identity-dir=/opt/openziti/etc/identities\n")),(0,i.kt)("h2",{id:"33-create-edge-router-policy"},"3.3 Create Edge Router Policy"),(0,i.kt)("p",null,"By default, the system created an edge router policy to bind all identities to any routers tag with ",(0,i.kt)("strong",{parentName:"p"},"#public")," attribute. So, we need to add #public to our router (pub-er). "),(0,i.kt)("h3",{id:"331-zac"},"3.3.1 ZAC"),(0,i.kt)("p",null,"From the ",(0,i.kt)("strong",{parentName:"p"},"ROUTERS")," screen, you can choose ",(0,i.kt)("strong",{parentName:"p"},"Router Policies")," to display the edge router policies. As you can see, the default policy is already in place."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(80236).Z,width:"1400",height:"637"})),(0,i.kt)("p",null,'To add attribute "public" to the router, choose your router from the ',(0,i.kt)("strong",{parentName:"p"},"ROUTERS")," screen, click on ",(0,i.kt)("strong",{parentName:"p"},"...")," and choose ",(0,i.kt)("strong",{parentName:"p"},"Edit")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(31441).Z,width:"1076",height:"468"})),(0,i.kt)("p",null,"On the ",(0,i.kt)("strong",{parentName:"p"},"EDIT EDGE ROUTER")," screen, you can add ",(0,i.kt)("strong",{parentName:"p"},"public")," attribute and then press ",(0,i.kt)("strong",{parentName:"p"},"SAVE")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(99895).Z,width:"663",height:"828"})),(0,i.kt)("h3",{id:"332-cli"},"3.3.2 CLI"),(0,i.kt)("p",null,"On the ",(0,i.kt)("strong",{parentName:"p"},"controller"),":"),(0,i.kt)("p",null,'Check the edge router policy. Make sure "allEdgeRouters" policy is present.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list edge-router-policies\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME                          \u2502 EDGE ROUTER ROLES            \u2502 IDENTITY ROLES               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 2YkzdKlvqraTF3VX6r9pJk \u2502 allEdgeRouters                \u2502 #public                      \u2502 #all                         \u2502\n\u2502 MvQnOZj4au             \u2502 edge-router-MvQnOZj4au-system \u2502 @Public-Cloud-NC-edge-router \u2502 @Public-Cloud-NC-edge-router \u2502\n\u2502 nIaTfUZjT              \u2502 edge-router-nIaTfUZjT-system  \u2502 @local-er                    \u2502 @local-er                    \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-3 of 3\n")),(0,i.kt)("p",null,"check the edge router attribute"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list edge-routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                        \u2502 ONLINE \u2502 ALLOW TRANSIT \u2502 COST \u2502 ATTRIBUTES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 MvQnOZj4au \u2502 Public-Cloud-NC-edge-router \u2502 true   \u2502 true          \u2502    0 \u2502 public     \u2502\n\u2502 k06PffZjT  \u2502 pub-er                      \u2502 true   \u2502 true          \u2502    0 \u2502            \u2502\n\u2502 nIaTfUZjT  \u2502 local-er                    \u2502 true   \u2502 true          \u2502    0 \u2502            \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-3 of 3\n")),(0,i.kt)("p",null,'Add "public" attribute to "pub-er" router:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'# ziti edge update edge-router pub-er -a "public"\n# ziti edge list edge-routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                        \u2502 ONLINE \u2502 ALLOW TRANSIT \u2502 COST \u2502 ATTRIBUTES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 MvQnOZj4au \u2502 Public-Cloud-NC-edge-router \u2502 true   \u2502 true          \u2502    0 \u2502 public     \u2502\n\u2502 k06PffZjT  \u2502 pub-er                      \u2502 true   \u2502 true          \u2502    0 \u2502 public     \u2502\n\u2502 nIaTfUZjT  \u2502 local-er                    \u2502 true   \u2502 true          \u2502    0 \u2502            \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-3 of 3\n')),(0,i.kt)("h2",{id:"34-setup-tunnel-to-tunnel-ssh-connection"},"3.4 Setup Tunnel to Tunnel ssh connection"),(0,i.kt)("p",null,"In this section, we will be showing how to configure ziti to establish ssh service via our network. We will be using a pseudo dns name (t2tssh.ziti) to establish this connection.  The intercept side (ingress) will be ingress-tunnel, the server side (egress) will be egress-tunnel."),(0,i.kt)("p",null,"For CLI procedures, all commands are done on the ",(0,i.kt)("strong",{parentName:"p"},"controller")),(0,i.kt)("h3",{id:"341-create-a-hostv1-config"},"3.4.1 Create a host.v1 config"),(0,i.kt)("p",null,'This config is used instruct the server-side tunneler how to offload the traffic from the overlay, back to the underlay. We are dropping the traffic off our loopback interface, so we use the address "127.0.0.1\u201c'),(0,i.kt)("h4",{id:"3411-zac"},"3.4.1.1 ZAC"),(0,i.kt)("p",null,"Create the configuration from ",(0,i.kt)("strong",{parentName:"p"},"MANAGE CONFIGURATIONS")," screen."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(90521).Z,width:"670",height:"1175"})),(0,i.kt)("h4",{id:"3412-cli"},"3.4.1.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},'ziti edge create config t2thostconf host.v1 \'{"protocol":"tcp", "address":"127.0.0.1", "port":22}\'\n')),(0,i.kt)("h3",{id:"342-create-an-interceptv1-config"},"3.4.2 Create an intercept.v1 config"),(0,i.kt)("p",null,'This config is used to instruct the intercept-side tunneler how to correctly intercept the targeted traffic and put it onto the overlay. We are setting up intercept on dns name "t2tssh.ziti"'),(0,i.kt)("h4",{id:"3421-zac"},"3.4.2.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(36705).Z,width:"630",height:"979"})),(0,i.kt)("p",null,"Check the provisioned configs on the configuration screen:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(10163).Z,width:"1350",height:"290"})),(0,i.kt)("h4",{id:"3422-cli"},"3.4.2.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},'ziti edge create config t2tintconf intercept.v1 \'{"protocols": ["tcp"], "addresses": ["t2tssh.ziti"], "portRanges": [{"low": 22, "high": 22}]}\'\n')),(0,i.kt)("p",null,"If the command finished successfully, you will see two configs:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list configs\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME        \u2502 CONFIG TYPE  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1R9iDpU7OvREH6LNxQapPO \u2502 t2tintconf  \u2502 intercept.v1 \u2502\n\u2502 gIeZ1KgilGXzkY4RxDF2f  \u2502 t2thostconf \u2502 host.v1      \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,i.kt)("h3",{id:"343-create-service"},"3.4.3 Create Service"),(0,i.kt)("p",null,'Now we need to put these two configs into a service. We going to name the service "t2tssh":'),(0,i.kt)("h4",{id:"3431-zac"},"3.4.3.1 ZAC"),(0,i.kt)("p",null,"Create service from ",(0,i.kt)("strong",{parentName:"p"},"Services")," menu from ",(0,i.kt)("strong",{parentName:"p"},"MANAGE EDGE SERVICES")," screen."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(41978).Z,width:"1021",height:"773"})),(0,i.kt)("h4",{id:"3432-cli"},"3.4.3.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"ziti edge create service t2tssh -c t2tintconf,t2thostconf\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Check Service")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list services\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                    \u2502 NAME   \u2502 ENCRYPTION \u2502 TERMINATOR STRATEGY \u2502 ATTRIBUTES \u2502\n\u2502                       \u2502        \u2502  REQUIRED  \u2502                     \u2502            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 CZJi5tDxTk8C8XymCbu7f \u2502 t2tssh \u2502 true       \u2502 smartrouting        \u2502            \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-1 of 1\n")),(0,i.kt)("p",null,"Please note, the ",(0,i.kt)("strong",{parentName:"p"},"Encryption = true")," and ",(0,i.kt)("strong",{parentName:"p"},"smartrouting")," are default setting."),(0,i.kt)("h3",{id:"344-create-bind-service-policy"},"3.4.4 Create Bind Service policy"),(0,i.kt)("p",null,"Now we need to specify which tunneler (in our case, ",(0,i.kt)("strong",{parentName:"p"},"egress-tunnel"),")is going to host the service by setting up a bind service policy"),(0,i.kt)("h4",{id:"3441-zac"},"3.4.4.1 ZAC"),(0,i.kt)("p",null,"Create a ",(0,i.kt)("strong",{parentName:"p"},"service policy")," from ",(0,i.kt)("strong",{parentName:"p"},"MANAGE SERVICE POLICIES")," screen:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(29257).Z,width:"655",height:"928"})),(0,i.kt)("h4",{id:"3442-cli"},"3.4.4.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"ziti edge create service-policy t2tssh.bind Bind --service-roles '@t2tssh' --identity-roles \"@egress-tunnel\"\n")),(0,i.kt)("h3",{id:"345-create-dial-service-policy"},"3.4.5 Create Dial Service policy"),(0,i.kt)("p",null,"Now we need to specify the intercept side tunneler (",(0,i.kt)("strong",{parentName:"p"},"ingress-tunnel"),") for the service by setting up a dial service policy"),(0,i.kt)("h4",{id:"3451-zac"},"3.4.5.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(79738).Z,width:"676",height:"954"})),(0,i.kt)("p",null,"We should have two service policies created. The services name should match on two policies.  One policy is Bind and the other ons is Dial.  They should be set to different identities."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(5661).Z,width:"1077",height:"318"})),(0,i.kt)("h4",{id:"3452-cli"},"3.4.5.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"ziti edge create service-policy t2tssh.dial Dial --service-roles '@t2tssh' --identity-roles \"@ingress-tunnel\"\n")),(0,i.kt)("p",null,"Make sure both policies are setup correctly\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list service-policies\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME        \u2502 SEMANTIC \u2502 SERVICE ROLES \u2502 IDENTITY ROLES  \u2502 POSTURE CHECK ROLES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 3wATDMvDv1LBRlNrYgsrjf \u2502 t2tssh.bind \u2502 AllOf    \u2502 @t2tssh       \u2502 @egress-tunnel  \u2502                     \u2502\n\u2502 VKIyQz9ZWf0euSDRikNh0  \u2502 t2tssh.dial \u2502 AllOf    \u2502 @t2tssh       \u2502 @ingress-tunnel \u2502                     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,i.kt)("p",null,"You should also make sure the policy advisor display correctly:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge policy-advisor services |grep t2tssh\nOKAY : egress-tunnel (2) -> t2tssh (2) Common Routers: (2/2) Dial: N Bind: Y\nOKAY : ingress-tunnel (2) -> t2tssh (2) Common Routers: (2/2) Dial: Y Bind: N\n")),(0,i.kt)("p",null,'Make sure there is a "Dial" line and a "Bind" line. They are both "OKAY" and has at least 1 Common Routers.'),(0,i.kt)("h3",{id:"346-verify-the-connection"},"3.4.6 Verify the connection"),(0,i.kt)("p",null,"Login to the intercept side tunneler (",(0,i.kt)("strong",{parentName:"p"},"ingress-tunnel"),") node, you should be able to ssh to the server (",(0,i.kt)("strong",{parentName:"p"},"egress-tunnel"),') by using dns name "t2tssh.ziti"'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"root@ingress-tunnel:~# ssh t2tssh.ziti\nWelcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-67-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Mon May 15 19:30:46 UTC 2023\n\n  System load:  0.0               Users logged in:       1\n  Usage of /:   3.3% of 48.27GB   IPv4 address for eth0: 104.131.9.28\n  Memory usage: 11%               IPv4 address for eth0: 10.17.0.7\n  Swap usage:   0%                IPv4 address for eth1: 10.108.0.4\n  Processes:    93                IPv4 address for tun0: 100.64.0.1\n\n * Introducing Expanded Security Maintenance for Applications.\n   Receive updates to over 25,000 software packages with your\n   Ubuntu Pro subscription. Free for personal use.\n\n     https://ubuntu.com/pro\n\nExpanded Security Maintenance for Applications is not enabled.\n\n17 updates can be applied immediately.\n13 of these updates are standard security updates.\nTo see these additional updates run: apt list --upgradable\n\nEnable ESM Apps to receive additional future security updates.\nSee https://ubuntu.com/esm or run: sudo pro status\n\n\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\n\nLast login: Mon May 15 19:08:51 2023 from 45.17.199.35\nroot@egress-tunnel:~# <ctrl-d>\nlogout\nConnection to t2tssh.ziti closed.\nroot@ingress-tunnel:~#\n")),(0,i.kt)("h2",{id:"35-setup-tunnel-to-ert-http-connection"},"3.5 Setup Tunnel to ERT http connection"),(0,i.kt)("p",null,"Edge Router Tunnel (ERT) has combine router and tunneler function. In this section, we will demonstrate a connection between a Ziti-Edge-Tunnel (egress-tunnel) to a ERT (local-er)"),(0,i.kt)("p",null,"The procedure is similar to tunnel to tunnel service, so please refer to that section for detail explanation of each step."),(0,i.kt)("p",null,"Please refer to ",(0,i.kt)("a",{parentName:"p",href:"#312-network-diagram-2"},"Network Diagram 2")," for our test setup."),(0,i.kt)("h3",{id:"351-create-a-hostv1-config"},"3.5.1 Create a host.v1 config"),(0,i.kt)("h4",{id:"3511-zac"},"3.5.1.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(77872).Z,width:"677",height:"1158"})),(0,i.kt)("h4",{id:"3512-cli"},"3.5.1.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},'ziti edge create config t2ehostconf host.v1 \'{"protocol":"tcp", "address":"127.0.0.1", "port":8080}\'\n')),(0,i.kt)("h3",{id:"352-create-an-interceptv1-config"},"3.5.2 Create an intercept.v1 config"),(0,i.kt)("p",null,"Use ip (10.124.0.2) as intercept address"),(0,i.kt)("h4",{id:"3521-zac"},"3.5.2.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(62330).Z,width:"664",height:"976"})),(0,i.kt)("p",null,"And you should have two configs:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(49703).Z,width:"1367",height:"311"})),(0,i.kt)("h4",{id:"3522-cli"},"3.5.2.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},'ziti edge create config t2eintconf intercept.v1 \'{"protocols": ["tcp"], "addresses": ["10.124.0.2"], "portRanges": [{"low": 80, "high": 80}]}\'\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list configs |grep t2e\n\u2502 IlgnlM2srnU7s8C3hiLJA  \u2502 t2eintconf  \u2502 intercept.v1 \u2502\n\u2502 uJUtyXI5XH1wSsSCiCARp  \u2502 t2ehostconf \u2502 host.v1      \u2502\n")),(0,i.kt)("h3",{id:"353-create-service"},"3.5.3 Create Service"),(0,i.kt)("p",null,'Now we need to put these two configs into a service. We going to name the service "t2ehttp":'),(0,i.kt)("h4",{id:"3531-zac"},"3.5.3.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(75704).Z,width:"1034",height:"766"})),(0,i.kt)("h4",{id:"3532-cli"},"3.5.3.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ziti edge create service t2ehttp -c t2eintconf,t2ehostconf\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Check Service")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list services |grep t2e\n\u2502 5FI8Aw0IQ7xaUMgH2rKvps \u2502 t2ehttp \u2502 true       \u2502 smartrouting        \u2502            \u2502\n")),(0,i.kt)("h3",{id:"354-create-bind-service-policy"},"3.5.4 Create Bind Service policy"),(0,i.kt)("h4",{id:"3541-zac"},"3.5.4.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(9695).Z,width:"693",height:"938"})),(0,i.kt)("h4",{id:"3542-cli"},"3.5.4.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"ziti edge create service-policy t2ehttp.bind Bind --service-roles '@t2ehttp' --identity-roles \"@local-er\"\n")),(0,i.kt)("h3",{id:"355-create-dial-service-policy"},"3.5.5 Create Dial Service policy"),(0,i.kt)("p",null,"Now we need to specify the intercept side tunneler (",(0,i.kt)("strong",{parentName:"p"},"egress-tunnel"),") for the service by setting up a dial service policy"),(0,i.kt)("h4",{id:"3551-zac"},"3.5.5.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(69651).Z,width:"704",height:"950"})),(0,i.kt)("p",null,"Check two service polices:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(24866).Z,width:"1079",height:"321"})),(0,i.kt)("h4",{id:"3552-cli"},"3.5.5.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"ziti edge create service-policy t2ehttp.dial Dial --service-roles '@t2ehttp' --identity-roles \"@egress-tunnel\"\n")),(0,i.kt)("p",null,"Make sure both policies are setup correctly\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list service-policies |grep t2e\n\u2502 4XpyRyE6vKo2Rd2gb2x6il \u2502 t2ehttp.dial \u2502 AllOf    \u2502 @t2ehttp      \u2502 @egress-tunnel  \u2502                     \u2502\n\u2502 6bGra4CxFtpe0GmTeACLy  \u2502 t2ehttp.bind \u2502 AllOf    \u2502 @t2ehttp      \u2502 @local-er       \u2502                     \u2502\n")),(0,i.kt)("p",null,"You should also make sure the policy advisor display correctly:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge policy-advisor services |grep t2ehttp\nOKAY : egress-tunnel (2) -> t2ehttp (3) Common Routers: (2/2) Dial: Y Bind: N\nOKAY : local-er (3) -> t2ehttp (3) Common Routers: (3/3) Dial: N Bind: Y\n")),(0,i.kt)("p",null,'Make sure there is a "Dial" line and a "Bind" line. They are both "OKAY" and has at least 1 Common Routers.'),(0,i.kt)("h3",{id:"356-verify-the-connection"},"3.5.6 Verify the connection"),(0,i.kt)("p",null,"Login to the router (",(0,i.kt)("strong",{parentName:"p"},"local-er"),"), setup a file to send via http."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"root@local-er:~# cat >hello.txt\n                    ___ ___                  .___\n                   /   |   \\  ______  _  ____| _/__.__.\n  ______   ______ /    ~    \\/  _ \\ \\/ \\/ / __ <   |  |  ______   ______\n /_____/  /_____/ \\    Y    (  <_> )     / /_/ |\\___  | /_____/  /_____/\n                   \\___|_  / \\____/ \\/\\_/\\____ |/ ____|\n                         \\/                   \\/\\/\n\nThis is hello from local-er.\n")),(0,i.kt)("p",null,"Then start the http server."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"python3 -m http.server 8080\n")),(0,i.kt)("p",null,"Login to the intercept side tunneler (",(0,i.kt)("strong",{parentName:"p"},"egress-tunnel"),") node."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"root@egress-tunnel:~# curl http://10.124.0.2/hello.txt\n                    ___ ___                  .___\n                   /   |   \\  ______  _  ____| _/__.__.\n  ______   ______ /    ~    \\/  _ \\ \\/ \\/ / __ <   |  |  ______   ______\n /_____/  /_____/ \\    Y    (  <_> )     / /_/ |\\___  | /_____/  /_____/\n                   \\___|_  / \\____/ \\/\\_/\\____ |/ ____|\n                         \\/                   \\/\\/\n\nThis is hello from local-er.\nroot@egress-tunnel:~#\n")),(0,i.kt)("h3",{id:"357-conclusion"},"3.5.7 Conclusion"),(0,i.kt)("p",null,"In this section, we demonstrated intercepting http (port 80) request to an IP address and forward the request to a remote http server listening on the port 8080 via ziti network."),(0,i.kt)("h2",{id:"36-setup-connection-from-a-non-openziti-client"},"3.6 Setup Connection from a non-OpenZiti client"),(0,i.kt)("h3",{id:"361-introduction"},"3.6.1 Introduction"),(0,i.kt)("p",null,"In this section, we will demonstrate how to setup non-OpenZiti client to use the ziti service. Please refer to ",(0,i.kt)("a",{parentName:"p",href:"#312-network-diagram-2"},"Network Diagram 2")," for our test setup."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},'You need to create a VM (Non-OpenZiti-Client) in the same data center as "local-er" for this test.')),(0,i.kt)("p",null,"The following conditions need to be met in order for this connection to work correctly:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The non-OpenZiti client has to be in the same data center as the edge router. "),(0,i.kt)("li",{parentName:"ul"},"The edge router is created with tunneler enabled.")),(0,i.kt)("p",null,"We are also need to do the following to successfully demonstrate the connection:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create host and intercept config"),(0,i.kt)("li",{parentName:"ul"},"Create service"),(0,i.kt)("li",{parentName:"ul"},"Create dial and bind policy"),(0,i.kt)("li",{parentName:"ul"},"Setup route on the non-OpenZiti client")),(0,i.kt)("p",null,"We will create an intercept at ",(0,i.kt)("strong",{parentName:"p"},"11.11.11.11:80")," and ",(0,i.kt)("strong",{parentName:"p"},"e2thttp.ziti"),", and drop off at loopback address (127.0.0.1) of ",(0,i.kt)("strong",{parentName:"p"},"egress-tunnel")," port (80)."),(0,i.kt)("h3",{id:"362-create-a-hostv1-config"},"3.6.2 Create a host.v1 config"),(0,i.kt)("p",null,"Used address ",(0,i.kt)("strong",{parentName:"p"},"127.0.0.1")," as host side destination, and port ",(0,i.kt)("strong",{parentName:"p"},"80")," as destination port."),(0,i.kt)("h4",{id:"3621-zac"},"3.6.2.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(85435).Z,width:"537",height:"1021"})),(0,i.kt)("h4",{id:"3622-cli"},"3.6.2.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},'ziti edge create config e2thostconf host.v1 \'{"protocol":"tcp", "address":"127.0.0.1", "port":80}\'\n')),(0,i.kt)("h3",{id:"363-create-an-interceptv1-config"},"3.6.3 Create an intercept.v1 config"),(0,i.kt)("p",null,"Use a pseudo ip (11.11.11.11) and DNS name (e2thttp.ziti) as intercept address"),(0,i.kt)("h4",{id:"3631-zac"},"3.6.3.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(92388).Z,width:"687",height:"1087"})),(0,i.kt)("p",null,"And you should have two configs:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(4206).Z,width:"1083",height:"317"})),(0,i.kt)("h4",{id:"3632-cli"},"3.6.3.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},'ziti edge create config e2tintconf intercept.v1 \'{"protocols": ["tcp"], "addresses": ["11.11.11.11","e2thttp.ziti"], "portRanges": [{"low": 80, "high": 80}]}\'\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list configs |grep e2t\n\u2502 1ANNy88ovJL6vAW6AwNbiM \u2502 e2thostconf \u2502 host.v1      \u2502\n\u2502 5kXnoEoMrfReOou8lty9zj \u2502 e2tintconf  \u2502 intercept.v1 \u2502\n")),(0,i.kt)("h3",{id:"364-create-service"},"3.6.4 Create Service"),(0,i.kt)("p",null,'Now we need to put these two configs into a service. We going to name the service "t2ehttp":'),(0,i.kt)("h4",{id:"3641-zac"},"3.6.4.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(78837).Z,width:"880",height:"641"})),(0,i.kt)("h4",{id:"3642-cli"},"3.6.4.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ziti edge create service e2thttp -c e2thostconf,e2tintconf\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Check Service")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list services  |grep e2t\n\u2502 2uphDaBfIo7ubj6GhV8r93 \u2502 e2thttp \u2502 true       \u2502 smartrouting        \u2502            \u2502\n")),(0,i.kt)("h3",{id:"365-create-bind-service-policy"},"3.6.5 Create Bind Service policy"),(0,i.kt)("h4",{id:"3651-zac"},"3.6.5.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(95104).Z,width:"536",height:"739"})),(0,i.kt)("h4",{id:"3652-cli"},"3.6.5.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"ziti edge create service-policy e2thttp.bind Bind --service-roles '@e2thttp' --identity-roles \"@egress-tunnel\"\n")),(0,i.kt)("h3",{id:"366-create-dial-service-policy"},"3.6.6 Create Dial Service policy"),(0,i.kt)("p",null,"Now we need to specify the intercept side tunneler (",(0,i.kt)("strong",{parentName:"p"},"local-er"),") for the service by setting up a dial service policy"),(0,i.kt)("h4",{id:"3661-zac"},"3.6.6.1 ZAC"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(84192).Z,width:"533",height:"750"})),(0,i.kt)("p",null,"Check two service polices:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Diagram",src:n(9509).Z,width:"1163",height:"247"})),(0,i.kt)("h4",{id:"3662-cli"},"3.6.6.2 CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"ziti edge create service-policy e2thttp.dial Dial --service-roles '@e2thttp' --identity-roles \"@local-er\"\n")),(0,i.kt)("p",null,"Make sure both policies are setup correctly\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list service-policies |grep e2t\n\u2502 305novDIduhXPEmA8gawpM \u2502 e2thttp.dial \u2502 AllOf    \u2502 @e2thttp      \u2502 @local-er       \u2502                     \u2502\n\u2502 5zfoMaXKNDe3uIih8YHEWa \u2502 e2thttp.bind \u2502 AllOf    \u2502 @e2thttp      \u2502 @egress-tunnel  \u2502                     \u2502\n")),(0,i.kt)("p",null,"You should also make sure the policy advisor display correctly:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge policy-advisor services |grep e2thttp\nOKAY : egress-tunnel (2) -> e2thttp (3) Common Routers: (2/2) Dial: N Bind: Y\nOKAY : local-er (3) -> e2thttp (3) Common Routers: (3/3) Dial: Y Bind: N\n")),(0,i.kt)("p",null,'Make sure there is a "Dial" line and a "Bind" line. They are both "OKAY" and has at least 1 Common Routers.'),(0,i.kt)("h3",{id:"367-verify-the-connection"},"3.6.7 Verify the connection"),(0,i.kt)("h4",{id:"3671-setup-server-side"},"3.6.7.1 Setup Server Side"),(0,i.kt)("p",null,"Login to the Client (",(0,i.kt)("strong",{parentName:"p"},"egress-tunnel"),"), setup a file to send via http."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'root@egress-tunnel:~# cat >hello.txt\n              _   _      _ _\n             | | | | ___| | | ___\n  _____ _____| |_| |/ _ \\ | |/ _ \\ _____ _____\n |_____|_____|  _  |  __/ | | (_) |_____|_____|\n             |_| |_|\\___|_|_|\\___/\n\n\nYou have reached the "egress-tunnel".\n')),(0,i.kt)("p",null,"Then start the http server."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"sudo python3 -m http.server 80\n")),(0,i.kt)("p",null,"Then login to the non-OpenZiti client machine (",(0,i.kt)("strong",{parentName:"p"},"Non-OpenZiti-Client"),")."),(0,i.kt)("h4",{id:"3672-test-ip-intercept"},"3.6.7.2 Test IP intercept"),(0,i.kt)(a.Z,{defaultValue:"Azure",values:[{label:"Azure",value:"Azure"},{label:"AWS",value:"AWS"},{label:"Google",value:"GCP"},{label:"Digital Ocean",value:"DigitalOcean"},{label:"Oracle",value:"OCI"},{label:"IBM",value:"IBM"}],mdxType:"Tabs"},(0,i.kt)(l.Z,{value:"DigitalOcean",mdxType:"TabItem"},(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"setup the route first"),". The route is via our ER in the same DC (10.124.0.2)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"root@Non-OpenZiti-Client:~# sudo ip route add 11.11.11.11/32 via 10.124.0.2\n"))),(0,i.kt)(l.Z,{value:"Azure",mdxType:"TabItem"}),(0,i.kt)(l.Z,{value:"GCP",mdxType:"TabItem"}),(0,i.kt)(l.Z,{value:"OCI",mdxType:"TabItem"}),(0,i.kt)(l.Z,{value:"IBM",mdxType:"TabItem"},(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"setup the route first"),". The route is via our ER in the same DC (10.162.209.220)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"root@Non-OpenZiti-Client:~# sudo ip route add 11.11.11.11/32 via 10.162.209.220\n")))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"test the connection")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'root@Non-OpenZiti-Client:~# curl http://11.11.11.11/hello.txt\n              _   _      _ _\n             | | | | ___| | | ___\n  _____ _____| |_| |/ _ \\ | |/ _ \\ _____ _____\n |_____|_____|  _  |  __/ | | (_) |_____|_____|\n             |_| |_|\\___|_|_|\\___/\n\n\nYou have reached the "egress-tunnel".\nroot@Non-OpenZiti-Client:~#\n')),(0,i.kt)("h4",{id:"3673-modify-the-resolver"},"3.6.7.3 Modify the resolver"),(0,i.kt)("p",null,"The ",(0,i.kt)("strong",{parentName:"p"},"Non-OpenZiti-Client"),"'s resolver has to point to the local-er.  So it can resolve the DNS name from local-er."),(0,i.kt)(a.Z,{defaultValue:"Azure",values:[{label:"Azure",value:"Azure"},{label:"AWS",value:"AWS"},{label:"Google",value:"GCP"},{label:"Digital Ocean",value:"DigitalOcean"},{label:"Oracle",value:"OCI"},{label:"IBM",value:"IBM"}],mdxType:"Tabs"},(0,i.kt)(l.Z,{value:"Azure",mdxType:"TabItem"},(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("strong",{parentName:"li"},"/etc/systemd/resolved.conf"),"."),(0,i.kt)("li",{parentName:"ul"},'Put local IP of the "local-er" into the file. '),(0,i.kt)("li",{parentName:"ul"},"For example:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"DNS=10.5.0.4  #local private IP of the ER\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"NOTE, the IP address should match your Next hop in the route table")),(0,i.kt)("p",null,"Restart the systemd-resolved service "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"sudo systemctl restart systemd-resolved.service\n"))),(0,i.kt)(l.Z,{value:"AWS",mdxType:"TabItem"},(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("strong",{parentName:"li"},"/etc/systemd/resolved.conf"),"."),(0,i.kt)("li",{parentName:"ul"},'Put local IP of the "local-er" into the file.'),(0,i.kt)("li",{parentName:"ul"},"For example:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"DNS=10.5.0.4  #local private IP of the ER\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"NOTE, the IP address should match your Next hop in the route table")),(0,i.kt)("p",null,"Restart the systemd-resolved service"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"sudo systemctl restart systemd-resolved.service\n"))),(0,i.kt)(l.Z,{value:"GCP",mdxType:"TabItem"},(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("strong",{parentName:"li"},"/etc/systemd/resolved.conf"),"."),(0,i.kt)("li",{parentName:"ul"},'Put local IP of the "local-er" into the file.'),(0,i.kt)("li",{parentName:"ul"},"For example:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"DNS=10.138.0.2  #local private IP of the local ER\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"NOTE, the IP address should match your Next hop in the route table")),(0,i.kt)("p",null,"Restart the systemd-resolved service"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"sudo systemctl restart systemd-resolved.service\n"))),(0,i.kt)(l.Z,{value:"DigitalOcean",mdxType:"TabItem"},(0,i.kt)("p",null,'Modify "/etc/systemd/resolved.conf.d/DigitalOcean.conf" to point to the local IP of the "local-er".'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"root@Non-OpenZiti-Client:~# cat /etc/systemd/resolved.conf.d/DigitalOcean.conf\n[Resolve]\nDNS=144.126.220.15\n")),(0,i.kt)("p",null,"Restart the systemd-resolved service"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"sudo systemctl restart systemd-resolved.service\n"))),(0,i.kt)(l.Z,{value:"OCI",mdxType:"TabItem"},(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("strong",{parentName:"li"},"/etc/systemd/resolved.conf"),"."),(0,i.kt)("li",{parentName:"ul"},'Put local IP of the "local-er" into the file.'),(0,i.kt)("li",{parentName:"ul"},"For example:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"DNS=10.5.0.4  #local private IP of the ER\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},'NOTE, the IP address should match your "Target Selection" in the route table')),(0,i.kt)("p",null,"Restart the systemd-resolved service"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"sudo systemctl restart systemd-resolved.service\n"))),(0,i.kt)(l.Z,{value:"IBM",mdxType:"TabItem"},(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("strong",{parentName:"li"},"/etc/systemd/resolved.conf"),". "),(0,i.kt)("li",{parentName:"ul"},"Put ",(0,i.kt)("strong",{parentName:"li"},"Public IP"),' of the "local-er" into the file.'),(0,i.kt)("li",{parentName:"ul"},"For example:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"DNS=169.45.71.226    #Public IP of the ER\n")),(0,i.kt)("p",null,"Restart the systemd-resolved service"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"sudo systemctl restart systemd-resolved.service\n")))),(0,i.kt)("h4",{id:"3674-test-dns-intercept"},"3.6.7.4 Test DNS intercept"),(0,i.kt)(a.Z,{defaultValue:"Azure",values:[{label:"Azure",value:"Azure"},{label:"AWS",value:"AWS"},{label:"Google",value:"GCP"},{label:"Digital Ocean",value:"DigitalOcean"},{label:"Oracle",value:"OCI"},{label:"IBM",value:"IBM"}],mdxType:"Tabs"},(0,i.kt)(l.Z,{value:"DigitalOcean",mdxType:"TabItem"},(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"setup the route first"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The route is via our ER in the same DC (10.124.0.2)"),(0,i.kt)("li",{parentName:"ul"},"We need to setup the route for 100.64/10 subnet")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"root@Non-OpenZiti-Client:~# sudo ip route add 100.64.0.0/10 via 10.124.0.2\n"))),(0,i.kt)(l.Z,{value:"Azure",mdxType:"TabItem"}),(0,i.kt)(l.Z,{value:"GCP",mdxType:"TabItem"}),(0,i.kt)(l.Z,{value:"OCI",mdxType:"TabItem"}),(0,i.kt)(l.Z,{value:"IBM",mdxType:"TabItem"},(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"setup the route first"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The route is via our ER in the same DC (10.162.209.220)"),(0,i.kt)("li",{parentName:"ul"},"We need to setup the route for 100.64/10 subnet")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"root@Non-OpenZiti-Client:~# sudo ip route add 100.64.0.0/10 via 10.162.209.220\n")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'root@Non-OpenZiti-Client:~# curl http://e2thttp.ziti/hello.txt\n              _   _      _ _\n             | | | | ___| | | ___\n  _____ _____| |_| |/ _ \\ | |/ _ \\ _____ _____\n |_____|_____|  _  |  __/ | | (_) |_____|_____|\n             |_| |_|\\___|_|_|\\___/\n\n\nYou have reached the "egress-tunnel".\nBye.\nroot@Non-OpenZiti-Client:~# \n')),(0,i.kt)("h2",{id:"37-setup-sdk-enabled-application-to-access-a-server"},"3.7 Setup SDK enabled application to access a server"),(0,i.kt)("h3",{id:"371-introduction"},"3.7.1 Introduction"),(0,i.kt)("p",null,"In this section, we will demonstrate how to setup OpenZiti service to access a server from a SDK enabled application. Please refer to ",(0,i.kt)("a",{parentName:"p",href:"#313-network-diagram-3"},"Network Diagram 3")," for our test setup."),(0,i.kt)("h3",{id:"372-sdk-application-client"},"3.7.2 SDK Application client"),(0,i.kt)("p",null,"We are going to use an existing ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/openziti/sdk-golang/tree/main/example/curlz"},"SDK implementation")," for this guide."),(0,i.kt)("p",null,"Please create a linux server (i.e. Ubuntu22.04) that can compile golang. If you have followed the previous example, you can use any node you already created (i.e ingress-tunnel node) for this exercise.  Install ",(0,i.kt)("strong",{parentName:"p"},"go")," before you proceed further. To install latest go, please following ",(0,i.kt)("a",{parentName:"p",href:"https://go.dev/doc/install"},"go.dev installation link"),"."),(0,i.kt)("p",null,"Check out the code from the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/openziti/sdk-golang.git"},"github repo"),"."),(0,i.kt)("p",null,"example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# git clone https://github.com/openziti/sdk-golang.git\n")),(0,i.kt)("p",null,"cd to the curlz directory (example/curlz)."),(0,i.kt)("p",null,"example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# cd sdk-golang/example/curlz\n")),(0,i.kt)("p",null,"build the curlz binary"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"go mod tidy\ngo build .\n")),(0,i.kt)("p",null,"If all goes well, you will find a ",(0,i.kt)("strong",{parentName:"p"},"curlz")," binary under that directory."),(0,i.kt)("p",null,"Next, you need to create an identity for this SDK Application."),(0,i.kt)("p",null,"Login to the controller"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# source the aliases for ziti (do it the first time you login to the VM)\nsource ~/.ziti/quickstart/$(hostname -s)/$(hostname -s).env\n# connect to ziti cli (do this when the token expired)\nzitiLogin\n# create identity for client\nziti edge create identity curlz-client -a curlz.clients -o curlz-client.jwt\n# enroll identity\nziti edge enroll --jwt curlz-client.jwt\n")),(0,i.kt)("p",null,"Once the enrollment is complete, there will be a ",(0,i.kt)("strong",{parentName:"p"},"curlz-client.json")," file under the current directory. Transfer the file (",(0,i.kt)("strong",{parentName:"p"},"curlz-client.json"),") to your SDK Application client machine, place it under the ",(0,i.kt)("strong",{parentName:"p"},"curlz")," directory."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"NOTE"),' We will refer this node as "sdk-application-client", we will come back to this node when we are ready to test the connection.'),(0,i.kt)("h3",{id:"373-create-a-hostv1-config"},"3.7.3 Create a host.v1 config"),(0,i.kt)("p",null,"Used address ",(0,i.kt)("strong",{parentName:"p"},"loopback")," as host side destination, and port ",(0,i.kt)("strong",{parentName:"p"},"8000")," as destination port."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create config curlz.hostv1 host.v1 \'{"protocol":"tcp", "address":"localhost","port":\'8000\'}\'\n')),(0,i.kt)("h3",{id:"374-create-service"},"3.7.4 Create Service"),(0,i.kt)("p",null,'Now we need to put the config into a service. We going to name the service "curlzService":'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'ziti edge create service curlzService --configs "curlz.hostv1"\n')),(0,i.kt)("h3",{id:"375-create-bind-service-policy"},"3.7.5 Create Bind Service policy"),(0,i.kt)("p",null,'Specify host side endpoints by using the "Bind" service policy'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy curlz-client-bind Bind --identity-roles '@egress-tunnel' --service-roles '@curlzService'\n")),(0,i.kt)("h3",{id:"376-create-dial-service-policy"},"3.7.6 Create Dial Service policy"),(0,i.kt)("p",null,"Now we need to specify the intercept side SDK application (",(0,i.kt)("strong",{parentName:"p"},"#curlz.clients"),") for the service by setting up a dial service policy"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy curlz-client-dial Dial --identity-roles '#curlz.clients' --service-roles '@curlzService'\n")),(0,i.kt)("p",null,"Make sure both policies are setup correctly\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list service-policies |grep curlz\n\u2502 1f169JyYjsljrkxWbAabNc \u2502 curlz-client-dial   \u2502 AllOf    \u2502 @curlzService      \u2502 #curlz.clients                   \u2502                     \u2502\n\u2502 5xvUxAES5g2uQkjDolBOka \u2502 curlz-client-bind   \u2502 AllOf    \u2502 @curlzService      \u2502 @egress-tunnel                   \u2502                     \u2502\n")),(0,i.kt)("p",null,"You should also make sure the policy advisor display correctly:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge policy-advisor services |grep curlzService\nOKAY : curlz-client (1) -> curlzService (1) Common Routers: (1/1) Dial: Y Bind: N\nOKAY : egress-tunnel (1) -> curlzService (1) Common Routers: (1/1) Dial: N Bind: Y\n")),(0,i.kt)("p",null,'Make sure there is a "Dial" line and a "Bind" line. They are both "OKAY" and has at least 1 Common Routers.'),(0,i.kt)("h3",{id:"377-setup-server-side"},"3.7.7 Setup Server Side"),(0,i.kt)("p",null,"Login to the Client (",(0,i.kt)("strong",{parentName:"p"},"egress-tunnel"),'), make sure "hello.txt" is still there from previous step. If not, ',(0,i.kt)("a",{parentName:"p",href:"#367-verify-the-connection"},"recreate it"),"."),(0,i.kt)("p",null,"Then start the http server."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"python3 -m http.server \n")),(0,i.kt)("h3",{id:"378-verify-the-connection"},"3.7.8 Verify the connection"),(0,i.kt)("p",null,'Then login to the "',(0,i.kt)("a",{parentName:"p",href:"#372-sdk-application-client"},"sdk-application-client"),'" node.'),(0,i.kt)("p",null,'Make sure you are under the "curlz" directory, start the application by using the service name and the registered client identity.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"./curlz http://<service name>/hello.txt <identity>\n")),(0,i.kt)("p",null,"example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"./curlz http://curlzService/hello.txt curlz-client.json\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'# ./curlz http://curlzService/hello.txt curlz-client.json\n              _   _      _ _\n             | | | | ___| | | ___\n  _____ _____| |_| |/ _ \\ | |/ _ \\ _____ _____\n |_____|_____|  _  |  __/ | | (_) |_____|_____|\n             |_| |_|\\___|_|_|\\___/\n\n\nYou have reached the "egress-tunnel".\n')),(0,i.kt)("p",null,"You have successfully connected SDK application to the server."),(0,i.kt)("h2",{id:"38-access-a-sdk-enabled-application-via-ziti-tunnel"},"3.8 Access a SDK enabled application via ziti-tunnel"),(0,i.kt)("h3",{id:"381-introduction"},"3.8.1 Introduction"),(0,i.kt)("p",null,"In this section, we will demonstrate how to setup OpenZiti service to access a SDK enabled application via ziti-tunnel. Please refer to ",(0,i.kt)("a",{parentName:"p",href:"#314-network-diagram-4"},"Network Diagram 4")," for our test setup."),(0,i.kt)("h3",{id:"382-sdk-application-server"},"3.8.2 SDK Application server"),(0,i.kt)("p",null,"We are going to use an existing ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/openziti/sdk-golang/tree/main/example/simple-server"},"SDK implementation")," for this guide."),(0,i.kt)("p",null,"Please create a linux server (i.e. Ubuntu22.04) that can compile golang. If you have followed the previous example, you can use any node you already created (i.e egress-tunnel node) for this exercise.  Install ",(0,i.kt)("strong",{parentName:"p"},"go")," before you proceed further."),(0,i.kt)("p",null,"Check out the code from the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/openziti/sdk-golang.git"},"github repo"),"."),(0,i.kt)("p",null,"example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# git clone https://github.com/openziti/sdk-golang.git\n")),(0,i.kt)("p",null,"cd to the simple-server directory (example/simple-server)."),(0,i.kt)("p",null,"example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# cd sdk-golang/example/simple-server\n")),(0,i.kt)("p",null,"build the simple-server binary"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"go mod tidy\ngo build .\n")),(0,i.kt)("p",null,"If all goes well, you will find a ",(0,i.kt)("strong",{parentName:"p"},"simple-server")," binary under that directory."),(0,i.kt)("p",null,"By examining the code (simple-server.go), you can see we are using port ",(0,i.kt)("strong",{parentName:"p"},"8080")," for our server. (Note, the port is also mentioned in README file). This port will be used to create host.v1 config later."),(0,i.kt)("p",null,"Next, you need to create an identity for this SDK Application server."),(0,i.kt)("p",null,"Login to the controller"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# source the aliases for ziti (do it the first time you login to the VM)\nsource ~/.ziti/quickstart/$(hostname -s)/$(hostname -s).env\n# connect to ziti cli (do this when the token expired)\nzitiLogin\n# create identity for server\nziti edge create identity simple-server -a simpleserver.servers -o simple-server.jwt\n# enroll identity\nziti edge enroll --jwt simple-server.jwt\n")),(0,i.kt)("p",null,"Once the enrollment is complete, there will be a ",(0,i.kt)("strong",{parentName:"p"},"simple-server.json")," file under the current directory. Transfer the file (",(0,i.kt)("strong",{parentName:"p"},"simple-server.json"),") to your SDK Application server machine, place it under the ",(0,i.kt)("strong",{parentName:"p"},"simple-server")," directory."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"NOTE"),' We will refer this node as "sdk-application-server", we will come back to this node when we are ready to test the connection.'),(0,i.kt)("h3",{id:"383-hostv1-config"},"3.8.3 host.v1 config"),(0,i.kt)("p",null,"Since the server is a SDK application, there is no need for host.v1 config. "),(0,i.kt)("h3",{id:"384-create-an-interceptv1-config"},"3.8.4 Create an intercept.v1 config"),(0,i.kt)("p",null,'The intercept config is used to instruct the intercept-side tunneler how to correctly intercept the targeted traffic and put it onto the overlay. We are setting up intercept on dns name "simpleService.ziti", and we are going to intercept on port 80.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create config simple.interceptv1 intercept.v1 \'{"protocols": ["tcp"], "addresses": ["simpleService.ziti"], "portRanges": [{"low": 80, "high": 80}]}\'\n')),(0,i.kt)("h3",{id:"385-create-service"},"3.8.5 Create Service"),(0,i.kt)("p",null,"Usually we need to put two configs (host.v1 and intercept.v1) into a service. Since the SDK application server does not need a host.v1 config, we only need to put intercept.v1 (where the traffic comes from) into the service."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create service simpleService --configs "simple.interceptv1" --role-attributes simple-service\n')),(0,i.kt)("h3",{id:"386-create-bind-service-policy"},"3.8.6 Create Bind Service policy"),(0,i.kt)("p",null,'Specify host side endpoints by using the "Bind" service policy'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy simple-client-bind Bind --identity-roles '#simpleserver.servers' --service-roles '#simple-service'\n")),(0,i.kt)("h3",{id:"387-create-dial-service-policy"},"3.8.7 Create Dial Service policy"),(0,i.kt)("p",null,"The dial policy specifies intercept side endpoints."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy simple-client-dial Dial --identity-roles '@ingress-tunnel' --service-roles '#simple-service'\n")),(0,i.kt)("p",null,"Make sure both policies are setup correctly\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list service-policies |grep simple-client\n\u2502 2PQ7Ct6EvK7093qhTyhhe4 \u2502 simple-client-bind  \u2502 AllOf    \u2502 #simple-service    \u2502 #simpleserver.servers            \u2502                     \u2502\n\u2502 7bq9Nag5t5fJyqEYJCiq18 \u2502 simple-client-dial  \u2502 AllOf    \u2502 #simple-service    \u2502 @ingress-tunnel                  \u2502                     \u2502\n")),(0,i.kt)("p",null,"You should also make sure the policy advisor display correctly:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge policy-advisor services |grep simpleService\nOKAY : simple-server (1) -> simpleService (1) Common Routers: (1/1) Dial: N Bind: Y\nOKAY : ingress-tunnel (1) -> simpleService (1) Common Routers: (1/1) Dial: Y Bind: N\n")),(0,i.kt)("p",null,'Make sure there is a "Dial" line and a "Bind" line. They are both "OKAY" and has at least 1 Common Routers.'),(0,i.kt)("h3",{id:"388-setup-server-side"},"3.8.8 Setup Server Side"),(0,i.kt)("p",null,'Login to the "',(0,i.kt)("a",{parentName:"p",href:"#382-sdk-application-server"},"sdk-application-server"),'" node, make sure you are under the "simple-server" directory, start the server by using the registered server identity and service name.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"./simple-server <identity> <service name>\n")),(0,i.kt)("p",null,"example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"./simple-server simple-server.json simpleService\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ ./simple-server simple-server.json simpleService\nlistening for non-ziti requests on localhost:8080\nUsing the provided service name [simpleService]listening for requests for Ziti service simpleService\nINFO[0000] new service session                           session token=806969a4-31d1-4c15-ac56-4998322f9b3e\n")),(0,i.kt)("h3",{id:"389-verify-the-connection"},"3.8.9 Verify the connection"),(0,i.kt)("p",null,"Login to the Client (",(0,i.kt)("strong",{parentName:"p"},"ingress-tunnel"),'), try the service with the service name we create and any text in the "name" field.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"curl http://<service name>?name=<any name>\n")),(0,i.kt)("p",null,"example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://simpleService.ziti?name='the-greatest-show-on-earth'\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ curl http://simpleService.ziti?name='the-greatest-show-on-earth'\nHello, the-greatest-show-on-earth, from ziti\n")),(0,i.kt)("h2",{id:"39-setup-sdk-client-to-sdk-server-connection"},"3.9 Setup SDK Client to SDK Server connection"),(0,i.kt)("h3",{id:"391-introduction"},"3.9.1 Introduction"),(0,i.kt)("p",null,"In this section, we will demonstrate how to connect a SDK enabled application to SDK enabled server. Please refer to ",(0,i.kt)("a",{parentName:"p",href:"#315-network-diagram-5"},"Network Diagram 5")," for our test setup."),(0,i.kt)("h3",{id:"392-sdk-application-client-and-server"},"3.9.2 SDK Application client and server"),(0,i.kt)("p",null,"We are going to use an existing ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/openziti/sdk-golang/tree/main/example/chat"},"SDK implementation")," for this guide. Since this example includes both client and server code, we will show how to compile it once. You can also copy the executable to the other server."),(0,i.kt)("p",null,'You will need two linux servers for this demo. You can use the "ingress-tunnel" (as SDK client) and "egress-tunnel" (as SDK server).'),(0,i.kt)("p",null,"Install ",(0,i.kt)("strong",{parentName:"p"},"go")," before you proceed further."),(0,i.kt)("p",null,"Check out the code from the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/openziti/sdk-golang.git"},"github repo"),"."),(0,i.kt)("p",null,"example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# git clone https://github.com/openziti/sdk-golang.git\n")),(0,i.kt)("p",null,"cd to the chat directory (example/chat)."),(0,i.kt)("p",null,"example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# cd sdk-golang/example/chat\n")),(0,i.kt)("p",null,"build the chat binaries"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir build\ngo mod tidy\ngo build -o build ./...\n")),(0,i.kt)("p",null,"If all goes well, you will find a ",(0,i.kt)("strong",{parentName:"p"},"chat-client")," and ",(0,i.kt)("strong",{parentName:"p"},"chat-server"),' binary under the "build" directory.'),(0,i.kt)("p",null,'Next, you need to create identities for this SDK Application client ("chat.client") and server ("chat.server").'),(0,i.kt)("p",null,"Login to the controller"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# source the aliases for ziti (do it the first time you login to the VM)\nsource ~/.ziti/quickstart/$(hostname -s)/$(hostname -s).env\n# connect to ziti cli (do this when the token expired)\nzitiLogin\n# create identities\nziti edge create identity chat-client -a chat.clients -o chat-client.jwt\nziti edge create identity chat-server -a chat.servers -o chat-server.jwt\n# enroll identities\nziti edge enroll --jwt chat-client.jwt\nziti edge enroll --jwt chat-server.jwt\n")),(0,i.kt)("p",null,"Once the enrollment is complete, there will be two json files: ",(0,i.kt)("strong",{parentName:"p"},"chat-client.json")," and ",(0,i.kt)("strong",{parentName:"p"},"chat-server.json")," under the current directory. Transfer the client file (",(0,i.kt)("strong",{parentName:"p"},"chat-client.json"),") to your SDK Application client machine and both files to your server machine, place them under the ",(0,i.kt)("strong",{parentName:"p"},"chat/build")," directory."),(0,i.kt)("h3",{id:"393-create-service"},"3.9.3 Create Service"),(0,i.kt)("p",null,'For SDK clent connect to SDK client, there is no config needed. We just need to create a service. Please note, the service name has to be "chat"'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service chat --role-attributes chat-service\n")),(0,i.kt)("h3",{id:"394-create-bind-service-policy"},"3.9.4 Create Bind Service policy"),(0,i.kt)("p",null,'Specify host side endpoints by using the "Bind" service policy'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy chat.dial Dial --identity-roles '#chat.clients' --service-roles '#chat-service'\n")),(0,i.kt)("h3",{id:"395-create-dial-service-policy"},"3.9.5 Create Dial Service policy"),(0,i.kt)("p",null,"The dial policy specifies intercept side endpoints."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy chat.bind Bind --identity-roles '#chat.servers' --service-roles '#chat-service'\n")),(0,i.kt)("p",null,"Make sure both policies are setup correctly\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge list service-policies |grep chat\n\u2502 2u9hmMVIj4B3vk016DCWAW \u2502 chat.dial           \u2502 AllOf    \u2502 #chat-service      \u2502 #chat.clients                    \u2502                     \u2502\n\u2502 7Pqk6mCdpyJ5A4cqcHaeXd \u2502 chat.bind           \u2502 AllOf    \u2502 #chat-service      \u2502 #chat.servers                    \u2502                     \u2502\n")),(0,i.kt)("p",null,"You should also make sure the policy advisor display correctly:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# ziti edge policy-advisor services |grep chat\nOKAY : chat-client (1) -> chatService (1) Common Routers: (1/1) Dial: Y Bind: N\nOKAY : chat-server (1) -> chatService (1) Common Routers: (1/1) Dial: N Bind: Y\n")),(0,i.kt)("p",null,'Make sure there is a "Dial" line and a "Bind" line. They are both "OKAY" and has at least 1 Common Routers.'),(0,i.kt)("h3",{id:"396-chat-server"},"3.9.6 Chat Server"),(0,i.kt)("p",null,'The Chat Server relays the communicates between clients. So, let\'s start te server first.\nMake sure you are under the directory: "chat/build"'),(0,i.kt)("p",null,"Run the server:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"./chat-server chat-server.json\n")),(0,i.kt)("p",null,"As the clients login to the server, you will see output like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"INFO[0000] binding service chat\nINFO[0000] new service session                           session token=3a3fa473-0bac-42ed-8bff-ff3d91ef7b1f\nINFO[0049] new connection\nINFO[0049] client 'Adam' connected\nINFO[0196] new connection\nINFO[0196] client 'Bryan' connected\n")),(0,i.kt)("h3",{id:"397-test-chat"},"3.9.7 Test Chat"),(0,i.kt)("p",null,"We will start the chat clients on different machines. Then you can start the chat.  Following is an example communication between two Clients (Adam and Bryan)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"########### SDK Client (Adam) ############  ########### SDK Server (Bryan) ############\n# $ ./chat-client Adam chat-client.json  #  # $ ./chat-client Bryan chat-client.json  # \n# I am Adam                              #  #                                         #\n#                                        #  # Adam: I am Adam                         #\n#                                        #  # Hi Adam                                 #\n# Bryan: Hi Adam                         #  #                                         #\n#                                        #  # I am Bryan                              #\n# Bryan: I am Bryan                      #  #                                         #\n# Nice to meet you                       #  #                                         #\n#                                        #  # Adam: Nice to meet you                  #\n#######################################################################################\n")))}m.isMDXComponent=!0},11505:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services01-61792245b6072a2f6661db90a3661c8b.jpg"},88814:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services02-3-36e782ab138c2980d452073808f2c2b8.jpg"},8055:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services02-4-6e4a971bace90f40b329639943ee4122.jpg"},84605:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services02-5-c86479d34ff4112a02f80bf713168b55.jpg"},57452:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services02-74cf8238fe137e14aa6ce35cd4b2751c.jpg"},42607:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services03-router-958eb8f321360ea5cebca5fd44fa60b1.jpg"},6404:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services04-router-59da96bc899e178e00b7f6121496d003.jpg"},43663:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services05-CreateService-14fc00ea875e65dd6338082808248bf6.jpg"},77766:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services06-CreateService-5b98a3fb5217a17fcb19187ffbc7c5f8.jpg"},80236:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services07-router-policy-76c57aae0a8b456f15ccb274520be869.jpg"},31441:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services08-router-update-33fa2ee102671b37607ac640c057261a.jpg"},99895:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services09-router-update-891a0bc324577d0677b602e1642f78a6.jpg"},90521:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services10-655bc71be07a63761fc0696f4bf26f01.png"},36705:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services11-362ff69194eb84b5d7874525425d22dd.png"},10163:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services12-a4ab3663ce31dbffd8294dbbfc0d3755.png"},41978:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services13-ea447061d73ef380988bac6bf5a508cd.png"},29257:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services15-Bind-cd66dd2e890796bb1c2f18375c2a49cf.jpg"},79738:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services16-Dial-85baa03e9e62404507d6e31661b4e442.jpg"},5661:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services17-2a73e11039bda1f973c41c41fca5fe9b.jpg"},77872:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services20-4dbd9e18442fcfb6852aba33653602cf.png"},62330:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services21-eb83684b9ed2767713217e2e0299544f.png"},49703:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services22-61684fc739691d1ae4a0e39a71f09718.png"},75704:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services23-7283400f2e927e467cdf18a6c05e90d2.png"},9695:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services25-Bind-fe90c916660c8e5d4831ba7309886bca.jpg"},69651:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services26-Dial-3cf10c188b73a4638609901cad7e70a3.jpg"},24866:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services27-d325e87377f8fe2fbb66b4d6f699e28f.jpg"},85435:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services30-2f7951662615ae058a5aec5ad9d3dfbf.jpg"},92388:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services31-3b2edef6d1daa924f496fb44775c85ba.jpg"},4206:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services32-967db5763dcecd31513704d270be4ea9.jpg"},78837:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services33-5f974897564b8292eb2ddbd75b2326ae.jpg"},95104:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services34-Bind-7797352cb193df37aa645d1fe70474c6.jpg"},84192:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services35-Dial-dc7416b5a6539ced3781380536320d35.jpg"},9509:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Services36-68cdf8113ba64653edc58846b9815359.jpg"},64487:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/ZAC4-cd71daa7e31004fd6ed6a305681675c1.jpg"}}]);