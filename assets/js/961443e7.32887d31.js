"use strict";(self.webpackChunkopen_ziti=self.webpackChunkopen_ziti||[]).push([[2410],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>h});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=n.createContext({}),u=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(r),g=o,h=d["".concat(s,".").concat(g)]||d[g]||p[g]||i;return r?n.createElement(h,a(a({ref:t},c),{},{components:r})):n.createElement(h,a({ref:t},c))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,a=new Array(i);a[0]=g;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:o,a[1]=l;for(var u=2;u<i;u++)a[u]=r[u];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}g.displayName="MDXCreateElement"},73129:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var n=r(87462),o=(r(67294),r(3905));const i={sidebar_position:10,sidebar_label:"Router",title:"Use a Router as a LAN Gateway"},a=void 0,l={unversionedId:"guides/local-gateway/router",id:"guides/local-gateway/router",title:"Use a Router as a LAN Gateway",description:"1.0 Introduction",source:"@site/docs/guides/local-gateway/router.mdx",sourceDirName:"guides/local-gateway",slug:"/guides/local-gateway/router",permalink:"/docs/guides/local-gateway/router",draft:!1,editUrl:"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/local-gateway/router.mdx",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,sidebar_label:"Router",title:"Use a Router as a LAN Gateway"},sidebar:"docsSidebar",previous:{title:"Local Gateway",permalink:"/docs/category/local-gateway"},next:{title:"Tunneler",permalink:"/docs/guides/local-gateway/tunneler"}},s={},u=[{value:"1.0 Introduction",id:"10-introduction",level:2},{value:"1.1 Network Description",id:"11-network-description",level:2},{value:"1.2 Prerequisite",id:"12-prerequisite",level:2},{value:"2.0 Setup Routers",id:"20-setup-routers",level:2},{value:"2.1 Setup the Router For Windows Subnet",id:"21-setup-the-router-for-windows-subnet",level:2},{value:"2.1.1 Retrieve auto_enroll script and gather setup info",id:"211-retrieve-auto_enroll-script-and-gather-setup-info",level:3},{value:"2.1.2 Create and Register Router",id:"212-create-and-register-router",level:3},{value:"2.1.2.1 Create Router using one command",id:"2121-create-router-using-one-command",level:4},{value:"2.1.2.2 Register Router using jwt",id:"2122-register-router-using-jwt",level:4},{value:"2.1.3 Check the installation",id:"213-check-the-installation",level:3},{value:"2.1.3.1 ziti-router service",id:"2131-ziti-router-service",level:4},{value:"2.1.3.2 resolver",id:"2132-resolver",level:4},{value:"2.1.3.3 Check Router and Identity",id:"2133-check-router-and-identity",level:4},{value:"2.1.4 setup ufw",id:"214-setup-ufw",level:3},{value:"2.1.5 add attribute &quot;clients&quot; to the identity",id:"215-add-attribute-clients-to-the-identity",level:3},{value:"2.2 Setup the Router For Ubuntu Server Subnet",id:"22-setup-the-router-for-ubuntu-server-subnet",level:2},{value:"2.2.1 Retrieve auto_enroll script and gather setup info",id:"221-retrieve-auto_enroll-script-and-gather-setup-info",level:3},{value:"2.2.2 Create and Register Router",id:"222-create-and-register-router",level:3},{value:"2.2.2.1 Create Router using one command",id:"2221-create-router-using-one-command",level:4},{value:"2.2.2.2 Register Router using jwt",id:"2222-register-router-using-jwt",level:4},{value:"2.2.3 Check the installation",id:"223-check-the-installation",level:3},{value:"2.2.3.1 ziti-router service",id:"2231-ziti-router-service",level:4},{value:"2.2.3.2 resolver",id:"2232-resolver",level:4},{value:"2.2.3.3 Check Router and Identity",id:"2233-check-router-and-identity",level:4},{value:"2.2.3 setup ufw",id:"223-setup-ufw",level:3},{value:"2.2.4 add attribute &quot;hosts&quot; to the identity",id:"224-add-attribute-hosts-to-the-identity",level:3},{value:"3.0 Setup Client and Server",id:"30-setup-client-and-server",level:2},{value:"3.1 Ubuntu Server",id:"31-ubuntu-server",level:2},{value:"3.2 Windows Client",id:"32-windows-client",level:2},{value:"4.0 Service Configuration",id:"40-service-configuration",level:2},{value:"4.1 Create an intercept.v1 config",id:"41-create-an-interceptv1-config",level:2},{value:"4.2 Create a host.v1 config",id:"42-create-a-hostv1-config",level:2},{value:"4.3 Create ssh Service",id:"43-create-ssh-service",level:2},{value:"4.4 Create Service-Edge-Router-Policy",id:"44-create-service-edge-router-policy",level:2},{value:"4.5 Create Bind policies",id:"45-create-bind-policies",level:2},{value:"4.6 Create Dial policies",id:"46-create-dial-policies",level:2},{value:"4.7 Test the service",id:"47-test-the-service",level:2},{value:"5.0 http Service Configuration",id:"50-http-service-configuration",level:2},{value:"5.1 Create an intercept.v1 config",id:"51-create-an-interceptv1-config",level:2},{value:"5.2 Create a host.v1 config",id:"52-create-a-hostv1-config",level:2},{value:"5.3 Create http Service",id:"53-create-http-service",level:2},{value:"5.4 Service-Edge-Router-Policy",id:"54-service-edge-router-policy",level:2},{value:"5.5 Bind and Dial policies",id:"55-bind-and-dial-policies",level:2},{value:"5.6 Test the service",id:"56-test-the-service",level:2}],c={toc:u},d="wrapper";function p(e){let{components:t,...i}=e;return(0,o.kt)(d,(0,n.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"10-introduction"},"1.0 Introduction"),(0,o.kt)("p",null,"This article is about using ",(0,o.kt)("inlineCode",{parentName:"p"},"ziti router run")," in TPROXY mode as an infrastructure gateway providing access to services for a local subnet."),(0,o.kt)("h2",{id:"11-network-description"},"1.1 Network Description"),(0,o.kt)("iframe",{width:"100%",height:"315",src:"https://www.youtube.com/embed/H0qGRBMGNIA",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0}),(0,o.kt)("p",null,"In addition to the setup discussed in the video, this guide also demonstrates IP intercept in ",(0,o.kt)("a",{parentName:"p",href:"#50-http-service-configuration"},"Section 5.0 http Service Configuration"),"."),(0,o.kt)("p",null,"For the demonstration, we will setup the network like below:"),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Diagram",src:r(81554).Z,width:"839",height:"672"})),(0,o.kt)("hr",null),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"There are two Ziti-Edge-Routers (",(0,o.kt)("strong",{parentName:"li"},"local-router")," and ",(0,o.kt)("strong",{parentName:"li"},"remote-router"),") as LAN gateways. "),(0,o.kt)("li",{parentName:"ul"},"The Windows machine (",(0,o.kt)("strong",{parentName:"li"},"Windows Client"),") is in the same subnet (172.16.31.0/24) as Router (",(0,o.kt)("strong",{parentName:"li"},"local-router"),")."),(0,o.kt)("li",{parentName:"ul"},"The Ubuntu 22.04 server (",(0,o.kt)("strong",{parentName:"li"},"Ubuntu Server"),") is in the same subnet (172.16.240.0/24) as Router (",(0,o.kt)("strong",{parentName:"li"},"remote-router"),")."),(0,o.kt)("li",{parentName:"ul"},"The data (ssh) will be passed between the Windows Client and the Ubuntu Server.")),(0,o.kt)("h2",{id:"12-prerequisite"},"1.2 Prerequisite"),(0,o.kt)("p",null,"Complete the following steps first."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"An open-ziti network should be created already. If not, please follow this quickstart ",(0,o.kt)("a",{parentName:"li",href:"/docs/learn/quickstarts/network/hosted/"},"Host OpenZiti Anywhere")," guide to set up a ziti network first. ",(0,o.kt)("strong",{parentName:"li"},"NOTE"),", the router link listener port (",(0,o.kt)("strong",{parentName:"li"},"10080"),") needs to be opened on the firewall if this is the only transit router you have on the network."),(0,o.kt)("li",{parentName:"ul"},"Get the Ziti Controller IP or DNS name"),(0,o.kt)("li",{parentName:"ul"},"Get the Ziti Controller Fabric Port: On the controller, issue this command ",(0,o.kt)("strong",{parentName:"li"},"echo $ZITI_CTRL_ADVERTISED_PORT")),(0,o.kt)("li",{parentName:"ul"},"Get the Ziti Controller Management Port: On the controller, issue this command ",(0,o.kt)("strong",{parentName:"li"},"echo $ZITI_CTRL_EDGE_ADVERTISED_PORT")),(0,o.kt)("li",{parentName:"ul"},"Get the Ziti Controller Passwd: On the controller, issue this command ",(0,o.kt)("strong",{parentName:"li"},"echo $ZITI_PWD")),(0,o.kt)("li",{parentName:"ul"},"Created two target VMs to host ",(0,o.kt)("em",{parentName:"li"},"routers"),". The VMs should be running on ",(0,o.kt)("strong",{parentName:"li"},"Ubuntu 22.04"),"."),(0,o.kt)("li",{parentName:"ul"},"Created one ",(0,o.kt)("em",{parentName:"li"},"windows client")," already. Suggested windows version Windows 10 or Windows 11. Windows servers should work fine as well."),(0,o.kt)("li",{parentName:"ul"},"Created one ",(0,o.kt)("em",{parentName:"li"},"ubuntu server")," already. Or any linux server capable of accepting ssh and http connection.")),(0,o.kt)("h2",{id:"20-setup-routers"},"2.0 Setup Routers"),(0,o.kt)("h2",{id:"21-setup-the-router-for-windows-subnet"},"2.1 Setup the Router For Windows Subnet"),(0,o.kt)("h3",{id:"211-retrieve-auto_enroll-script-and-gather-setup-info"},"2.1.1 Retrieve auto_enroll script and gather setup info"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"ssh")," into your router VM (",(0,o.kt)("strong",{parentName:"p"},"local-router"),"). "),(0,o.kt)("p",null,"Retrieve ",(0,o.kt)("strong",{parentName:"p"},"ziti_router_auto_enroll")," to setup your router."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"wget https://github.com/netfoundry/ziti_router_auto_enroll/releases/latest/download/ziti_router_auto_enroll.tar.gz\ntar xf ziti_router_auto_enroll.tar.gz\n")),(0,o.kt)("p",null,"You should have a file ",(0,o.kt)("strong",{parentName:"p"},"ziti_router_auto_enroll")," under the directory."),(0,o.kt)("p",null,"Here is information I gathered from ",(0,o.kt)("strong",{parentName:"p"},"Prerequisite")," step:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"root@LocalGWDemoNC:~# curl -s eth0.me\n68.183.139.122  <--- Controller IP\nroot@LocalGWDemoNC:~# echo $ZITI_CTRL_ADVERTISED_PORT\n8440  <--- Controller Fabric Port\nroot@LocalGWDemoNC:~# echo $ZITI_CTRL_EDGE_ADVERTISED_PORT\n8441  <--- Controller Management Port\nroot@LocalGWDemoNC:~# echo $ZITI_PWD\nTest@123  <--- Controller Passwd\n")),(0,o.kt)("p",null,"We are going to use Router Name: ",(0,o.kt)("strong",{parentName:"p"},"local-router")),(0,o.kt)("p",null,"We are also going to create the router without healthcheck section, so the following option will be used to create the router:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"--disableHealthChecks")),(0,o.kt)("h3",{id:"212-create-and-register-router"},"2.1.2 Create and Register Router"),(0,o.kt)("h4",{id:"2121-create-router-using-one-command"},"2.1.2.1 Create Router using one command"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo ./ziti_router_auto_enroll -f -n --controller 68.183.139.122 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --disableHealthChecks --autoTunnelListener --routerName local-router\n")),(0,o.kt)("p",null,"What this command does:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"contacts the controller"),(0,o.kt)("li",{parentName:"ul"},'creates a router named "local-router" (with tunneler enabled) on the controller'),(0,o.kt)("li",{parentName:"ul"},"generates the conf.yml locally"),(0,o.kt)("li",{parentName:"ul"},"downloads the jwt file for the router from controller"),(0,o.kt)("li",{parentName:"ul"},"enrolls the router with the jwt and the generated conf.yml"),(0,o.kt)("li",{parentName:"ul"},"creates the service file to start and stop the router"),(0,o.kt)("li",{parentName:"ul"},"and configured the resolver")),(0,o.kt)("h4",{id:"2122-register-router-using-jwt"},"2.1.2.2 Register Router using jwt"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"Skip this section if you already created router using one command"))),(0,o.kt)("p",null,"An alternative way to register router is creating it on the controller first and then register it on the router VM."),(0,o.kt)("p",null,"Create Router and retrieve JWT on the ",(0,o.kt)("strong",{parentName:"p"},"controller")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"zitiLogin\n# the followin will create a edge router with tunneler enabled on the controller\nziti edge create edge-router local-router -o local-router.jwt -t\ncat local-router.jwt\n")),(0,o.kt)("p",null,'Copy the output of "local-router.jwt" and register the router on the ',(0,o.kt)("strong",{parentName:"p"},"router VM")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo ./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441  --disableHealthChecks  --autoTunnelListener  <jwt content>\n")),(0,o.kt)("p",null,"What this command does:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"contacts the controller using info in the JWT."),(0,o.kt)("li",{parentName:"ul"},"generates the conf.yml locally"),(0,o.kt)("li",{parentName:"ul"},"enrolls the router with the jwt and the generated conf.yml"),(0,o.kt)("li",{parentName:"ul"},"creates the service file to start and stop the router"),(0,o.kt)("li",{parentName:"ul"},"and configured the resolver")),(0,o.kt)("h3",{id:"213-check-the-installation"},"2.1.3 Check the installation"),(0,o.kt)("p",null,"You do not have to perform this step if your installation was successful. "),(0,o.kt)("h4",{id:"2131-ziti-router-service"},"2.1.3.1 ziti-router service"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"systemctl status ziti-router\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"expected output:"),' The status should show "active (running)"'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"ziggy@local-gw:~$ systemctl status ziti-router\n\u25cf ziti-router.service - Ziti-Router\n     Loaded: loaded (/etc/systemd/system/ziti-router.service; enabled; vendor preset: enabled)\n     Active: active (running) since Mon 2023-05-01 19:51:54 UTC; 1min 48s ago\n<... output truncated ...>\n")),(0,o.kt)("h4",{id:"2132-resolver"},"2.1.3.2 resolver"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"resolvectl\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-buttonless",metastring:"title=Output: The resolver should be set to the IP of the local LAN",title:"Output:",The:!0,resolver:!0,should:!0,be:!0,set:!0,to:!0,the:!0,IP:!0,of:!0,local:!0,LAN:!0},"ziggy@local-gw:~$ hostname -I\n172.16.31.173\nziggy@local-gw:~$ resolvectl\nGlobal\n         Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported\n  resolv.conf mode: stub\nCurrent DNS Server: 172.16.31.173\n       DNS Servers: 172.16.31.173\n\nLink 2 (ens160)\n    Current Scopes: DNS\n         Protocols: +DefaultRoute +LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported\nCurrent DNS Server: 8.8.8.8\n       DNS Servers: 8.8.8.8\n")),(0,o.kt)("h4",{id:"2133-check-router-and-identity"},"2.1.3.3 Check Router and Identity"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"/opt/ziti/ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y\n/opt/ziti/ziti edge list edge-routers\n/opt/ziti/ziti edge list identities\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-buttonless",metastring:'title=Output: a router "local-router" after "list edge-router" and an identity "local-router" after "list identities"',title:"Output:",a:!0,router:!0,'"local-router"':!0,after:!0,'"list':!0,'edge-router"':!0,and:!0,an:!0,identity:!0,'identities"':!0},"ziggy@local-gw:~$ /opt/ziti/ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y\nToken: 0b3a8cc6-dc76-4a94-a502-04380586b49a\nSaving identity 'default' to /home/ziggy/.config/ziti/ziti-cli.json\nziggy@local-gw:~$ /opt/ziti/ziti edge list edge-routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                      \u2502 ONLINE \u2502 ALLOW TRANSIT \u2502 COST \u2502 ATTRIBUTES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 .t9Gno26Y  \u2502 local-router              \u2502 true   \u2502 true          \u2502    0 \u2502            \u2502\n\u2502 xCW0lSWpcn \u2502 LocalGWDemoNC-edge-router \u2502 true   \u2502 true          \u2502    0 \u2502 public     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\nziggy@local-gw:~$ /opt/ziti/ziti edge list identities\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                      \u2502 TYPE   \u2502 ATTRIBUTES \u2502 AUTH-POLICY \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 .t9Gno26Y  \u2502 local-router              \u2502 Router \u2502            \u2502 default     \u2502\n\u2502 lIend76Tu  \u2502 Default Admin             \u2502 User   \u2502            \u2502 default     \u2502\n\u2502 xCW0lSWpcn \u2502 LocalGWDemoNC-edge-router \u2502 Router \u2502            \u2502 default     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-3 of 3\n")),(0,o.kt)("h3",{id:"214-setup-ufw"},"2.1.4 setup ufw"),(0,o.kt)("p",null,"The following steps turn on the ufw firewall and opens the ports for this demo."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo ufw enable\nsudo ufw allow from any to 172.16.31.173/32 port 53 proto udp\nsudo ufw allow from any to 172.16.31.173/32 port 22 proto tcp\nsudo ufw allow from any to 172.16.31.173/32 port 80 proto tcp\n")),(0,o.kt)("h3",{id:"215-add-attribute-clients-to-the-identity"},'2.1.5 add attribute "clients" to the identity'),(0,o.kt)("p",null,'We want to add attribute "clients" to the identity associated with the edge router. '),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"You do not need to login again if your token has not expired yet"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"/opt/ziti/ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y\n/opt/ziti/ziti edge update identity local-router -a clients\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-buttonless",metastring:'title=Output: You should see "clients" show up at "local-router" attribute when you list identities.',title:"Output:",You:!0,should:!0,see:!0,'"clients"':!0,show:!0,up:!0,at:!0,'"local-router"':!0,attribute:!0,when:!0,you:!0,list:!0,"identities.":!0},"ziggy@local-gw:~$ /opt/ziti/ziti edge update identity local-router -a clients\nziggy@local-gw:~$ /opt/ziti/ziti edge list identities\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                      \u2502 TYPE   \u2502 ATTRIBUTES \u2502 AUTH-POLICY \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 .t9Gno26Y  \u2502 local-router              \u2502 Router \u2502 clients    \u2502 default     \u2502\n\u2502 lIend76Tu  \u2502 Default Admin             \u2502 User   \u2502            \u2502 default     \u2502\n\u2502 xCW0lSWpcn \u2502 LocalGWDemoNC-edge-router \u2502 Router \u2502            \u2502 default     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-3 of 3\n")),(0,o.kt)("h2",{id:"22-setup-the-router-for-ubuntu-server-subnet"},"2.2 Setup the Router For Ubuntu Server Subnet"),(0,o.kt)("h3",{id:"221-retrieve-auto_enroll-script-and-gather-setup-info"},"2.2.1 Retrieve auto_enroll script and gather setup info"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"ssh")," into your router VM (",(0,o.kt)("strong",{parentName:"p"},"remote-router"),"). "),(0,o.kt)("p",null,"Retrieve ",(0,o.kt)("strong",{parentName:"p"},"ziti_router_auto_enroll")," to setup your router automatically."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"wget https://github.com/netfoundry/ziti_router_auto_enroll/releases/latest/download/ziti_router_auto_enroll.tar.gz\ntar xf ziti_router_auto_enroll.tar.gz\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Info for the controller is same as previous setup, please refer to section 2.1.1 for detail.")),(0,o.kt)("p",null,"We are going to use Router Name: ",(0,o.kt)("strong",{parentName:"p"},"remote-router")),(0,o.kt)("h3",{id:"222-create-and-register-router"},"2.2.2 Create and Register Router"),(0,o.kt)("h4",{id:"2221-create-router-using-one-command"},"2.2.2.1 Create Router using one command"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo ./ziti_router_auto_enroll -f -n --controller 68.183.139.122 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --disableHealthChecks --autoTunnelListener --routerName remote-router\n")),(0,o.kt)("h4",{id:"2222-register-router-using-jwt"},"2.2.2.2 Register Router using jwt"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Skip this section if you already created router using one command")),(0,o.kt)("p",null,"An alternative way to register router is creating it on the controller first and then register it on the router VM."),(0,o.kt)("p",null,"Create Router and retrieve JWT on the ",(0,o.kt)("strong",{parentName:"p"},"controller")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"zitiLogin\n# the followin will create a edge router with tunneler enabled on the controller\nziti edge create edge-router remote-router -o remote-router.jwt -t\ncat remote-router.jwt\n")),(0,o.kt)("p",null,'Copy the output of "remote-router.jwt" and register the router on the ',(0,o.kt)("strong",{parentName:"p"},"router VM")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo ./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441  --disableHealthChecks  --autoTunnelListener  <jwt content>\n")),(0,o.kt)("h3",{id:"223-check-the-installation"},"2.2.3 Check the installation"),(0,o.kt)("p",null,"You do not have to perform this step if your installation was successful. "),(0,o.kt)("h4",{id:"2231-ziti-router-service"},"2.2.3.1 ziti-router service"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"systemctl status ziti-router\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"expected output:"),' The status should show "active (running)"'),(0,o.kt)("h4",{id:"2232-resolver"},"2.2.3.2 resolver"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"resolvectl\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"expected output:")," The resolver should be set to the IP of the local LAN."),(0,o.kt)("h4",{id:"2233-check-router-and-identity"},"2.2.3.3 Check Router and Identity"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"/opt/ziti/ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y\n/opt/ziti/ziti edge list edge-routers\n/opt/ziti/ziti edge list identities\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-buttonless",metastring:"title=Output",title:"Output"},"ziggy@remote-router:~$ /opt/ziti/ziti edge list edge-routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                      \u2502 ONLINE \u2502 ALLOW TRANSIT \u2502 COST \u2502 ATTRIBUTES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 .t9Gno26Y  \u2502 local-router              \u2502 true   \u2502 true          \u2502    0 \u2502            \u2502\n\u2502 967-JQe6s  \u2502 remote-router             \u2502 true   \u2502 true          \u2502    0 \u2502            \u2502\n\u2502 xCW0lSWpcn \u2502 LocalGWDemoNC-edge-router \u2502 true   \u2502 true          \u2502    0 \u2502 public     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-3 of 3\nziggy@remote-router:~$ /opt/ziti/ziti edge list identities\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                      \u2502 TYPE   \u2502 ATTRIBUTES \u2502 AUTH-POLICY \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 .t9Gno26Y  \u2502 local-router              \u2502 Router \u2502 clients    \u2502 default     \u2502\n\u2502 967-JQe6s  \u2502 remote-router             \u2502 Router \u2502            \u2502 default     \u2502\n\u2502 lIend76Tu  \u2502 Default Admin             \u2502 User   \u2502            \u2502 default     \u2502\n\u2502 xCW0lSWpcn \u2502 LocalGWDemoNC-edge-router \u2502 Router \u2502            \u2502 default     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-4 of 4\n")),(0,o.kt)("h3",{id:"223-setup-ufw"},"2.2.3 setup ufw"),(0,o.kt)("p",null,"For this demo, we only show the connection initiated from local-tunnel side towards remote-tunnel. The ufw rules below are not needed. If you want to have bidirectional connections, you will need to setup these rules."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo ufw enable\nsudo ufw allow from any to 172.16.240.128/32 port 53 proto udp\nsudo ufw allow from any to 172.16.240.128/32 port 22 proto tcp\nsudo ufw allow from any to 172.16.240.128/32 port 80 proto tcp\n")),(0,o.kt)("h3",{id:"224-add-attribute-hosts-to-the-identity"},'2.2.4 add attribute "hosts" to the identity'),(0,o.kt)("p",null,'We want to add attribute "hosts" to the identity associated with the edge router. '),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"You do not need to login again if your token has not expired yet")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"/opt/ziti/ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y\n/opt/ziti/ziti edge update identity remote-router -a hosts\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-buttonless",metastring:"title=Check Identity for modified attribute",title:"Check",Identity:!0,for:!0,modified:!0,attribute:!0},"ziggy@local-gw:~$ /opt/ziti/ziti edge list identities\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                      \u2502 TYPE   \u2502 ATTRIBUTES \u2502 AUTH-POLICY \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 .t9Gno26Y  \u2502 local-router              \u2502 Router \u2502 clients    \u2502 default     \u2502\n\u2502 967-JQe6s  \u2502 remote-router             \u2502 Router \u2502 hosts      \u2502 default     \u2502\n\u2502 lIend76Tu  \u2502 Default Admin             \u2502 User   \u2502            \u2502 default     \u2502\n\u2502 xCW0lSWpcn \u2502 LocalGWDemoNC-edge-router \u2502 Router \u2502            \u2502 default     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-4 of 4\n")),(0,o.kt)("h2",{id:"30-setup-client-and-server"},"3.0 Setup Client and Server"),(0,o.kt)("h2",{id:"31-ubuntu-server"},"3.1 Ubuntu Server"),(0,o.kt)("p",null,"The Ubuntu Server needs to support ",(0,o.kt)("strong",{parentName:"p"},"ssh")," (port 22) and ",(0,o.kt)("strong",{parentName:"p"},"http")," (port 8000) for our demo."),(0,o.kt)("p",null,"Make sure these ports are open on the firewall."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo ufw enable\nsudo ufw allow from any to 172.16.240.129/32 port 22 proto tcp\nsudo ufw allow from any to 172.16.240.129/32 port 8000 proto tcp\n")),(0,o.kt)("p",null,"Next, start the webserver. The web server will be listening on the port 8000."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},'echo "You have reached Remote Web Server." >hello.txt\npython3 -m http.server\n')),(0,o.kt)("h2",{id:"32-windows-client"},"3.2 Windows Client"),(0,o.kt)("p",null,"There are two changes we need to make on the windows side."),(0,o.kt)("p",null,"The first one, we need to change the configuration of the preferred DNS to point to our ",(0,o.kt)("strong",{parentName:"p"},"local-router")," (172.16.31.173)."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Diagram",src:r(74041).Z,width:"369",height:"521"})),(0,o.kt)("p",null,"The second change is to setup routing."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"We need to route the ",(0,o.kt)("strong",{parentName:"li"},"100.64.0.0/10")," traffic to our ",(0,o.kt)("strong",{parentName:"li"},"local-router"),". Any DNS based intercept resolved to the IP in the subnet 100.64.0.0/10."),(0,o.kt)("li",{parentName:"ul"},"We also need to route ",(0,o.kt)("strong",{parentName:"li"},"172.16.240.129/32")," to ",(0,o.kt)("strong",{parentName:"li"},"local-router"),".  ",(0,o.kt)("strong",{parentName:"li"},"172.16.240.129")," is IP we intended to intercept and pass through ziti fabric.")),(0,o.kt)("p",null,"To do this, open an cmd window as Administrator."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"route add 100.64.0.0 mask 255.192.0.0 172.16.31.173\nroute add 172.16.240.129 mask 255.255.255.255 172.16.31.173\n")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Diagram",src:r(93454).Z,width:"688",height:"374"})),(0,o.kt)("h2",{id:"40-service-configuration"},"4.0 Service Configuration"),(0,o.kt)("p",null,"The service configuration can be done on either the local-router or the remote-router."),(0,o.kt)("h2",{id:"41-create-an-interceptv1-config"},"4.1 Create an intercept.v1 config"),(0,o.kt)("p",null,'This config is used for local side connection. We are setting up intercept on dns name "mysimpleservice.ziti"'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},'/opt/ziti/ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y\n/opt/ziti/ziti edge create config ssh-intercept-config intercept.v1 \'{"protocols": ["tcp"], "addresses": ["mysimpleservice.ziti"], "portRanges": [{"low": 22, "high": 22}]}\'\n')),(0,o.kt)("h2",{id:"42-create-a-hostv1-config"},"4.2 Create a host.v1 config"),(0,o.kt)("p",null,'This config is used for remote side connection. We are setting up the address the remote server can reach. In this demo, We are dropping the traffic off at "172.16.240.129"'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},'/opt/ziti/ziti edge create config ssh-host-config host.v1 \'{"address":"172.16.240.129", "protocol":"tcp", "port":22}\'\n')),(0,o.kt)("p",null,'If the config command were successfully, you will see two configs by using "list configs" command:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-buttonless"},"ziggy@local-gw:~$ /opt/ziti/ziti edge list configs\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME                  \u2502 CONFIG TYPE  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 3FdpRUpQ2TYinEwURqArpD \u2502 ssh-host-config       \u2502 host.v1      \u2502\n\u2502 3GAjRaE9CcAhdYZiRNpasa \u2502 ssh-intercept-config  \u2502 intercept.v1 \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,o.kt)("h2",{id:"43-create-ssh-service"},"4.3 Create ssh Service"),(0,o.kt)("p",null,'Now we need to put these two configs into a service. We going to name the service "ssh" and assign an attribute "rtrhosted"'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"/opt/ziti/ziti edge create service ssh -c ssh-intercept-config,ssh-host-config -a rtrhosted\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Check Service"),' by using "list service"'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-buttonless"},"ziggy@local-gw:~$ /opt/ziti/ziti edge list services\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME \u2502 ENCRYPTION \u2502 TERMINATOR STRATEGY \u2502 ATTRIBUTES \u2502\n\u2502                        \u2502      \u2502  REQUIRED  \u2502                     \u2502            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 48Z59WmcETzhmAwiUGpdwv \u2502 ssh  \u2502 true       \u2502 smartrouting        \u2502 rtrhosted  \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-1 of 1\n")),(0,o.kt)("h2",{id:"44-create-service-edge-router-policy"},"4.4 Create Service-Edge-Router-Policy"),(0,o.kt)("p",null,"This step is ",(0,o.kt)("strong",{parentName:"p"},"optional"),' if you used quickstart. The service-edge-router-policy already includes "#all" service roles to "#all" edge router roles as displayed on the screen capture below.'),(0,o.kt)("p",null,"But in case you need to add a policy, here is the command to add the service tag we created (rtrhosted) to all routers"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"/opt/ziti/ziti edge create service-edge-router-policy ssh-serp --edge-router-roles '#all' --service-roles '#rtrhosted' --semantic 'AnyOf'\n")),(0,o.kt)("p",null,'Check your service-edge-router-policy, and make sure the policy name "ssh-serp" is created. The automatically created one is called "allSvcAllRouters".'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"ziggy@local-gw:~$ /opt/ziti/ziti edge list service-edge-router-policies\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME             \u2502 SERVICE ROLES \u2502 EDGE ROUTER ROLES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 5QzQPx6EUOJXT0hTm26Vuc \u2502 allSvcAllRouters \u2502 #all          \u2502 #all              \u2502\n\u2502 PElJS8hQ6E6ykYnRiCJyX  \u2502 ssh-serp         \u2502 #rtrhosted    \u2502 #all              \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,o.kt)("h2",{id:"45-create-bind-policies"},"4.5 Create Bind policies"),(0,o.kt)("p",null,"We need to specify which identity (in our case, ",(0,o.kt)("strong",{parentName:"p"},"#hosts"),") is going to host the service by setting up a bind service policy"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"/opt/ziti/ziti edge create service-policy ssh-bind Bind --identity-roles \"#hosts\" --service-roles '#rtrhosted' --semantic 'AnyOf'\n")),(0,o.kt)("h2",{id:"46-create-dial-policies"},"4.6 Create Dial policies"),(0,o.kt)("p",null,"We also need to specify which identity (in this case, ",(0,o.kt)("strong",{parentName:"p"},"#clients"),") is going to intercept the service by setting up a dial service policy"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"/opt/ziti/ziti edge create service-policy ssh-dial Dial --identity-roles \"#clients\" --service-roles '#rtrhosted' --semantic 'AnyOf'\n")),(0,o.kt)("p",null,"If both policies are setup correctly, you should see two service-policies."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-buttonless"},"ziggy@local-gw:~$ /opt/ziti/ziti edge list service-policies\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME     \u2502 SEMANTIC \u2502 SERVICE ROLES \u2502 IDENTITY ROLES \u2502 POSTURE CHECK ROLES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 5cEZw4ZJmoajO68yomA9Hd \u2502 ssh-dial \u2502 AnyOf    \u2502 #rtrhosted    \u2502 #clients       \u2502                     \u2502\n\u2502 5ouEy4ArjXwkwu8xoZJGg5 \u2502 ssh-bind \u2502 AnyOf    \u2502 #rtrhosted    \u2502 #hosts         \u2502                     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,o.kt)("h2",{id:"47-test-the-service"},"4.7 Test the service"),(0,o.kt)("p",null,"Connect to the Windows Client machine, open a cmd window."),(0,o.kt)("p",null,"First, try to ",(0,o.kt)("strong",{parentName:"p"},"nslookup mysimpleservice.ziti"),". This should resolve to a 100.64.0.* address. "),(0,o.kt)("p",null,"Then you should be able ssh to mysimpleservice.ziti."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Diagram",src:r(28482).Z,width:"980",height:"512"})),(0,o.kt)("h2",{id:"50-http-service-configuration"},"5.0 http Service Configuration"),(0,o.kt)("p",null,"In the previous section, we showed how to configure a DNS based intercept via open-ziti. In this section, we going to show how to setup interception via IP address. If you followed the instruction in the ",(0,o.kt)("a",{parentName:"p",href:"#32-windows-client"},"3.2 Windows Client")," section, the routing for the intercept traffic to local-tunnel node is ready set. (",(0,o.kt)("em",{parentName:"p"},"route add 172.16.240.129 mask 255.255.255.255 172.16.31.173"),")"),(0,o.kt)("p",null,"The service configuration can be done on either the local-router or the remote-router."),(0,o.kt)("h2",{id:"51-create-an-interceptv1-config"},"5.1 Create an intercept.v1 config"),(0,o.kt)("p",null,"Create intercept config on IP: 172.16.240.129 and port ",(0,o.kt)("strong",{parentName:"p"},"80")," for http traffic."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},'/opt/ziti/ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y\n/opt/ziti/ziti edge create config http-intercept-config intercept.v1 \'{"protocols": ["tcp"], "addresses": ["172.16.240.129"], "portRanges": [{"low": 80, "high": 80}]}\'\n')),(0,o.kt)("h2",{id:"52-create-a-hostv1-config"},"5.2 Create a host.v1 config"),(0,o.kt)("p",null,"Create Host config on IP: 172.16.240.129 and port ",(0,o.kt)("strong",{parentName:"p"},"8000"),". As you can see, we have redirected traffic intended for port 80 (from client) to port 8000 (on the host)."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},'/opt/ziti/ziti edge create config http-host-config host.v1 \'{"address":"172.16.240.129", "protocol":"tcp", "port":8000}\'\n')),(0,o.kt)("p",null,'If the command finished successfully, you will see two more configs created, their names start with "http":'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-buttonless"},"ziggy@local-gw:~$ /opt/ziti/ziti edge list configs\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME                  \u2502 CONFIG TYPE  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1QwmHB69qqvtJKMD3LaUiB \u2502 http-host-config      \u2502 host.v1      \u2502\n\u2502 3FdpRUpQ2TYinEwURqArpD \u2502 ssh-host-config       \u2502 host.v1      \u2502\n\u2502 3GAjRaE9CcAhdYZiRNpasa \u2502 ssh-intercept-config  \u2502 intercept.v1 \u2502\n\u2502 7aEkSQs5eOdXRuVT8aCYDz \u2502 http-intercept-config \u2502 intercept.v1 \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-4 of 4\n")),(0,o.kt)("h2",{id:"53-create-http-service"},"5.3 Create http Service"),(0,o.kt)("p",null,'Put these two configs into a service. We going to name the service "http" and assign an attribute "rtrhosted"'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"/opt/ziti/ziti edge create service http -c http-intercept-config,http-host-config -a rtrhosted\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-buttonless",metastring:"title=Check Service",title:"Check",Service:!0},"ziggy@local-gw:~$ /opt/ziti/ziti edge list services\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME \u2502 ENCRYPTION \u2502 TERMINATOR STRATEGY \u2502 ATTRIBUTES \u2502\n\u2502                        \u2502      \u2502  REQUIRED  \u2502                     \u2502            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 2E3LsWbgwo0PiOO67ZyWEP \u2502 http \u2502 true       \u2502 smartrouting        \u2502 rtrhosted  \u2502\n\u2502 48Z59WmcETzhmAwiUGpdwv \u2502 ssh  \u2502 true       \u2502 smartrouting        \u2502 rtrhosted  \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n\n")),(0,o.kt)("h2",{id:"54-service-edge-router-policy"},"5.4 Service-Edge-Router-Policy"),(0,o.kt)("p",null,"Since we used same attribute for http service as the attribute for ssh service, we don't need another service-edge-router-policy. The original service-edge-router-policy was done in ",(0,o.kt)("a",{parentName:"p",href:"#44-create-service-edge-router-policy"},"this section"),"."),(0,o.kt)("h2",{id:"55-bind-and-dial-policies"},"5.5 Bind and Dial policies"),(0,o.kt)("p",null,"We also do not need to create new Bind and Dial policies. Since our host identity (#hosts) and service attribute (#rtrhosted) did not change for bind policy. And our client identity (#clients) and service attribute (#rtrhosted) did not change for dial policy. You can review the policies from the ",(0,o.kt)("a",{parentName:"p",href:"#46-create-dial-policies"},"previous section"),"."),(0,o.kt)("h2",{id:"56-test-the-service"},"5.6 Test the service"),(0,o.kt)("p",null,"Connect to the Windows Client machine, open a web browser. Enter this address (",(0,o.kt)("a",{parentName:"p",href:"http://172.16.240.129/hello.txt"},"http://172.16.240.129/hello.txt"),"). You should see the text we entered earlier on the ",(0,o.kt)("a",{parentName:"p",href:"#31-ubuntu-server"},"ubuntu server")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Diagram",src:r(98487).Z,width:"441",height:"136"})))}p.isMDXComponent=!0},81554:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/LocalGW01-989f642b8f73362db6324b3bc88d3c71.png"},74041:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/LocalGW09-d0a9dfe4c337f1bd0ee90fd6539463f8.png"},93454:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/LocalGW10-f121af06081418122cf1e07ede785ace.png"},28482:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/LocalGW15-7f3db450842c49dd16c335418490fcb9.png"},98487:(e,t,r)=>{r.d(t,{Z:()=>n});const n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAbkAAACICAYAAAB6BZWUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABL/SURBVHhe7d1LrBXVnsfxOvsAii+YNRAjUxgIAwc60RgTHwOd9MCbGLHpgTyi6YFeUa+k4wCiYnBwY8Ir3aGFS0dj7LQ60BgTH4mPgYkwEkxM8D1RAQWUxznXX1F/+J/Fqtq19646VNX+fpKVXbVqrVWr9tlV/73qsc/ExH8dm170+t+SN//z3xMAALqkNz2RTQEA0DG97BUAgM6ZSP772PTi/2//6crp6ekZrwCaa2Li3CkkewXq0vogp6CmdPbs2eTMmTPJ1NTU+TwAzaKgptTr9ZI5c+Ykk5OT5/OAOrQ6yCmQKaidPn06ueKKK5LFixcnV155ZbrzAGgmfRk9fvx48v333ycnT55M5s6dmwY9Ah3q0NprcjZa0w5z+eWXJ8uWLUsWLFhAgAMaTvuo9tXly5en+672Yc6+oC6tDHK2Q9gobsmSJdkSAG2ifVf7MJcZUJdWj+QsyF199dVZLoA20WUGH+SAqulEeDbZDvZtTzuFkm440cVrAO0zb968dB+2/dn2b6AqrT1dKRbkALSXBTkhwKFqrb/xxHYOAO3ECA51av2NJ+wYQLv5fZn9GVVr7UhuVHv37k2fq5s/f/5FacOGDVkpAG2wb9++bAqYqdIg9+uvvyaPPvpocsMNN5RKKqs6oxj2m9+mTZuSTz75JH0Y1Sf55ZdfkjVr1vCtEpgFVexnL7zwQjYFzFRpkFPQeu+997K5/lT26aefzuYGM+qOcfjw4WTp0qXZ3Ey7du1K21+7dm2WA6BufKlEHSoNcp999lk2Vd4gQXE2KdCJRnSj0ilQLzw96peH83lUJnZQ0HNHRW3YsqK6Xr/2jMqFYu2JtZfXpvLVv7zlRayuTQMYb7309+L4ybgZjhw5kr7u3LkzPWAOG+h0kI0daGOnSEVlLS/vAJ3XpihfvwkYtmt8+/qNz7Ksrdh6rT9h0PR98fUU+KwPEtbVvJZdqt8xjAXrmLLlumj//v3Jnj17srmZlK/lQFNUfuOJRnM2orPpotQ0Tz311IwbUnSDSt4O3Y8/mOexg770Kyt5bZYJDkXtq76Ckufz8upaf8L19uuLFPUHzXXgwIH0i99LL72U5Zyj/USn+LUcaIrexSetxtvGjRvPH7gttYUFZqUusW2KjRYH2VYrn1dH+VpHXjmbD8uNm1WrVqVnOdatW3f+C6BeFfi2b9+eLgeaYmwfIWgCHSDD0ZP40d2gTpw4kdYtOviG69W86tRxitDaLiNW1vKU/ClWn6/pfvxpUqsTBk3l6z2IlbP1xcqNIwWyHTt2pIFt/fr16asC3wMPPJCVqJ4eE4jdpa2kv1EsX4nHC8YbQa5hYgffsuzgWyQMCP7gXbXYdSsFYa3TUj9FfSvbxii0fgXXcQ1mRRToVq9enezevTt9rXsEd99990UveSjpcx/LV1I9jC+CXAMpENQpDIZh0KkycMSCg/IsGa0zVrZIrB3MHp2itACn12GvXQN1IshdInZQD4NNmCfKLzO6i5Xzeda+Z0HCkuUZG435urERWkjlY6diPWuz3+izbupHHtuOojLjyG4y0SnKbdu2pa+xm1GAS40g1zA6mFoahA9AqusDlTdI+xaABu2Lsb74+j4vr49lqK6149vPE54mtW0L5ZWz9RlfbtzEbjLRa3gzCtAE556T40G5WsUO5nl5PhlNhwfkvLyiun65L+OF+TqYh+Vjp1PDPKsTqxvmKfD5eRPmFa3DaNpvrxcrL6OWGzcrVqyI3mRiN6NoOdAUvXOnsoa70SGkO5n04S9LO8Stt96azWFcxYImmmvlypW5N5koX8uBpuglPf1X7WpGclu3bk0OHjyYBjvxt/HG0qFDh4b+7cpRLVy4MP39yn6KfuMSQDM88sgj2RQw08TkP05N/8urf03e2PhvWVazaeSp/yR85syZ5PTp08mxY8eS22+/PVtanq4bbN68uW+gUzDcsmVL7jdXAKN55513kmuuuSaZO3duMmfOnGRycvKiU/HAsHp/+jPUjd8HSkHriy++OH9dJS/98MMPBDgAaKnsmhwAAN3TOzOlU4DZHAAAHdJre4RjJAq0G/sw6tRr2/U4v0NMTU2lF6oBtJf2Ye3LhqCHKmUjuXZ8qOzDr1cl3WU5b968NA9AO2kf1r5s+7XYKzCqiYk9v08vem1D8sZTDzT6g2V90zc+7RCnTp1Kf1Nw+fLlyZIlS9JlANrnu+++S+901n97UMDTIwTpXd9/4lECjOp8kHv1r3+56NtUE9lpDZ3iuPbaa9P/4g2g3fSozrfffps+/yoW5IBRnQ9yX+17LstCm3BaBwDyEeRayAe2MMgR9ADggomJ/zk+vej/nki++t8tWRaazIKYXv20fwUAnEOQa4kwuPlk+f4VAPBnkEteOj69+DWCXJP5gBYm+1FbXai3BAA4hyNiw/mApjtLLV122WXJggUL0n84qtuuLdABAC7gqNhgsQCnYKZ/S6IgBwAoRpBrqFiA04hNIzcekAWAcnrpAZNjZqPEAtz8+fPTBAAoj5FcQ/kgp5tL+I1OABgcQa5hwlGcfsdPpygBAIO7JEFuz5492VRzHT58ONmwYUNy0003nT9VuGzZsjRPy8yiRYvSgFQlH+j0o7V1OHHiRLJ169Y0aRqzZ9u2bdkUgLrNapA7cuRIGjQ++OCDLKeZHnvsseSOO+5Ig8yOHTuSkydPpmnnzp3pnY1apmAnR48eTV+r4IObku6grOsmk927dyeHDh1K0yuvvJLlAkC3zFqQU4C76667kuuvvz7ZtWtXlts8N954Y9rXgwcPJs8//3yycuXKbEmS3HLLLcnGjRuTTz/9NHn//feTO++8M1tSnTDI1UHbtn///mwuST7++OM0DwC6ZlaCnA6oCnB33313owOcRnD33HNP3z4uXLgwefvtt9OHseuiB7vrGsW98cYb2dQFb775ZjY1uLVr16YpJi8fo4t9PpQXS17RsjxFPzTg29KXszy+nFKRvOVl65sy7cTK2P6Xt9x7/PHH0zQsX/eJJ57IplCV2oOcBbiHHnooHQU1la6zvf7668nDDz+c5cTp/9fp+pxeFSyqCnR+BKekOyrr8PnnnydffvllOu0fS9BpSy271AiK5eQdeMPPkeUZ1fPLyxzErU5MrL2YWLmisjG+jTLyAnO/voTLiygoPfdcM/6DyyABcpSg3Da1BjkLcFu2bElWrVqV5TbT5s2b0z5qlFZE/9zRrtEp/fjjjzN2kCpox9Ivm9Th5ZdfzqaSZPXq1Wkyo1yb2759OwFqlthBeBhhPd3BW8TWNepnvOx689YTbnO/PmmZ/gl0TJm++DxbV1gP7VBbkNMdlPfee2/y1ltvNT7AiUZyOlXZFHX8DuW7776b/Pzzz9nczJGc/PTTT8lHH32UzQ2nX6Bbt25dWsaSZ/OxZZ4tV/IHHp8fEy5XX0I+z5fzbYbtzLayB9sqDsxF9fUZrePAX0WbaqMoCFZBo6Gwr3bqMjZSKlqWx9cpqqdl6ktY3vdP82IjPivTdbUFuU2bNiVff/31jFvwyybdlj/bPvzwwxk3mQxCjxZUxT6UVQc5PSYQuxYX0mhu2EcKdCdqEQUFbZ/KWVnLE8vzy0Mqb8uV7EBmAcfywwCkQOXrlaV2dMu/1bF2NXKNradtqghU+htYKttWbL11Bc1+8vpiioLls88+m02dCxo6dWnJBxALLH5Zv221+lqH6kheUNJy9dPat/LG+ibW51i5LqotyOn623XXXZfeoOFP75VJOgV4KeiuykGpjoJ502kUp/e2H5VR2WH1O/ArOJhBgk0Zee1ZoBqG2gwPcrG8pikTMAYJSnmsDWvHB4c8sfVW0ZdhxNareeVbKtuvfgFjmICiOuqDTQ9C5Z988skZAW4c9abun5/8ZelkNlsdnaLUqECnLNvw8PeKFSuSAwcOZHPlqY7qVsU+0P2ulQxCpyHzAlcs8Kms6oxCgaWOg5YF0VggtfzYsirN1nrqZAfvUf9Gvr6m7fObJ7beOj7zZRS9B+pL3jKxwNFvez3VsYTZ0+vtPZm8fDh+gXZUOv2nkZxuzW96oNMzcMM8pK5TgDfffHM2V528nWsY6mMsmGl0oy8iIZUtc2ozT9UjtJDat2Dn3yfLt1SX2VpPXezgPtv6rVejQJWxwFFnPy/Fe6Cg6JNtJ+pV2+lKo0Cnh6dffPHF9A7GptIjDurjIKcsdbPK3r1707pV0oc/786wQX3zzTfpw94xutFGzy7GqM4oozkd/NevX5/NXRC7saMqRe3FbjIRXycMmnnKlrtUij4//Q7ugxz8NdrxB+qwbtEyT/lhsnxrw09L2F6Z06SmqC8xVt7WP+xIbJh6qmN9Dev3a0/Ln3nmmTSgDrPurqg9yMnSpUvTEZ2eQ1uzZk2W2yzqo06xDnLgffDBB5P7778/rTsq24Hs9dSpU+nrqPwjAyE9F5cXAEU//VUlBT5tn95je58tz/PLQ7ZMyde1EZVfbsL12jK7Pmh5sb6EbD12x6W11SbaxjCNwrdRdMrRr8/XGYTVGyRIxfg+WPL8qDK2LgWOQdjNHgo2lvptg61DN61YkOq3Xt9+KMzLK9c1ExN7Tkwveu3x5Kt9W7Ks+miUpJ/C0uhOvwPZRLqGqBtJ9OhD3jNzGsEpWOtB8NjpvmHpQ6+DhKUqHjQf9SCsQBAeADAanSaOjXLRDgoMgwY5XDqzMpIzCho6dVnHNayqKPiqf/YfB3RtSsFZSY8Z6JSrHovQzSZ1BGr79qj0+++/Z7nDu+2227KpwakuAQ64gADXPrM6kmsT/VqLrrfpZhS761KBTTeo6BTlsM/U9VPHaA7NwkgOmD0EuYZRkPOBTtcGrrrqqmwpAGAQs3q6Ev3505UKcLpLrsxD3ACAixHkGsoHOt1pWdXdlgAwTghyDRSO5pQ0mmNEBwCDIcg1VCzQnT59Ojl+/Hjf52sAAOcQ5BosFuh0je7YsWPpfwqo6ldRAKCrCHIN5wOdD3ZnzpxJfvvtt+To0aNpwPvjjz/SPADABTxC0BJ2itIeMQjnbdq/AsC4I8i1TF5AI8ABwMUmkn+cnF786gaCXMv4YBYGNgIdAJxDkOsAghoAxJ0Pcvv+41+zLAAAuuF8kPv+tb9nWQAAdAOPEAAAOosgBwDoLIIcAKCzCHIAgM4iyAEAOosgBwDoLIIcAKCzevpl+0QJAICOYSQHAOgsghwAoLN66Y/78gO/AIAO6hHgAABd1ZvQCUvuOwEAdBDX5AAAnUWQAwB0VqODXPoM35iqatvVDv85vNg4f86Arisd5PIOBBwgukF/R59mQ9XrCdubje2w90uJLxNA85QOctqBYwcRduzumJqaSv+esb81Lmaff94zoLkGPl1pO3Jsh1aeTyYsG873E7ZnLD9cVmbepzKsXK/Xi9azPEs66BmfH/LtxZZbvm9PfB0lLy9/FL5NazfM88mE+RYMlMLlXr/3ZRi+PaWyf6Nh+TZ9u9o28cusL76chPN574tNx5YB42ygIBceaMODhCgvb4cdhtqwNsP2LD+2LI9vz9fVaz8qd/bs2YvK6sDj21OanJzMlub3M9YXzy/37cXqWbthX6pQtD7x85o2djC3OuL7JzZt86K27H22ZH0ow9br9fsbieX7bStiZWPlrb8++XJ+eVmqU/S++Db9uoBxNvBILtyxPJ8XWz6MonbUD0shy8tb5lNZtu027YVt+uU+P6RThHnKbnus3WEoEFh7/bbP+HKx/obLfd0ivi9l6/Tj21Pq1/cyVM+2K2wjXJ8Xrtsvt+m8YF2mzaLPFTBOBg5yTaEdXDu1Ja/MfJjCA8agYm1KUT9H4dusqm27JiexA2iY6uSvD1qq629UBbWVNzL0qZ+wTDhfx/sCdFmlQc7vbHk7Xh075KBtXqo+5H0zH4bWFx4AQ8NuZ6zdYdvy9cr02YzyvuiUXqy/w27DsAbZ3rJGeV9me/uBJqgsyNnO7Hcmy9Nr1TtZvzZtufXB2LzVtRSWG4SdGgrbFN/PWF98eaUyrJ3YqSv1xeZH2SaxNqwda9dSP+H7IpZnYu3F3helUban6G8kPq/senwdJQVXY23E/kb92Pb79qSO9wXouqGCXN5OpXyfvKJleWJteL69cJnE8iSsp6SDRRGVKRK258vn5YsOvrFlsXKer2PJ+Hm99ts2CctZG5Zn82Eyvn8+PywfW4clL3xflMr8jaycTXuW51Msv6ywXti/cLmShH/LGJWNbW/e+6LXIlYWGDeVjeQAAGgaghwAoLMIcgCAzupNJ5ynBwB0k279yiYBAOgWTlcCADqLIAcA6CyCHACgswhyAIDO6vX7FQkAANqKkRwAoLMIcgCAziLIAQA6iyAHAOgsghwAoLMIcgCAziLIAQA6iyAHAOgsghwAoLMIcgCAziLIAQA6iyAHAOgsghwAoLMIcgCAziLIAQA6iyAHAOgsghwAoLMIcgCAziLIAQA6iyAHAOgsghwAoLMIcgCAziLIAQA6iyAHAOioJPknRtwIptdrFtsAAAAASUVORK5CYII="}}]);